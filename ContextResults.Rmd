---
output: latex_fragment
editor_options:
  chunk_output_type: console
bibliography: references.bib
csl: apa.csl
---

```{r setup, include=FALSE}
# R Studio Clean-Up
  cat("\014") # clear console
  #rm(list=ls()) # clear workspace - use restart R instead
  gc() # garbage collector
  
# Install and Load Packages
lib <- c("rmarkdown", "knitr", "citr", "remedy", "bookdown", "papaja", "rmdfiltr", "psych",
         "ggplot2", "ggthemes", "haven", "RColorBrewer", "plotly", "forcats", "wordcloud", "visNetwork", "ggwordcloud",
         "rworldmap", "rnaturalearth", "rnaturalearthdata", "rgeos", "sp", "ggspatial",
         "data.table", "dplyr", "tidyr", "Hmisc", "kableExtra", "readxl", "stringr", "stringi", "reshape2",
         "tibble", "sqldf", "networkD3", "GGally", "ggstatsplot","hrbrthemes", "cowplot", "paletteer", "ggpubr",
         "mada", "naniar", "stats", "matrixStats", "ISOcodes", "pander", "lubridate", "gsheet",
         "DiagrammeR", "janitor", "DiagrammeRsvg", "rsvg")
invisible(lapply(lib, library, character.only = TRUE))  
rm(lib)  

# Load Custom Packages  
  source("./scripts/functions/fun.panel.R")
  source("./scripts/functions/themes.R")
  source("./scripts/functions/prismaGraph.R")

# Markdown Options
  knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file()) # set working directory
  knitr::opts_knit$get("root.dir") # check working directory
  options(scipen = 999, digits = 4, width = 400) #removes scientific quotation

# Global Chunk Options
  knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='Figures/',
                      echo=FALSE, warning=FALSE, message=FALSE)
```

```{r import}
load("data/wrangled.RData")
```

\subsection{Methodological Literature}  
To gain a general understanding of contextual factors within the validated studies, we also assessed cross-study patterns of cultural, individual, situational, and process-related focus points.

\paragraph{Country}

```{r ScaleCountryFreq, include=F}
# Host Countries: Count number of host countries
HostCountryN <- as.data.frame(table(str_count(dt.Scales.Included$HostCountry, ',')+1, dnn = list("count")))

# Host Countries: Find all individual country names and count frequency of occurrence
HostCountryFreq <- as.data.frame(table(unlist(strsplit(dt.Scales.Included$HostCountry, ", ")), dnn = list("country")), 
                                 responseName = "frequency") %>% 
  arrange(frequency) %>%    # First sort by val. This sort the dataframe but NOT the factor levels
  mutate(country = factor(country, levels=country), # update factor levels
         source = "host")

# Origin Countries: Count number of host countries
OriginCountryN <- as.data.frame(table(str_count(dt.Scales.Included$OriginCountry, ',')+1, dnn = list("count")))

# Origin Countries: Find all individual country names and count frequency of occurrence
OriginCountryFreq <- as.data.frame(table(unlist(strsplit(dt.Scales.Included$OriginCountry, ", ")), dnn = list("country")), 
                                   responseName = "frequency") %>% 
  arrange(frequency) %>%    # First sort by val. This sort the dataframe but NOT the factor levels
  mutate(country = factor(country, levels=country), # update factor levels
         source = "origin")

# combine Host and Origin list
CountryFreq <- rbind(OriginCountryFreq, HostCountryFreq)
```

To assess the cultural contexts for which scales were validated, we assessed the migrants' countries of settlement as well as the countries of origin. We found that most scales investigated a single host country (\textit{N} = `r HostCountryN$Freq[HostCountryN$count==1]-HostCountryFreq$frequency[HostCountryFreq$country=="multiple"]`) and most investigated one country of origin (\textit{N} = `r OriginCountryN$Freq[OriginCountryN$count==1]-sum(OriginCountryFreq$frequency[OriginCountryFreq$country=="any"|OriginCountryFreq$country=="multiple"])`). There were only `r sum(HostCountryN$Freq[as.numeric(HostCountryN$count)>1])+sum(HostCountryFreq$frequency[HostCountryFreq$country=="any"|HostCountryFreq$country=="multiple"])` scales that were validated for more than one receiving country. Looking at the country patterns, we found that an overwhelming number of scales were validated within a U.S. American settlement context (\textit{N} = `r HostCountryFreq$frequency[HostCountryFreq$country=="United States of America"]`). But also the remaining receiving societies were mostly 'western' countries (e.g., Canada, The Netherlands, The United Kingdom, Israel, Australia) with non-western settlement contexts, such as Taiwan, Nepal, or Russia, not being investigated across more than two study. For the migrant origin societies there was slightly more variation. There were a few migrant groups that were investigated specifically (e.g., Mexico: `r OriginCountryFreq$frequency[OriginCountryFreq$country=="Mexico"]`, China:`r OriginCountryFreq$frequency[OriginCountryFreq$country=="China"]`, South Korea: `r OriginCountryFreq$frequency[OriginCountryFreq$country=="South Korea"]`), however most validation studies targeted broader categories of migrants (any migrants: `r OriginCountryFreq$frequency[OriginCountryFreq$country=="any"]`, Asian: `r OriginCountryFreq$frequency[OriginCountryFreq$country=="Asia"]`, Hispanic: `r OriginCountryFreq$frequency[OriginCountryFreq$country=="Hispanic"]`, LatinX: `r OriginCountryFreq$frequency[OriginCountryFreq$country=="LatinX"]`). This also made it difficult to identify patterns of cultural combinations investigated (apart from Mexican and LatinX migrants in the United States).

\paragraph{Sample}

```{r SampleFreq, include=F}
# tally different samples
SampleFreq <- as.data.frame(table(Sample = dt.Scales.Included$Sample)) %>%
  arrange(Freq) %>%    # First sort by val. This sort the dataframe but NOT the factor levels
  mutate(Sample = factor(Sample, levels=Sample),
         Perc = Freq/nrow(dt.Scales.Included)*100) # update factor levels
```

To assess the role different groups of individuals targeted in the scale validations, we coded the types of samples recruited for the validation studies. A majority of studies sampled any consenting adult from the migrant group of interest (\textit{N} = `r SampleFreq$Freq[SampleFreq$Sample=="general"]`). As seems common in academic research, a larger portion of the validated scales relied on young migrants or students (\textit{N} = `r sum(SampleFreq$Freq[SampleFreq$Sample=="youth"|SampleFreq$Sample=="students"])`). Interestingly, only small minority of validated scales targeted more vulnerable groups, such as clinical samples (\textit{N} = `r SampleFreq$Freq[SampleFreq$Sample=="clinical"]`) or refugees (\textit{N} = `r sum(SampleFreq$Freq[grepl("refugee", SampleFreq$Sample, fixed = TRUE)])`) -- despite a considerable focus on these groups within the broader literature. Given the small cell counts, we did not investigate differences in the experience measures across the different samples.

\paragraph{Domains}

```{r ScaleDomainFrequencies, include=F, warning=F, fig.cap="Wordcloud of the validation scale domains."}
# Number of domains in scale
ScaleDomainN <- str_count(dt.Scales.Included$domainScale, ',')+1

# Domain frequencies: Find all individual domains and count frequency of occurrence
ScaleDomainFreq <- as.data.frame(table(unlist(strsplit(dt.Scales.Included$domainScale, ", ")), dnn = list("domain")), 
                                 responseName = "frequency") %>% 
  arrange(frequency) %>%    # First sort by val. This sort the dataframe but NOT the factor levels
  mutate(domain = factor(domain, levels=domain)) # update factor levels

# # Word cloud frequencies
# set.seed(7) # for reproducibility 
# wordcloud(words = ScaleDomainFreq$domain, freq = ScaleDomainFreq$frequency, 
#           min.freq = 1, max.words=200, random.order=FALSE, rot.per=0.35, colors=brewer.pal(8, "Dark2"))
```

To assess the situational focus within the validated scales, we assessed the number of domains within each scale as well as more common domains across the scales. A relatively large number of scales asked about the current state of the migrant in general manner without mentioning any context or life domain (\textit{N} = `r ScaleDomainFreq$frequency[ScaleDomainFreq$domain=="general"]`; e.g., "In general, in what language do you read and speak?"). The remaining scales referred to an average of `r round(mean(ScaleDomainN, na.rm=TRUE),2)` dimensions (\textit{SD} = `r round(sd(ScaleDomainN, na.rm=TRUE),2)`, range: `r min(ScaleDomainN, na.rm=TRUE)` -- `r max(ScaleDomainN, na.rm=TRUE)`). A total of `r nrow(ScaleDomainFreq)` unique domains was measured across the `r nrow(dt.Scales.Included)` scales. The domains of 'languageâ€˜ (\textit{N} = `r ScaleDomainFreq$frequency[ScaleDomainFreq$domain=="language"]`), 'food' (\textit{N} = `r ScaleDomainFreq$frequency[ScaleDomainFreq$domain=="food"]`), and 'family' (\textit{N} = `r ScaleDomainFreq$frequency[ScaleDomainFreq$domain=="family"]`) were focused on most often (see Supplementary Information A). Thus, while there was large variation between the scales in the number, and diversity of domains, the most frequently mentioned domains were in line with the life domains proposed in the literature \citep[e.g.,][]{Arends-Toth2007}. Yet again, given the large variability between studies, we did not investigate differences in experience elements across the different situational domains.  

\subsection{Empirical Literature}  
To gain a general understanding of contextual factors within the broader empirical studies, we again assessed cross-study patterns of cultural, individual, situational, and process-related focus points.

\paragraph{Country}

```{r EmpCountryFreq, include=F}
# Host Countries: Count number of host countries
EmpHostCountryN <- as.data.frame(table(str_count(dt.Empirical.included$HostCountry, ',')+1, dnn = list("count")))

# Host Countries: Find all individual country names and count frequency of occurrence
EmpHostCountryFreq <- as.data.frame(table(unlist(strsplit(dt.Empirical.included$HostCountry, ", ")), dnn = list("country")), 
                                 responseName = "frequency") %>% 
  arrange(frequency) %>%    # First sort by val. This sort the dataframe but NOT the factor levels
  mutate(country = factor(country, levels=country), # update factor levels
         source = "host")

# Origin Countries: Count number of host countries
EmpOriginCountryN <- as.data.frame(table(str_count(dt.Empirical.included$OriginCountry, ',')+1, dnn = list("count")))

# Origin Countries: Find all individual country names and count frequency of occurrence
EmpOriginCountryFreq <- as.data.frame(table(unlist(strsplit(dt.Empirical.included$OriginCountry, ", ")), dnn = list("country")), 
                                   responseName = "frequency") %>% 
  arrange(frequency) %>%    # First sort by val. This sort the dataframe but NOT the factor levels
  mutate(country = factor(country, levels=country), # update factor levels
         source = "origin")

# combine Host and Origin list
EmpCountryFreq <- rbind(EmpOriginCountryFreq, EmpHostCountryFreq)

# pattern compound Ns
EmpLatinOr <- sum(EmpOriginCountryFreq[grepl("Latin|Hispanic", EmpOriginCountryFreq$country),]$frequency)
EmpAfricaOr <- sum(EmpOriginCountryFreq[grepl("Afri", EmpOriginCountryFreq$country),]$frequency)
EmpAsiaOr <- sum(EmpOriginCountryFreq[grepl("Asia", EmpOriginCountryFreq$country),]$frequency)

EmpOrSm5 <- nrow(EmpOriginCountryFreq[EmpOriginCountryFreq$frequency<5,])
```

To assess the cultural contexts on which the authors focused, we again assessed the migrants' countries of settlement as well as the countries of origin. Similar to the validations, an overwhelming number of scales were validated within a North American settlement context (United States: \textit{N} = `r EmpHostCountryFreq$frequency[EmpHostCountryFreq$country=="United States"]`, Canada: \textit{N} = `r EmpHostCountryFreq$frequency[EmpHostCountryFreq$country=="Canada"]`). But also the remaining receiving societies were mostly 'western' -- Western Europe (e.g., The Netherlands, United Kingdom, Germany, Italy, Spain), Australasia (Australia, New Zealand), Russia, and Israel. And only `r sum(EmpHostCountryN$Freq[as.numeric(EmpHostCountryN$count)>1])+sum(c(EmpHostCountryFreq$frequency[EmpHostCountryFreq$country=="any"], EmpHostCountryFreq$frequency[EmpHostCountryFreq$country=="multiple"]))` studies focused on data from multiple receiving societies. 

When it came to the migrants' country of origin, a majority of studies were indifferent to migrants background and simply recruited any consenting migrant (\textit{N} = `r EmpOriginCountryFreq$frequency[EmpOriginCountryFreq$country=="any"]`), or recruited a category of migrants (e.g., LatinX or Hispanic: \textit{N} = `r EmpLatinOr`, Asian:\textit{N} = `r EmpAsiaOr` African: \textit{N} = `r EmpAfricaOr`). Among the individual countries target there was a particular focus on the east and south-east Asian region (e.g., China: \textit{N} = `r EmpOriginCountryFreq$frequency[EmpOriginCountryFreq$country=="China"]`, South Korea: \textit{N} = `r EmpOriginCountryFreq$frequency[EmpOriginCountryFreq$country=="Korea"]`, Vietnam: \textit{N} = `r EmpOriginCountryFreq$frequency[EmpOriginCountryFreq$country=="Vietnam"]`). Yet, different from the scale validations, there was a large variety of different origin countries that were included in less than five studies (\textit{N} = `r nrow(EmpOriginCountryFreq[EmpOriginCountryFreq$frequency<5,])` regions were targeted less than five times). Thus, the receiving countries mainly mirrored those for which scales were validated, yet there was an extensive number origin countries which were investigated individually or migrants were considered irrespective of their cultural origin. Moreover, it was again not possible to identify distinct cultural clusters within the literature that would be large enough to compare measures of cultural adaptation.

\paragraph{Sample}

```{r EmpSampleFreq, include=F}
# tally different samples
EmpSampleFreq <- as.data.frame(table(Sample = dt.Empirical.included$Sample)) %>%
  arrange(Freq) %>%    # First sort by val. This sort the dataframe but NOT the factor levels
  mutate(Sample = factor(Sample, levels=Sample),
         Perc = Freq/nrow(dt.Empirical.included)*100) # update factor levels

EmpSampleRefugee <- sum(EmpSampleFreq[grepl("refugee", EmpSampleFreq$Sample),]$Freq)
EmpSampleRefugeePerc <- round(sum(EmpSampleFreq[grepl("refugee", EmpSampleFreq$Sample),]$Perc),2)

EmpSampleYouth <- sum(EmpSampleFreq[grepl("student|youth|children", EmpSampleFreq$Sample),]$Freq)
EmpSampleYouthPerc <- round(sum(EmpSampleFreq[grepl("student|youth|children", EmpSampleFreq$Sample),]$Perc),2)

EmpSampleWomen <- sum(EmpSampleFreq[grepl("woman|women", EmpSampleFreq$Sample),]$Freq)
EmpSampleWomenPerc <- round(sum(EmpSampleFreq[grepl("woman|women", EmpSampleFreq$Sample),]$Perc),2)

EmpSampleElderly <- sum(EmpSampleFreq[grepl("old|elderly", EmpSampleFreq$Sample),]$Freq)
EmpSampleElderlyPerc <- round(sum(EmpSampleFreq[grepl("old|elderly", EmpSampleFreq$Sample),]$Perc),2)
```

To assess the role different groups of individuals targeted in the empirical work, we again coded the types of samples recruited for the studies. A majority of studies sampled any consenting adult from the migrant group of interest (\textit{N} = `r EmpSampleFreq$Freq[EmpSampleFreq$Sample=="general"]`, `r round(EmpSampleFreq$Perc[EmpSampleFreq$Sample=="general"],2)`\%). Of the targeted sampling strategies, most recruited young migrants (\textit{N} = `r EmpSampleYouth`, `r EmpSampleYouthPerc`\%) women (\textit{N} = `r EmpSampleWomen`, `r EmpSampleWomenPerc`\%), or refugees (\textit{N} = `r EmpSampleRefugee`, `r EmpSampleRefugeePerc`\%). The remaining fifth of the studies recruited other more specific samples (e.g., nurses, athletes, Muslims). Interestingly, even though a large portion of papers focused on mental health outcomes, only `r EmpSampleFreq$Freq[EmpSampleFreq$Sample=="clinical"]` studies (`r round(EmpSampleFreq$Perc[EmpSampleFreq$Sample=="clinical"],2)`\%) recruited clinical migrant samples. These results speak to the case that relatively few empirical studies actually take individual differences into account in their sample selection. Studies may still address individual differences within the data description and within the modeling approaches (e.g., controlling for gender), yet it seems that inter-sectional idiosyncrasies did not seem to play a major role in the targeting of samples. Moreover, cell counts were again unbalanced and we did not assess experience differences between the samples.

\paragraph{Domains}

```{r EmpDomainFrequencies, include=F, warning=F}
# Number of domains in scale
EmpDomainN <- str_count(dt.Empirical.included$domainScale, ',')+1

# Domain frequencies: Find all individual domains and count frequency of occurrence
EmpDomainFreq <- as.data.frame(table(unlist(strsplit(dt.Empirical.included$domainScale, ", ")), dnn = list("domain")), 
                                 responseName = "frequency") %>% 
  arrange(frequency) %>%    # First sort by val. This sort the dataframe but NOT the factor levels
  mutate(domain = factor(domain, levels=domain)) # update factor levels

# # Word cloud frequencies
# set.seed(7) # for reproducibility 
# wordcloud(words = ScaleDomainFreq$domain, freq = ScaleDomainFreq$frequency, 
#           min.freq = 1, max.words=200, random.order=FALSE, rot.per=0.35, colors=brewer.pal(8, "Dark2"))
```

To capture the situational focus of the authors, we coded which life domains the utilized measures referred to. A relatively large number of studies assess cultural adaption in general manner without mentioning any context or life domain (\textit{N} = `r EmpDomainFreq$frequency[EmpDomainFreq$domain=="general"]`). The remaining studies referred to an average of `r round(mean(EmpDomainN, na.rm=T),2)` dimensions (\textit{SD} = `r round(sd(EmpDomainN, na.rm=T),2)`, range: `r min(EmpDomainN, na.rm=T)` -- `r max(EmpDomainN, na.rm=T)`). We found a total of `r nrow(EmpDomainFreq)-1` unique domains across the `r nrow(dt.Empirical.included)` studies. The domains of 'languageâ€˜ (\textit{N} = `r EmpDomainFreq$frequency[EmpDomainFreq$domain=="language"]`), 'foodâ€™ (\textit{N} = `r EmpDomainFreq$frequency[EmpDomainFreq$domain=="food"]`), and 'mediaâ€™ (\textit{N} = `r EmpDomainFreq$frequency[EmpDomainFreq$domain=="media"]`) were included most frequently. So, while larger proportion of studies ask about cultural adaption in general (outside of a specific domain), the number of domains included and addressed is extensive and diverse. The mentioned domains at times go beyond the life fields mentioned in previous work (also see Supplementary Information A).

