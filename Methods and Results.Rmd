---
output: latex_fragment
editor_options:
  chunk_output_type: console
bibliography: references.bib
csl: apa.csl
---

```{r setup, include=FALSE}
# R Studio Clean-Up
  cat("\014") # clear console
  #rm(list=ls()) # clear workspace - use restart R instead
  gc() # garbage collector
  
# Install and Load Packages
lib <- c("rmarkdown", "knitr", "citr", "remedy", "bookdown", "papaja", "rmdfiltr", "psych",
         "ggplot2", "ggthemes", "haven", "RColorBrewer", "plotly", "forcats", "wordcloud", "visNetwork", "ggwordcloud",
         "rworldmap", "rnaturalearth", "rnaturalearthdata", "rgeos", "sp", "ggspatial",
         "data.table", "dplyr", "tidyr", "Hmisc", "kableExtra", "readxl", "stringr", "stringi", "reshape2",
         "tibble", "sqldf", "networkD3", "GGally", "ggstatsplot","hrbrthemes", "cowplot", "paletteer", "ggpubr",
         "mada", "naniar", "stats", "matrixStats", "ISOcodes", "pander", "lubridate", "gsheet",
         "DiagrammeR", "janitor", "DiagrammeRsvg", "rsvg")
invisible(lapply(lib, library, character.only = TRUE))  
rm(lib)  

# Load Custom Packages  
  source("./scripts/functions/fun.panel.R")
  source("./scripts/functions/themes.R")
  source("./scripts/functions/prismaGraph.R")

# Markdown Options
  knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file()) # set working directory
  knitr::opts_knit$get("root.dir") # check working directory
  options(scipen = 999, digits = 4, width = 400) #removes scientific quotation

# Global Chunk Options
  knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='Figures/',
                      echo=FALSE, warning=FALSE, message=FALSE)
```

```{r import}
load("data/wrangled.RData")
```

\subsection{Methodological Literature}  
Based on the systematic review and its coding, the first data set we assess is a database of scale validations. We bring together the scales suggested in previous reviews as well as validation studies we identified in our own review. Throughout our literature review we found five major works that reviewed the measurement of acculturation \citep{Celenk2011, Maestas2000, Matsudaira2006, Wallace2010, Zane2004}. After removal of duplicate scales, we added any scale validation that was present in our own systematic review but not included in the previous reviews. For each measure we extracted the full item list as well as the item scoring prior to coding. A comprehensive and interactive database of the scales, with reference- and publication information, as well as our experience elements and -context coding is available in our online supplementary information as well as on our open science repository (\hl{OSF and/or github citation here}).  

\subsubsection{Methods}  
Taken together these five reviews collected a total of `r nrow(dt.Scales[dt.Scales$Source != "own review",])` scales. From our own review we added `r nrow(dt.Scales[dt.Scales$Source == "own review",])` additional validation studies. After removing duplicates this meant that we considered a total of `r nrow(dt.Scales)` unique scales for our coding. Of these scales we ultimately had to exclude `r nrow(dt.Scales[!is.na(dt.Scales$MissingNote),])`, because they were either not accessible or did not fit the the topic of our review (see Table \ref{tab:ScalesExclusion}). About a quarter of scales (`r round(nrow(filter(dt.Scales, IncludesMajority == 1))/nrow(dt.Scales)*100,2)`\%) included majority group members in their validation studies. The earliest included validation was from `r min(dt.Scales$year, na.rm = T)` with a majority of scales being validated around the turn of the 21\textsuperscript{st} century and the most recent included validation study was published in `r max(dt.Scales$year, na.rm = T)`.  

```{r ScalesExclusion}
data.frame(table(Exclusion = dt.Scales$MissingNote)) %>%
  arrange(desc(Freq)) %>%
  kbl(., 
        #label = "",
        caption = "Scales Exclusion Reasons",
        format = "latex",
        col.names = c("Exclusion Reason",
                      "Frequency"), 
        linesep = "",
        booktabs = T,
        align = c("l", "c"))  %>%
  kable_styling(position = "left") %>%
  #gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  gsub("\\begin{table}", "\\begin{table}\n\\begin{minipage}[t][\\textheight][t]{\\textwidth}", ., fixed = TRUE) %>% # fix table position
  gsub("\\end{table}", "\\end{minipage}\n\\end{table}", ., fixed = TRUE) %>% # fix table position
  save_kable("Tables/ScalesExclusion.tex")
```

\input{Tables/ScalesExclusion}  

\subsubsection{Results}
```{r ABCDCalc, include=F}
# Count the times each dimension is measured
ScaleElementFreq <- dt.Scales.Included %>%
  dplyr::select(Affect, Behavior, Cognition, Desire) %>%
  mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  colSums(., na.rm = FALSE, dims = 1) 

# transform to data frame and make row names name variable
ScaleElementFreq <- data.frame(Element = names(ScaleElementFreq), 
                            Frequency = ScaleElementFreq, 
                            Percentage = ScaleElementFreq/nrow(dt.Scales.Included)) %>%
  mutate(Element = fct_reorder(Element, Frequency))

# frequency of unique combinations
ScaleElementCombFreq <- dt.Scales.Included %>%
  dplyr::select(Affect, Behavior, Cognition, Desire) %>%
  #mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  group_by(Affect, Behavior, Cognition, Desire) %>%
  summarise(Frequency = n()) %>%
  ungroup() %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T))

# fill replace ones with colnames to be combined
for (i in 1:4) {
    ScaleElementCombFreq[[i]] <- str_replace(as.character(ScaleElementCombFreq[[i]]), "1", colnames(ScaleElementCombFreq)[i])
}

# collect Elements names for each combination
ScaleElementCombFreq <- ScaleElementCombFreq %>%
  unite("ExperienceCombination",c("Affect", "Behavior", "Cognition", "Desire"), na.rm = TRUE, sep = ", ") %>%
  mutate(ExperienceCombination = fct_reorder(ExperienceCombination, Frequency),
         Percentage = Frequency/nrow(dt.Scales.Included)*100,
         Affect = ifelse(grepl("Affect", ExperienceCombination, fixed = TRUE), 1,0),
         Behavior = ifelse(grepl("Behavior", ExperienceCombination, fixed = TRUE), 1,0),
         Cognition = ifelse(grepl("Cognition", ExperienceCombination, fixed = TRUE), 1,0),
         Desire = ifelse(grepl("Desire", ExperienceCombination, fixed = TRUE), 1,0))

scaleComplexity <- ScaleElementCombFreq %>%
  select(complexity, Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency),
            Percentage = sum(Frequency)/nrow(dt.Scales.Included)*100) %>%
  ungroup() %>%
  mutate(complexity = as.factor(complexity),
         complexity = fct_reorder(complexity, Frequency))

elementComplexity <- data.frame(Element = c("Affect", "Behavior", "Cognition", "Desire"), 
                                avgComplexity = c(ScaleElementCombFreq %>% filter(Affect == 1) %>% weighted.mean(x = .$complexity, w = .$Frequency), 
                                                  ScaleElementCombFreq %>% filter(Behavior == 1) %>% weighted.mean(x = .$complexity, w = .$Frequency), 
                                                  ScaleElementCombFreq %>% filter(Cognition == 1) %>% weighted.mean(x = .$complexity, w = .$Frequency), 
                                                  ScaleElementCombFreq %>% filter(Desire == 1) %>% weighted.mean(x = .$complexity, w = .$Frequency)))
```

```{r ScaleElementCooccurrences, include=F}
# make crossproduct matrix to condense co-occurrences (off-diagonals) and get frequencies (diagonals)
scaleElementCooccure <- as.matrix(dt.Scales.Included %>% dplyr::select(Affect, Behavior, Cognition, Desire) %>% mutate_all(~replace(., is.na(.), 0)))
scaleElementCooccure <- crossprod(scaleElementCooccure)  # Same as: t(X) %*% X
#diag(scaleElementCooccure) <- 0       # remove frequencies on diagonals
#scaleElementCooccure[upper.tri(scaleElementCooccure)] <- ""

scaleElementCooccure %>%
  kbl(., 
        #label = "",
        caption = "Scales: Element Co-occurrence Matrix",
        format = "latex", 
        linesep = "",
        booktabs = T,
        align = rep('c', ncol(scaleElementCooccure)))  %>%
  kable_styling(position = "left") %>%
  #gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  gsub("\\begin{table}", "\\begin{table}\n\\begin{minipage}[t][\\textheight][t]{\\textwidth}", ., fixed = TRUE) %>% # fix table position
  gsub("\\end{table}", "\\end{minipage}\n\\end{table}", ., fixed = TRUE) %>% # fix table position
  save_kable("Tables/ScaleElementCooccurrences.tex")
```

With our main aim of examining the experience structure within the scales, we examined whether scales included a specific experience elements but also examined the used elements in their complex combinations. In terms of general inclusion of elements, most studies included a measure of cognition (`r round(ScaleElementFreq$Percentage[ScaleElementFreq$Element=="Cognition"]*100,2)`\%) and behavior (`r round(ScaleElementFreq$Percentage[ScaleElementFreq$Element=="Behavior"]*100,2)`\%), whereas only roughly half the studies included a measure of affect (`r round(ScaleElementFreq$Percentage[ScaleElementFreq$Element=="Affect"]*100,2)`\%) and only a fourth of the scales included a measure of desires (`r round(ScaleElementFreq$Percentage[ScaleElementFreq$Element=="Desire"]*100,2)`\%). However, only a minority of scales included only a single aspect. There were only `r ScaleElementCombFreq$Frequency[ScaleElementCombFreq$ExperienceCombination=="Cognition"]` scales that exclusively relied on cognitions (`r round(ScaleElementCombFreq$Percentage[ScaleElementCombFreq$ExperienceCombination=="Cognition"],2)`\%) and `r ScaleElementCombFreq$Frequency[ScaleElementCombFreq$ExperienceCombination=="Behavior"]` scales that measured only behaviors (`r round(ScaleElementCombFreq$Percentage[ScaleElementCombFreq$ExperienceCombination=="Behavior"],2)`\%). Yet, inversely, there were also only `r ScaleElementCombFreq$Frequency[ScaleElementCombFreq$ExperienceCombination=="Affect, Behavior, Cognition, Desire"]` scales that measured all four aspects (`r round(ScaleElementCombFreq$Percentage[ScaleElementCombFreq$ExperienceCombination=="Affect, Behavior, Cognition, Desire"],2)`\%). Most studies measured two (`r ScaleElementCombFreq %>% filter(complexity == 2) %>% select(Frequency) %>% summarise(Perc = round(sum(.)/nrow(dt.Scales.Included)*100, 2))`\%) or three (`r ScaleElementCombFreq %>% filter(complexity == 3) %>% select(Frequency) %>% summarise(Perc = round(sum(.)/nrow(dt.Scales.Included)*100, 2))`\%) aspects. A majority of scales either measured behavioral and cognitive aspects (`r round(ScaleElementCombFreq$Percentage[ScaleElementCombFreq$ExperienceCombination=="Behavior, Cognition"],2)`\%) or behavioral, cognitive, and affective elements (`r round(ScaleElementCombFreq$Percentage[ScaleElementCombFreq$ExperienceCombination=="Affect, Behavior, Cognition"],2)`\%; also see Figure \ref{fig:ElementsScales} and Table \ref{tab:ScaleElementCooccurrences}). Looking at the number of aspects measured together we also see substantial differences in what kind of scales include a certain aspect. Scales that included cognitions measured an average of `r round(elementComplexity$avgComplexity[elementComplexity$Element=="Cognition"],2)` aspects, scales measuring behavior, on average, measured a `r round(elementComplexity$avgComplexity[elementComplexity$Element=="Behavior"],2)`, while scales that included affect measures had a complexity average of `r round(elementComplexity$avgComplexity[elementComplexity$Element=="Affect"],2)` and scales measuring desires even measured an average of `r round(elementComplexity$avgComplexity[elementComplexity$Element=="Desire"],2)` aspects per scale. Thus, most scales measure multiple dimensions, yet they focus on external accessible aspects of psychological acculturation (i.e., behavior and cognition), less of what is considered 'internal' or 'subjective' (i.e., affect and desires). This is further underscored by the observation that there were only `r ScaleElementCombFreq$Frequency[ScaleElementCombFreq$ExperienceCombination=="Affect"]` scales that exclusively measured emotional acculturation and not a single scale that exclusively focused on motivational acculturation (while this was the case for both cognitions and behaviors). And if emotional or desire aspects were measured they were on average measured in scales that had already included more experience aspects.   

```{r  ABCDFreq, include=F, fig.width=12, fig.height=12}
# barplot of dimension frequency
ScaleABCDBar <- ggplot(data=ScaleElementFreq, aes(x=Element, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    #aes(label = paste0("N = ",Frequency)),
    aes(label = paste0(format(round(Percentage,2), nsmall=2), "%")),
    position=position_stack(vjust=0.5),
    color = "white",
    size = 4,
    vjust = 0.5
    ) +
  labs(title = "Element Frequency",
       y = "Frequency across all Scales",
       x = "Experience Element")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=10, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold"),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.position="none")

# barplot of complexity frequency
ScaleComplexityBar <- ggplot(data=scaleComplexity, aes(x=complexity, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    #aes(label = paste0("N = ",Frequency)),
    aes(label = paste0(format(round(Percentage,2), nsmall=2), "%")),
    position=position_stack(vjust=0.5),
    color = "white",
    size = 4,
    vjust = 0.5
    ) +
  labs(title = "Scale Complexity",
       y = "Frequency across all Scales",
       x = "Complexity")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=10, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold"),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.position="none")


# bar plot frequencies
ScaleABCDComb <- ggplot(ScaleElementCombFreq, aes(x=ExperienceCombination, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    aes(y=Percentage, label = paste0(format(round(Percentage,2), nsmall=2),"% [N = ", Frequency, "]")),
    color = "grey14",
    size = 4,
    hjust = -.1,
    inherit.aes = TRUE
    ) +
  scale_y_continuous(limits = c(0, ceiling(max(ScaleElementCombFreq$Percentage)*1.1)),
                     breaks = seq(0, ceiling(max(ScaleElementCombFreq$Percentage)*1.1), 5))+
  labs(y = "Proportion of all scales [in %]",
       x = "Combination of Experience Elements")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background =element_rect(fill="grey14", color="grey14"),
        strip.text = element_text(colour = 'white', face="bold"),
        legend.position="none")

ggdraw() +
  draw_plot(ScaleABCDComb, x = 0, y = 0.3, width = 1, height = .7)+
  draw_plot(ScaleABCDBar, x = 0, y = 0, width = .55, height = .3) +
  draw_plot(ScaleComplexityBar, x = .55, y = 0, width = .45, height = .3) +
  draw_plot_label(c("(A)", "(B)", "(C)"), c(0, 0, 0.55), c(1, 0.3, 0.3), size = 15)

# ScaleABCDComb + 
#   annotation_custom(
#     ggplotGrob(ScaleABCDBar), 
#     xmin = 0.5, xmax = 5, ymin = 18, ymax = 30
#   ) +
#   annotation_custom(
#     ggplotGrob(ScaleComplexityBar), 
#     xmin = 0.5, xmax = 5, ymin = 8, ymax = 18
#   ) +
#   geom_rect(aes(xmin=0.5,xmax=4.8,ymin=8,ymax=30), 
#             color = alpha("grey14", .5), size = .05, fill = "transparent", alpha=0)
```

<!-- Scale  chart goes somewhere here} -->
\begin{figure}[h]
\centering
\caption{Scales: Bar graph of the experience element combinations.}
\includegraphics[width=\textwidth]{Figures/ABCDFreq-1}
\label{fig:ElementsScales}
\end{figure}

\input{Tables/ScaleElementCooccurrences}  

```{r ScaleMigrationTime, include=F}
summarytools::freq(dt.Scales.Included$MigrationTime, order = "freq")
```

To assess the process focus of the scales we also assessed the migration time the scale validators considered. Except for a single scale that was validated for potential migrants, all scales were validated using cross-sectional data after the migrant arrived in the settlement society. This is in line with observations by previous reviews of the field \citep[e.g.,][]{Brown2011}.


\subsection{Empirical Literature}
After analysis of the scales validations, we assessed the broader empirical works we collected within the systematic review. We first looked at all available empirical publications (incl. books, chapters, and dissertations). We later also assessed differences between journal fields to assess differences between fields.  

\subsubsection{Methods}
```{r EmpiricalExclusion, include=F}
dt.psych.unique <- dt.psych %>%
  filter(SearchDuplicate != "TRUE")

dt.psych.title <- dt.psych %>%
  filter(TitleScreening == 1)

# abstract screening
dt.psych.abstract <- dt.psych %>%
  filter(TitleScreening == 1,
         AbstractScreening == 1)

# empirical
dt.psych.empirical <- dt.psych %>%
  filter(TitleScreening == 1,
         AbstractScreening == 1,
         empirical != 0)

# included
dt.psych.included <- dt.psych %>%
  filter(TitleScreening == 1,
         AbstractScreening == 1,
         empirical != 0,
         MissingABCD == 0)

# reasons for exclusion
exclTitle <- data.frame(table(Exclusion = dt.psych$TitleNote)) %>%
  mutate(screening = "Title") %>%
  arrange(desc(Freq))

exclAbstract <- data.frame(table(Exclusion = dt.psych$AbstractNote)) %>%
  mutate(screening = "Abstract") %>%
  arrange(desc(Freq))

exclFull <- data.frame(table(Exclusion = dt.psych.empirical$NoteMissing)) %>%
  mutate(screening = "Full Text") %>%
  arrange(desc(Freq))

rbind(exclTitle, exclAbstract, exclFull) %>%
  reshape(., idvar = "Exclusion", timevar = "screening", direction = "wide") %>%
  mutate_if(is.numeric, ~replace(., is.na(.), "")) %>%
  rename_at(vars(starts_with("Freq.")),
            funs(sub("Freq[.]", "", .))) %>%
  rename(., "Exclusion Reason" = Exclusion) %>%
  kbl(., 
        #label = "",
        caption = "Exclusion Reasons Empirical Literature",
        format = "latex",
        linesep = "",
        booktabs = T,
        align = c("l", "c", "c", "c"))  %>%
  add_header_above(., c(" ", "Screening" = 3)) %>%
  kable_styling(position = "left") %>%
  #gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  gsub("\\begin{table}", "\\begin{table}\n\\begin{minipage}[t][\\textheight][t]{\\textwidth}", ., fixed = TRUE) %>% # fix table position
  gsub("\\end{table}", "\\end{minipage}\n\\end{table}", ., fixed = TRUE) %>% # fix table position
  save_kable("Tables/EmpiricalExclusion.tex")
```

The search produced a total of `r nrow(dt.psych)` results to which we added 399 articles through contacts with experts in the field and from referenced works within the review. We subsequently screened out results that did not fit into our review. After duplicate removal ($N_{excluded}$ = `r nrow(dt.psych)-nrow(dt.psych.unique)`, $N_{screened}$ = `r nrow(dt.psych.unique)`), we excluded `r nrow(dt.psych.unique)-nrow(dt.psych.title)` results in the title screening as well as an additional `r nrow(dt.psych.title)-nrow(dt.psych.abstract)` results during the abstract screening. Of the remaining `r nrow(dt.psych.abstract)` results, `r nrow(dt.psych.empirical)` papers presented empirical work on acculturation and were coded. The `r nrow(dt.psych.abstract %>% filter(empirical==0))` non-empirical results were reviews, which were not coded because they did not measure cultural adaptation. During the full text coding we excluded an additional `r length(dt.psych.empirical$MissingABCD[dt.psych.empirical$MissingABCD==1])` results because they were either not relevant or were not accessible (for exclusion reasons see Table \ref{tab:EmpiricalExclusion} and for our PRISMA diagram see Figure \ref{fig:PRISMA}). 

```{r PRISMA, include=F}
prismaGr(found = nrow(dt.psych),
         found_other = 399,
         no_dupes = nrow(dt.psych.unique), 
         screened = nrow(dt.psych.unique), 
         screen_exclusions = nrow(dt.psych)-nrow(dt.psych.title), 
         full_text = nrow(dt.psych.title),
         full_text_exclusions = nrow(dt.psych.title)-nrow(dt.psych.abstract), 
         qualitative = nrow(dt.psych.abstract), 
         quantitative = nrow(dt.psych.empirical),
         extra_dupes_box = F,
         width = 800, height = 800) %>%
  export_svg() %>%
  charToRaw %>% 
  rsvg_pdf("./Figures/PRISMA.pdf")
```

<!-- Scale  chart goes somewhere here} -->
\begin{figure}[h]
\centering
\caption{PRISMA diagram. Position still undecided. Currently generated in R based on n(row) maybe make prettier.}
\includegraphics[width=\textwidth]{Figures/PRISMA}
\label{fig:PRISMA}
\end{figure}

\input{Tables/EmpiricalExclusion}

```{r EmpiricalPublicationType, include=F}
empPubType <- as.data.frame(summarytools::freq(dt.psych.included$PublicationType, order = "freq"))

empDataType <- as.data.frame(summarytools::freq(dt.psych.included$Method, order = "freq"))

empTerm <- as.data.frame(summarytools::freq(tolower(dt.psych.included$term), order = "freq"))
empTermAcc <- sum(empTerm[grepl("acculturat", rownames(empTerm), fixed = T),]$Freq)
empTermInt <- sum(empTerm[grepl("integrat", rownames(empTerm), fixed = T),]$Freq)

empMeasure <- as.data.frame(summarytools::freq(tolower(dt.psych.included$MeasureDefinition), order = "freq"))

empMajority <- as.data.frame(summarytools::freq(tolower(dt.psych.included$IncludesMajority), order = "freq"))
names(empMajority) <- gsub("% ", "Perc", names(empMajority))

empVarType <- as.data.frame(summarytools::freq(tolower(dt.psych.included$VariableType), order = "freq"))
names(empVarType) <- gsub("% ", "Perc", names(empVarType))

empFocus <- as.data.frame(summarytools::freq(tolower(dt.psych.included$domainPaper), order = "freq"))
names(empFocus) <- gsub("% ", "Perc", names(empFocus))
empFocusAcc <- sum(empFocus[grepl("acculturation|assimilation|integration|adjustment|adaptation", rownames(empFocus)),]$Freq)
empFocusAccPerc <- sum(empFocus[grepl("acculturation|assimilation|integration|adjustment|adaptation", rownames(empFocus)),]$PercValid)
empFocusHealth <- sum(empFocus[grepl("helth|stress|depression|disorder", rownames(empFocus)),]$Freq)
empFocusHealthPerc <- sum(empFocus[grepl("helth|stress|depression|disorder", rownames(empFocus)),]$PercValid)
empFocusRelation <- sum(empFocus[grepl("relations|intergroup|multiculturalism", rownames(empFocus)),]$Freq)
empFocusRelationPerc <- sum(empFocus[grepl("relations|intergroup|multiculturalism", rownames(empFocus)),]$PercValid)

empYear <- as.data.frame(summarytools::freq(dt.psych.included$year, order = "freq"))
names(empYear) <- gsub("% ", "Perc", names(empYear))
```

Of the final works we coded, `r empPubType["journalArticle",]$Freq` were journal articles, `r empPubType["thesis",]$Freq` theses, and `r empPubType["bookSection",]$Freq` book chapters. Most studies presented quantitative data (\textit{N} = `r empDataType["quantitative",]$Freq`), mixed methods (\textit{N} = `r empDataType["mixed method",]$Freq`), or qualitative data (\textit{N} = `r empDataType["qualitative",]$Freq`), while the remaining `r empDataType["Review",]$Freq` manuscripts were reviews of empirical data. Notably, a majority of the empirical investigations did not share common measures of cultural adaptation -- `r sum(empMeasure$Freq[empMeasure$Freq<=5])` studies used measures that were reported a maximum of five times, with a considerable majority of papers using new or ad-hoc measures of cultural adaptation. Less than a fifth of studies included the local majority in the study (\textit{N} = `r empMajority["1",]$Freq`, `r round(empMajority["1",]$PercValid,2)`\%). Cultural adaptation most frequently was a predictor variable (\textit{N} = `r empVarType["predictor",]$Freq`, `r round(empVarType["predictor",]$PercValid,2)`\%), a dependent variable (\textit{N} = `r empVarType["dependent",]$Freq`, `r round(empVarType["dependent",]$PercValid,2)`\%), or a correlation variable (\textit{N} = `r empVarType["correlation",]$Freq`, `r round(empVarType["correlation",]$PercValid,2)`\%) in the empirical works. This pattern was mirrored when looking at the focus of the papers, where a majority of the papers had acculturation as their main focus (\textit{N} = `r empFocusAcc`, `r round(empFocusAccPerc,2)`\%), with other bodies of work focusing on health outcomes (\textit{N} = `r empFocusHealth`, `r round(empFocusHealthPerc,2)`\%), or inter-group relations (\textit{N} = `r empFocusRelation`, `r round(empFocusRelationPerc,2)`\%) as their main outcomes. The earliest included study was published in `r min(dt.psych.included$year)`, with a strong increase of publications after the year 2000, and a peak of publications in 2012. We provide full descriptions of descriptive data extractions and additional information about the data description in Online Supplementary Information \hl{X}.

\paragraph{Field of Publication} For the broader empirical literature, we also collected additional data on the field the studies were published in. To assess the differences between fields we merged the 'Scimago Journal Ranking Database' \citep{SCImago2020} with our data base. For all available journal articles we added information on key journal metrics (incl. H index, impact factor, and data on the field and audiences). This also meant that dissertations, book chapters, and books were excluded from this analysis because data on their publishers is not readily available or unreliable. Additionally, `r nrow(psychData %>% filter(PublicationType == "journalArticle", is.na(PublicationTitleDb)) %>% dplyr::select(PublicationTitle) %>% unique())` journals were not included in the Scimago database (likely because they do not have an ISSN identifier or were discontinued before 1996, see Online Appendix \hl{X}, Table \hl{X} for the missing journals). We ultimately had journal metrics for `r nrow(psychData %>% filter(!is.na(PublicationTitleDb)))` empirical articles. 
<!-- The Scimago database classifies each journal according to the field(s) that the journal aims to address. Importantly, (1) each journal can be be classified to address multiple fields and (2) the field include codes of fields (e.g., ‘Social Sciences’) as well as sub-fields (e.g., ‘Social Psychology’). This leads to the case that there can be substantial overlap between fields, and journals cannot readily be assessed in mutually exclusive subgroups. -->

```{r disciplines, include=F}
empDisciplines <- as.data.frame(summarytools::freq(psychDataDisciplines$discipline02, order = "freq"))
names(empDisciplines) <- gsub("% ", "Perc", names(empDisciplines))
```

To summarize the journal data we then classified the journal fields into super-ordinate discipline codes. These discipline codes are based in part on U.S. Department of Education’s subject classifications \citep[i.e., CIP;][]{InstituteofEducationSciences2020}, the U.K. academic coding system \citep[JACS 3.0;][]{HigherEducationStatisticsAgency2013}, the Australian and New Zealand Standard Research Classification \citep[ANZSRC 2020;][]{AustralianBureauofStatistics2020}, as well as the Fields of Knowledge project \citep{ThingsmadeThinkable2014}. We ultimately classified each journal into one of four mutually exclusive disciplines (psychology: \textit{N} = `r empDisciplines["Psychology",]$Freq`, multidisciplinary: \textit{N} = `r empDisciplines["Multidisciplinary / Crossdisciplinary",]$Freq`, Medicine, Nursing, and Health: \textit{N} = `r empDisciplines["Medicine, Nursing, & Health",]$Freq`, and Social Sciences (miscellaneous): \textit{N} = `r empDisciplines["Social Sciences (miscellaneous)",]$Freq`. For a full discussion of the classifications see Online Supplementary Materials \hl{X}).  

\subsubsection{Results}
```{r EmpElementCalc, include=F}
# Count the times each dimension is measured
EmpElementFreq <- dt.psych.included %>%
  dplyr::select(Affect, Behavior, Cognition, Desire) %>%
  mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  colSums(., na.rm = FALSE, dims = 1) 

# transform to data frame and make row names name variable
EmpElementFreq <- data.frame(Element = names(EmpElementFreq), 
                            Frequency = EmpElementFreq, 
                            Percentage = EmpElementFreq/nrow(dt.psych.included)*100) %>%
  mutate(Element = fct_reorder(Element, Frequency))

# frequency of unique combinations
EmpElementCombFreq <- dt.psych.included %>%
  dplyr::select(Affect, Behavior, Cognition, Desire) %>%
  #mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  group_by(Affect, Behavior, Cognition, Desire) %>%
  summarise(Frequency = n()) %>%
  ungroup() %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T))

# fill replace ones with colnames to be combined
for (i in 1:4) {
    EmpElementCombFreq[[i]] <- str_replace(as.character(EmpElementCombFreq[[i]]), "1", colnames(EmpElementCombFreq)[i])
}

# collect Elements names for each combination
EmpElementCombFreq <- EmpElementCombFreq %>%
  unite("ExperienceCombination",c("Affect", "Behavior", "Cognition", "Desire"), na.rm = TRUE, sep = ", ") %>%
  mutate(ExperienceCombination = fct_reorder(ExperienceCombination, Frequency),
         Percentage = Frequency/nrow(dt.psych.included)*100,
         Affect = ifelse(grepl("Affect", ExperienceCombination, fixed = TRUE), 1,0),
         Behavior = ifelse(grepl("Behavior", ExperienceCombination, fixed = TRUE), 1,0),
         Cognition = ifelse(grepl("Cognition", ExperienceCombination, fixed = TRUE), 1,0),
         Desire = ifelse(grepl("Desire", ExperienceCombination, fixed = TRUE), 1,0)) %>%
  arrange(Frequency)

empComplexity <- EmpElementCombFreq %>%
  select(complexity, Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency),
            Percentage = sum(Frequency)/nrow(dt.psych.included)*100) %>%
  ungroup() %>%
  mutate(complexity = as.factor(complexity),
         complexity = fct_reorder(complexity, Frequency))

# Scale complexity for each element
empElementComplexity <- EmpElementCombFreq %>%
  gather(key = "Element", value = "ElementDum", Affect, Behavior, Cognition, Desire) %>%
  filter(ElementDum == 1) %>%
  group_by(Element) %>%
  summarise(avgComplexity = weighted.mean(x = complexity, w = Frequency),
            sdComplexity = wtd.var(x = complexity, weights = Frequency),
            n = sum(Frequency)) %>%
  ungroup() %>%
  mutate(seComplexity = sdComplexity/sqrt(n))


```

```{r EmpiricalElementCooccurrences, include=F}
# make crossproduct matrix to condense co-occurrences (off-diagonals) and get frequencies (diagonals)
empElementCooccure <- as.matrix(dt.psych.included %>% dplyr::select(Affect, Behavior, Cognition, Desire) %>% mutate_all(~replace(., is.na(.), 0)))
empElementCooccure <- crossprod(empElementCooccure)  # Same as: t(X) %*% X
#diag(empElementCooccure) <- 0       # remove frequencies on diagonals
#empElementCooccure[upper.tri(empElementCooccure)] <- ""

empElementCooccure %>%
  kbl(., 
        #label = "",
        caption = "Empirical Literature: Element Co-occurrence Matrix",
        format = "latex", 
        linesep = "",
        booktabs = T,
        align = rep('c', ncol(empElementCooccure)))  %>%
  kable_styling(position = "left") %>%
  #gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  gsub("\\begin{table}", "\\begin{table}\n\\begin{minipage}[t][\\textheight][t]{\\textwidth}", ., fixed = TRUE) %>% # fix table position
  gsub("\\end{table}", "\\end{minipage}\n\\end{table}", ., fixed = TRUE) %>% # fix table position
  #gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  save_kable("Tables/EmpiricalElementCooccurrences.tex")
```

We assessed the role of experience aspects in the measurement and then compared differences between fields.  

\paragraph{General}In terms of the overall frequencies of experience elements, the broader empirical data mirrored that of the validation studies. Most studies included a measure of cognition (`r round(EmpElementFreq$Percentage[EmpElementFreq$Element=="Cognition"],2)`\%) and behavior (`r round(EmpElementFreq$Percentage[EmpElementFreq$Element=="Behavior"],2)`\%), whereas only about half of all studies included a measure of affect (`r round(EmpElementFreq$Percentage[EmpElementFreq$Element=="Affect"],2)`\%) and less than a fifth of the studies included a measure of desires (`r round(EmpElementFreq$Percentage[EmpElementFreq$Element=="Desire"],2)`\%). Yet, only `r empComplexity$Frequency[empComplexity$complexity=="1"]` studies focused on a single experience aspect ($N_{behavior\ only}$ = `r EmpElementCombFreq$Frequency[EmpElementCombFreq$ExperienceCombination=="Behavior"]`,  $N_{cognition\ only}$ = `r EmpElementCombFreq$Frequency[EmpElementCombFreq$ExperienceCombination=="Cognition"]`, $N_{emotion\ only}$ = `r EmpElementCombFreq$Frequency[EmpElementCombFreq$ExperienceCombination=="Affect"]`). Similarly, only `r empComplexity$Frequency[empComplexity$complexity=="4"]` papers included measures of all four experience aspects (`r round(empComplexity$Percentage[empComplexity$complexity=="4"],2)`\%). Most studies measured three (`r round(empComplexity$Percentage[empComplexity$complexity=="3"],2)`\%) or two aspects (`r round(empComplexity$Percentage[empComplexity$complexity=="2"],2)`\%). Different from the scale validations, within the broader empirical works, most works included measures of emotions, behaviors, and cognitions (\textit{N} = `r EmpElementCombFreq$Frequency[EmpElementCombFreq$ExperienceCombination=="Affect, Behavior, Cognition"]`, `r round(EmpElementCombFreq$Percentage[EmpElementCombFreq$ExperienceCombination=="Affect, Behavior, Cognition"],2)`\%), with a further substantial number of articles measuring behaviors and cognitions (\textit{N} = `r EmpElementCombFreq$Frequency[EmpElementCombFreq$ExperienceCombination=="Behavior, Cognition"]`, `r round(EmpElementCombFreq$Percentage[EmpElementCombFreq$ExperienceCombination=="Behavior, Cognition"],2)`\%. Also see Figure \ref{fig:EmpPlotFreq-1} and Table \ref{tab:EmpiricalElementCooccurrences}). Looking at the number of aspects measured together we again see substantial differences in what kind of scales include the individual aspects. Scales that included cognitions measured an average of `r round(empElementComplexity$avgComplexity[empElementComplexity$Element=="Cognition"],2)` aspects, scales measuring behavior, on average, measured `r round(empElementComplexity$avgComplexity[empElementComplexity$Element=="Behavior"],2)`, while scales that included affect measured an average of `r round(empElementComplexity$avgComplexity[empElementComplexity$Element=="Affect"],2)` experience aspects and scales measuring desires even measured an average of `r round(empElementComplexity$avgComplexity[empElementComplexity$Element=="Desire"],2)` experience aspects. Thus, not a single study measured only motivation (i.e., desires), and measures of desires remained mostly limited to scales that were already measuring many of the other experience aspects. The results exacerbate the pattern found in the scale validations, complex measures and conceptions of acculturation are seen infrequently and exteral aspects of cognition and behavior remain the focus of most studies.

```{r EmpPlotFreq, include=F, fig.width=12, fig.height=12}
# barplot of dimension frequency
EmpABCDBar <- ggplot(data=EmpElementFreq, aes(x=Element, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    #aes(label = paste0("N = ",Frequency)),
    aes(label = paste0(format(round(Percentage,2), nsmall=2), "%")),
    position=position_stack(vjust=0.5),
    color = "white",
    size = 4,
    vjust = 0.5
    ) +
  labs(title = "Element Frequency",
       y = "Frequency across all Scales",
       x = "Experience Element")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=10, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold"),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.position="none")

# barplot of complexity frequency
EmpComplexityBar <- ggplot(data=empComplexity, aes(x=complexity, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    #aes(label = paste0("N = ",Frequency)),
    aes(label = paste0(format(round(Percentage,2), nsmall=2), "%")),
    position=position_stack(vjust=0.5),
    color = "white",
    size = 4,
    vjust = 0.5
    ) +
  labs(title = "Scale Complexity",
       y = "Frequency across all Scales",
       x = "Complexity")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=10, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold"),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.position="none")


# bar plot frequencies
EmpABCDComb <- ggplot(EmpElementCombFreq, aes(x=ExperienceCombination, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    aes(y=Percentage, label = paste0(format(round(Percentage,2), nsmall=2),"% [N = ", Frequency, "]")),
    color = "grey14",
    size = 4,
    hjust = -.1,
    inherit.aes = TRUE
    ) +
  scale_y_continuous(limits = c(0, ceiling(max(EmpElementCombFreq$Percentage)*1.15)),
                     breaks = seq(0, ceiling(max(EmpElementCombFreq$Percentage)*1.15), 5))+
  labs(y = "Proportion of all scales [in %]",
       x = "Combination of Experience Elements")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14"),
        strip.text = element_text(colour = 'white', face="bold"),
        legend.position="none")

# draw combined graph
ggdraw() +
  draw_plot(EmpABCDComb, x = 0, y = 0.3, width = 1, height = .7)+
  draw_plot(EmpABCDBar, x = 0, y = 0, width = .55, height = .3) +
  draw_plot(EmpComplexityBar, x = .55, y = 0, width = .45, height = .3) +
  draw_plot_label(c("(A)", "(B)", "(C)"), c(0, 0, 0.55), c(1, 0.3, 0.3), size = 15)
```



```{r EmpElementComplexityBar, include=F}
# bar plot complexity for each element
ggplot(data=empElementComplexity, aes(x=reorder(Element, avgComplexity), y=avgComplexity)) +
  geom_bar(stat="identity", fill="grey") +
  geom_errorbar(aes(ymin=avgComplexity-1.96*seComplexity, ymax=avgComplexity+1.96*seComplexity), width=.2,position=position_dodge(.9)) +
  geom_text(
    aes(label = paste0("M = ",round(avgComplexity,2))),
    position=position_stack(vjust=0.5),
    color = "black",
    #size = 2.5,
    vjust = 0.5
    ) +
  labs(title = "Scale Complexity by Element [Mean ± 95%CI]",
       y = "Number of Aspects in Scales that include Element",
       x = "Element")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_text(face="bold"),
        axis.title.y = element_text(face="bold"),
        plot.title = element_text(face="bold", hjust = 0.5),
        #legend.text = element_text(size=10),
        #axis.text.x = element_text(size=10),
        #axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        #strip.text = element_text(colour = 'white', face="bold"),
        #panel.background = element_rect(fill = "transparent"),
        #plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.title = element_blank())
```

<!-- Scale  chart goes somewhere here} -->
\begin{figure}[h]
\centering
\caption{Empirical Literature: Bar graph of the experience element combinations.}
\includegraphics[width=\textwidth]{Figures/EmpPlotFreq-1}
\label{fig:EmpPlotFreq-1}
\end{figure}

\input{Tables/EmpiricalElementCooccurrences}  

<!-- Process -->
```{r EmpProcess, include=F}
empMigrationTime <- as.data.frame(summarytools::freq(dt.psych.included$MigrationTime, order = "freq"))
names(empMigrationTime) <- gsub("% ", "Perc", names(empMigrationTime))


empAnalysis <- as.data.frame(summarytools::freq(dt.psych.included$MainAnalysis, order = "freq"))
names(empAnalysis) <- gsub("% ", "Perc", names(empAnalysis))

EmpLong <- sum(empAnalysis[grepl("lagged|longitudinal|dynamic", rownames(empAnalysis)),]$Freq)
EmpLongPerc <- round(sum(empAnalysis[grepl("lagged|longitudinal|dynamic", rownames(empAnalysis)),]$PercValid),2)
```

To assess the process focus of the broader empirical works, we again assessed when in the migration process the data was collected and we additionally assessed the type analysis done by the authors. We found that `r empMigrationTime["post",]$Freq` studies (`r round(empMigrationTime["post",]$PercValid,2)`\%) collected data after the arrival of the migrant in the new society. Two studies targeted potential migrants and `r empMigrationTime["pre & post",]$Freq` studies collected data prior and following the migration event. Moreover, only `r EmpLong` studies included longitudinal data analyses of psychological acculturation (`r EmpLongPerc`\%). This observation, again underscores the arguments that the acculturation literature has thus far failed to provide data that meaningfully captures migration as a process \citep[e.g.,][]{Brown2011, Ward2019}.  

\paragraph{Fields}
To further assess the comparative utility of the experience framework, we further assessed differences of experience aspects between academic fields. We provide more elaborate descriptions of the differences in the methods, and publication types as well as contextual differences in terms of sampling procedures, situational domains, analyses, and cultural contexts in Supplementary Online Material \hl{X}. 

```{r FieldCalc, include=F}
field_labs_shrt <- c(
  'Psychology'="Psych.",
  'Medicine, Nursing, & Health'="Med.",
  'Social Sciences (miscellaneous)'="SocSci.",
  'Multidisciplinary / Crossdisciplinary'="Multi."
)

field_labs_lng <- c(
  'Psychology'="Psychology",
  'Medicine, Nursing, & Health'="Medicine",
  'Social Sciences (miscellaneous)'="Social Sci.",
  'Multidisciplinary / Crossdisciplinary'="Multidiscipl."
)

# Frequency of elements (within each field)
FieldElementFreq <- psychDataDisciplines %>%
  dplyr::select(discipline02, Affect, Behavior, Cognition, Desire) %>%
  gather(Element, Frequency, -discipline02) %>%
  group_by(discipline02, Element) %>%
  summarise_each(funs(sum(., na.rm = TRUE))) %>%
  ungroup() 
FieldN <- as.data.frame(table(discipline02 = psychDataDisciplines$discipline02), responseName = "n")

FieldElementFreq <- merge(FieldElementFreq, FieldN) %>%
  mutate(Percentage = Frequency/n*100)
  
# frequency of unique element combinations (within each field)
FieldElementCombFreq <- psychDataDisciplines %>%
  dplyr::select(Affect, Behavior, Cognition, Desire, discipline02) %>%
  #mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  group_by(Affect, Behavior, Cognition, Desire, discipline02) %>%
  summarise(Frequency = n()) %>%
  ungroup() %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T))

# fill replace ones with colnames to be combined
for (i in 1:4) {
    FieldElementCombFreq[[i]] <- str_replace(as.character(FieldElementCombFreq[[i]]), "1", colnames(FieldElementCombFreq)[i])
}

# collect Elements names for each combination
FieldElementCombFreq <- FieldElementCombFreq %>%
  unite("ExperienceCombination",c("Affect", "Behavior", "Cognition", "Desire"), na.rm = TRUE, sep = ", ") %>%
  group_by(discipline02) %>%
  mutate(ExperienceCombination = fct_reorder(ExperienceCombination, Frequency),
         Percentage = Frequency/sum(Frequency)*100,
         Affect = ifelse(grepl("Affect", ExperienceCombination, fixed = TRUE), 1,0),
         Behavior = ifelse(grepl("Behavior", ExperienceCombination, fixed = TRUE), 1,0),
         Cognition = ifelse(grepl("Cognition", ExperienceCombination, fixed = TRUE), 1,0),
         Desire = ifelse(grepl("Desire", ExperienceCombination, fixed = TRUE), 1,0)) %>%
  arrange(Frequency)

# overall scale complexity (within each field)
FieldComplexity <- FieldElementCombFreq %>%
  select(discipline02, complexity, Frequency, Percentage) %>%
  group_by(discipline02, complexity) %>%
  summarise(Frequency = sum(Frequency),
            Percentage = sum(Percentage)) %>%
  ungroup() %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02"))

FieldAvgComplexity <- FieldElementCombFreq %>%
  group_by(discipline02) %>%
  summarise(n = sum(Frequency),
            avgComplexity = weighted.mean(x = complexity, w = Frequency),
            sdComplexity = wtd.var(x = complexity, weights = Frequency),) %>%
  ungroup() %>%
  mutate(seComplexity = sdComplexity/sqrt(n)) %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02")) %>%
  select(Field = field_labs_lng, n, avgComplexity, sdComplexity, seComplexity)

FieldComplexityAOV <- psychDataDisciplines %>%
  select(Affect, Behavior, Cognition, Desire, discipline02) %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02")) %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T),
         field = field_labs_lng) %>%
  mutate_at(vars(Affect, Behavior, Cognition, Desire), funs(ifelse(. == 1, deparse(substitute(.)), "")))  %>%
  unite("ExperienceCombination",c("Affect", "Behavior", "Cognition", "Desire"), na.rm = TRUE, sep = ", ") %>%
  select(field, ExperienceCombination, complexity) %>%
  aov(data = ., complexity ~ field) %>%
  anova

FieldComplexityKruska <- psychDataDisciplines %>%
  select(Affect, Behavior, Cognition, Desire, discipline02) %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02")) %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T),
         field = field_labs_lng) %>%
  mutate_at(vars(Affect, Behavior, Cognition, Desire), funs(ifelse(. == 1, deparse(substitute(.)), "")))  %>%
  unite("ExperienceCombination",c("Affect", "Behavior", "Cognition", "Desire"), na.rm = TRUE, sep = ", ") %>%
  select(field, ExperienceCombination, complexity) %>%
  kruskal.test(complexity ~ field, data = .)

FieldComplexityPearsonChiSq <- psychDataDisciplines %>%
  select(Affect, Behavior, Cognition, Desire, discipline02) %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02")) %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T),
         field = field_labs_lng) %>%
  tabyl(field, complexity) %>%
  chisq.test

library(effectsize)
FieldComplexityEtaSq <- psychDataDisciplines %>%
  select(Affect, Behavior, Cognition, Desire, discipline02) %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02")) %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T),
         field = field_labs_lng) %>%
  aov(data = ., complexity ~ field) %>%
  effectsize::eta_squared(., ci = 0.95)

# Scale complexity for each element (within each field)
FieldElementComplexity <- FieldElementCombFreq %>%
  gather(key = "Element", value = "ElementDum", Affect, Behavior, Cognition, Desire) %>%
  filter(ElementDum == 1) %>%
  group_by(discipline02, Element) %>%
  summarise(avgComplexity = weighted.mean(x = complexity, w = Frequency),
            sdComplexity = wtd.var(x = complexity, weights = Frequency),
            n = sum(Frequency)) %>%
  ungroup() %>%
  mutate(seComplexity = sdComplexity/sqrt(n)) %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02"))

```

We first assessed the references to affect, behavior, cognition, and desires separately, for each of the disciplines. We find that for all fields desires (`r FieldElementFreq %>% filter(Element == "Desire") %>% select(Percentage) %>% min %>% round(.,2)`-`r FieldElementFreq %>% filter(Element == "Desire") %>% select(Percentage) %>% max %>% round(.,2)`\% of all measures in the field) and emotions (`r FieldElementFreq %>% filter(Element == "Affect") %>% select(Percentage) %>% min %>% round(.,2)`-`r FieldElementFreq %>% filter(Element == "Affect") %>% select(Percentage) %>% max %>% round(.,2)`\%) are the least frequently measured elements and medical journals measure them the least frequently (in proportional terms). Looking at the common cognitive and behavioral elements the proportions diverge between the fields. While the multidisciplinary field measured behaviors (`r FieldElementFreq %>% filter(Element=="Behavior", discipline02=="Multidisciplinary / Crossdisciplinary") %>% select(Percentage) %>% round(.,2)`\%) and cognition (`r FieldElementFreq %>% filter(Element=="Cognition", discipline02=="Multidisciplinary / Crossdisciplinary") %>% select(Percentage) %>% round(.,2)`\%) almost equally often, in the medical and general social science journals behaviors were measured considerably more often than cognitions ($Behavior_{SoSci}$ = `r  FieldElementFreq %>% filter(Element=="Behavior", discipline02=="Social Sciences (miscellaneous)") %>% select(Percentage) %>% round(.,2)`\% > $Cognition_{SoSci}$ = `r  FieldElementFreq %>% filter(Element=="Cognition", discipline02=="Social Sciences (miscellaneous)") %>% select(Percentage) %>% round(.,2)`\%; $Behavior_{Med}$ = `r  FieldElementFreq %>% filter(Element=="Behavior", discipline02=="Medicine, Nursing, & Health") %>% select(Percentage) %>% round(.,2)`\% > $Cognition_{Med}$ = `r  FieldElementFreq %>% filter(Element=="Cognition", discipline02=="Medicine, Nursing, & Health") %>% select(Percentage) %>% round(.,2)`\%). Inversely, in the psychological journals cognitions (`r  FieldElementFreq %>% filter(Element=="Cognition", discipline02=="Psychology") %>% select(Percentage) %>% round(.,2)`\%) were measured more often than behaviors (`r  FieldElementFreq %>% filter(Element=="Behavior", discipline02=="Psychology") %>% select(Percentage) %>% round(.,2)`\%; also see Figure \ref{fig:FieldPlotFreq} B and A). 

When looking at differences in how many different experience aspects were measured together and patterns within these aspect-combinations, differences between the fields become increasingly evident (also see Figure \ref{fig:FieldPlotFreq} A and C). While 'affect, behavior, and cognition' and 'behavior, and cognition' measures are common combinations across all fields, there is less experience complexity and variation for medical and social science fields. There were statistically significant mean differences between the fields in terms of how many experience aspects were considered (parametric: \textit{F}(`r FieldComplexityAOV$Df[1]`, `r FieldComplexityAOV$Df[2]`) = `r round(FieldComplexityAOV[,names(FieldComplexityAOV)=="F value"][1],2)`, \textit{p} = `r round(FieldComplexityAOV[,names(FieldComplexityAOV)=="Pr(>F)"][1],3)`, non-parametric: \textit{Kruskal-Wallis} $\chi^{2}$ = `r round(FieldComplexityKruska$statistic,2)`, \textit{df} = `r FieldComplexityKruska$parameter`, \textit{p} = `r round(FieldComplexityKruska$p.value,3)`, $\eta_{p}^{2}$ = `r round(FieldComplexityEtaSq$Eta2_partial,2)`, 95\%CI[`r round(FieldComplexityEtaSq$CI_low,2)`, `r round(FieldComplexityEtaSq$CI_high,2)`]). Looking at the mean differences in more detail, empirical works published in psychological journals had significantly higher average aspect counts (\textit{M} = `r FieldAvgComplexity %>% filter(Field=="Psychology") %>% select(avgComplexity) %>% round(.,2)`, \textit{SD} = `r FieldAvgComplexity %>% filter(Field=="Psychology") %>% select(sdComplexity) %>% round(.,2)`) than the medical (\textit{M} = `r FieldAvgComplexity %>% filter(Field=="Medicine") %>% select(avgComplexity) %>% round(.,2)`, \textit{SD} = `r FieldAvgComplexity %>% filter(Field=="Medicine") %>% select(sdComplexity) %>% round(.,2)`) and the general social science journals (\textit{M} = `r FieldAvgComplexity %>% filter(Field=="Social Sci.") %>% select(avgComplexity) %>% round(.,2)`, \textit{SD} = `r FieldAvgComplexity %>% filter(Field=="Social Sci.") %>% select(sdComplexity) %>% round(.,2)`; also see Figure \ref{fig:FieldPlotComplexityAverage}). 

```{r FieldPlotComplexityAverage, include=F, fig.width=10, fig.height=8}
# ## ALTERNATE VERSION WITH VIOLIN PLOT
# # Calculate Complexity for every paper
# FieldIndividualComplexity <- psychDataDisciplines %>%
#   dplyr::select(Affect, Behavior, Cognition, Desire, discipline02) %>%
#   #mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
#   mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T)) %>%
#   right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02"))
# 
# library(ggpubr)
# PostHocField <- compare_means(complexity ~ field_labs_lng,  data = FieldIndividualComplexity)
# PostHocFieldFilt <- PostHocField %>% filter(p.adj <=.05)
# my_comparisons <- PostHocFieldFilt %>% select(starts_with("group")) %>% as.matrix(.) %>% split(., seq(nrow(.)))
# 
# ggstatsplot::ggbarstats(
#   data = FieldIndividualComplexity,
#   x = complexity,
#   y = field_labs_lng,
#   #sampling.plan = "jointMulti",
#   results.subtitle = FALSE,
#   proportion.test = FALSE,
#   title = "Measurement Complexity by Discipline",
#   xlab = "Discipline",
#   package = "wesanderson",
#   palette = "Darjeeling2",
#   ggtheme = ggthemes::theme_tufte(base_size = 12),
#   ggplot.component = list(scale_x_discrete(guide = guide_axis(n.dodge = 2))),
#   ggstatsplot.layer = TRUE,
#   label.args = list(check_overlap = TRUE, alpha = 1, fill = "white"),
#   messages = FALSE
# )
# 
# ggplot(FieldIndividualComplexity, aes(y=complexity, x=field_labs_lng, fill=field_labs_lng))+
#   geom_violin(trim = T, width=1) +
#   geom_boxplot(width=0.04,
#                outlier.colour = NULL,
#                outlier.shape = NA,
#                notch=F, fill="black",
#                lwd=1, color="black") +
#   #geom_jitter(width = 0.15,
#   #            shape=18,
#   #            alpha=.5, size=1) +
#   #ggbeeswarm::geom_quasirandom(varwidth = TRUE, alpha = .5)+
#   #ggbeeswarm::geom_beeswarm(size=2,priority='density')+
#   stat_summary(fun.y=mean,
#                geom="point",
#                shape=16,
#                size=1,
#                colour="white") +
#   #stat_summary(fun.data="mean_sdl",
#   #             fun.args = list(mult=1),
#   #             geom="pointrange",
#   #             color = "red",
#   #             width=.2)+
#   stat_summary(geom = "crossbar",
#                width=0.04,
#                fatten=0,
#                color="white",
#                fun.data = function(x){ return(c(y=median(x),
#                                                 ymin=median(x),
#                                                 ymax=median(x))) })+
#   stat_compare_means(label.y = 5)+
#   stat_compare_means(comparisons = my_comparisons, label = "p.signif") +
#   ylab("Number of Elements measured")+
#   xlab("Field") +
#   ggtitle("Distributions Measurement Complexity")+
#   #coord_flip()+
#   scale_fill_brewer(palette = "Pastel1")+
#   scale_y_continuous(breaks = seq(1,4,1))+
#   theme_Publication()+
#   theme(strip.background =element_rect(fill="black", color="black"),
#         strip.text = element_text(colour = 'white', face="bold"),
#         #panel.border = element_rect(color="grey"),
#         legend.position="none")

FieldIndividualComplexity <- psychDataDisciplines %>%
  dplyr::select(Affect, Behavior, Cognition, Desire, discipline02) %>%
  #mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T)) %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02"))

library(ggpubr)
PostHocField <- compare_means(Percentage ~ field_labs_lng,  
                              data = FieldIndividualComplexity %>% mutate(Percentage = complexity), 
                              p.adjust.method = "holm") %>% 
  mutate(p.adj = format.pval(p.adj, digits = 3)) %>% 
  filter(p.adj <=.05) %>%
  mutate(y_pos = seq(1.05, 1+nrow(.)*0.05, by=0.05),
         labels = p.adj)

p <- ggplot(FieldComplexity, aes(y=Percentage, x=field_labs_lng, fill=fct_rev(as.factor(complexity))))+
  geom_bar(position = "fill",stat = "identity", color = "black", width = .9) +
  scale_y_continuous(labels = scales::percent, breaks = seq(0,1,.2)) +
    geom_label(aes(label = paste0(round(Percentage,2),"% [", complexity, "]"), y = Percentage/100),
             position = position_stack(vjust = 0.5),
             size = 4,
             colour = 'black',
             fill = 'white') +
  labs(y = "Complexity",
       x = "Field",
       fill = "Number of Elements Measured") +
  scale_fill_brewer(palette = "YlGnBu")+
  #scale_fill_grey(start = 0.8, end = 0.1) +
  theme_Publication()+
  theme(strip.background =element_rect(fill="black", color="black"),
        strip.text = element_text(colour = 'white', face="bold"))

df_pair <-
  pairwiseComparisons::pairwise_comparisons(
    y = Percentage, 
    x = field_labs_lng,
    data = FieldIndividualComplexity %>% mutate(Percentage = complexity), 
    type = "nonparametric",
    p.adjust.method = "holm"
  )

ggstatsplot:::ggsignif_adder(
  plot = p,
  data = FieldIndividualComplexity %>% mutate(Percentage = complexity/4),
  x = field_labs_lng,
  y = Percentage,
  df_pairwise = df_pair,
  ggsignif.args = list(textsize = 4, tip_length = 0.00025)
)

```

```{r  FieldPlotComplexityAverage1, include=F, fig.width=16, fig.height=9}
## ALTERNATE VERSION WITH VIOLIN PLOT
# Calculate Complexity for every paper
FieldIndividualComplexity <- psychDataDisciplines %>%
  dplyr::select(Affect, Behavior, Cognition, Desire, discipline02) %>%
  #mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T)) %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02"))

library(ggpubr)
PostHocField <- compare_means(complexity ~ field_labs_lng,  data = FieldIndividualComplexity)
PostHocFieldFilt <- PostHocField %>% filter(p.adj <=.05)
my_comparisons <- PostHocFieldFilt %>% select(starts_with("group")) %>% as.matrix(.) %>% split(., seq(nrow(.)))

ggplot(FieldIndividualComplexity, aes(y=complexity, x=reorder(field_labs_lng, complexity), fill=field_labs_lng))+
  stat_summary(fun.y=mean, geom = "point", size = 2) +
  stat_summary(fun.data=mean_cl_normal, geom = "errorbar", width=.07)+
  # geom_violin(trim = T, width=1) +
  # geom_boxplot(width=0.04,
  #              outlier.colour = NULL,
  #              outlier.shape = NA,
  #              notch=F, fill="black",
  #              lwd=1, color="black") +
  # #geom_jitter(width = 0.15,
  # #            shape=18,
  # #            alpha=.5, size=1) +
  # #ggbeeswarm::geom_quasirandom(varwidth = TRUE, alpha = .5)+
  # #ggbeeswarm::geom_beeswarm(size=2,priority='density')+
  # stat_summary(fun.y=mean,
  #              geom="point",
  #              shape=16,
  #              size=1,
  #              colour="white") +
  # stat_summary(geom = "crossbar",
  #              width=0.04,
  #              fatten=0,
  #              color="white",
  #              fun.data = function(x){ return(c(y=median(x),
  #                                               ymin=median(x),
  #                                               ymax=median(x))) })+
  # stat_compare_means(label.y = 5)+
  # stat_compare_means(comparisons = my_comparisons, label = "p.signif") +
  # scale_y_continuous(limits = c(1,5))+
  ylab("Number of Aspects Included")+
  xlab("Field") +
  ggtitle("Number of Aspects by Field")+
  #coord_flip()+
  scale_fill_brewer(palette = "Pastel1")+
  scale_y_continuous(limits = c(1,5), breaks = seq(1,4,1))+
  #coord_fixed(ratio=9/16)+
  theme_Publication()+
  theme(strip.background =element_rect(fill="grey14", color="grey14"),
        strip.text = element_text(colour = 'white', face="bold"),
        #panel.border = element_rect(color="grey"),
        plot.title = element_text(size=18, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=16),
        axis.text.y = element_text(size=16),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)),
        legend.position="none")
```

```{r  FieldPlotComplexityAverage2, include=F, fig.width=16, fig.height=9}
## ALTERNATE VERSION WITH VIOLIN PLOT
# Calculate Complexity for every paper
FieldIndividualComplexity <- psychDataDisciplines %>%
  dplyr::select(Affect, Behavior, Cognition, Desire, discipline02) %>%
  #mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T)) %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02"))

library(ggpubr)
PostHocField <- compare_means(complexity ~ field_labs_lng,  data = FieldIndividualComplexity)
PostHocFieldFilt <- PostHocField %>% filter(p.adj <=.05)
my_comparisons <- PostHocFieldFilt %>% select(starts_with("group")) %>% as.matrix(.) %>% split(., seq(nrow(.)))

ggplot(FieldIndividualComplexity, aes(y=complexity, x=reorder(field_labs_lng, complexity), fill=field_labs_lng))+
  stat_summary(fun.y = mean, geom = "point", size = 2) +
  stat_summary(fun.data=mean_cl_normal, geom = "errorbar", width=.07)+
  geom_violin(trim = T, width=1) +
  geom_boxplot(width=0.04,
               outlier.colour = NULL,
               outlier.shape = NA,
               notch=F, fill="black",
               lwd=1, color="black") +
  #geom_jitter(width = 0.15,
  #            shape=18,
  #            alpha=.5, size=1) +
  #ggbeeswarm::geom_quasirandom(varwidth = TRUE, alpha = .5)+
  #ggbeeswarm::geom_beeswarm(size=2,priority='density')+
  stat_summary(fun.y=mean,
               geom="point",
               shape=16,
               size=2,
               colour="white") +
  stat_summary(geom = "crossbar",
               width=0.04,
               fatten=0,
               color="white",
               fun.data = function(x){ return(c(y=median(x),
                                                ymin=median(x),
                                                ymax=median(x))) })+
  stat_compare_means(label.y = 5)+
  stat_compare_means(comparisons = my_comparisons, label = "p.signif") +
  ylab("Number of Aspects Included")+
  xlab("Field") +
  ggtitle("Number of Aspects by Field")+
  #coord_flip()+
  scale_fill_brewer(palette = "YlGnBu")+
  scale_y_continuous(limits = c(1,5), breaks = seq(1,4,1))+
  #coord_fixed(ratio=9/16)+
  theme_Publication()+
  theme(strip.background =element_rect(fill="grey14", color="grey14"),
        strip.text = element_text(colour = 'white', face="bold"),
        #panel.border = element_rect(color="grey"),
        plot.title = element_text(size=18, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=16),
        axis.text.y = element_text(size=16),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)),
        legend.position="none")
```

\begin{figure}[h]
\centering
\caption{Scale Complexity and their proportional occurences per field.}
\includegraphics[width=\textwidth]{Figures/FieldPlotComplexityAverage-1}
\label{fig:FieldPlotComplexityAverage}
\end{figure}

Further looking at the qualitative differences of aspect combinations can be informative as well. For example, there were a mere `r FieldElementCombFreq %>% ungroup %>% filter(discipline02=="Psychology", ExperienceCombination == "Behavior") %>% select(Frequency)` study published in a psychological journal that conceptualized cultural adaptation by behavior alone --- eventhough this is the most common or second most common conceptualization in the other three fields (also see Figure \ref{fig:FieldPlotFreq} A). There are also interesting pattern when one considers how many other elements an aspect is measured with, within each of the fields. For example, while for all fields motivations are found in the most complex scales \footnote{Except for the broader social science journals that do not have many papers measuring motivation in the first place.}, medical and multidisciplinary journals have a substantially higher average scale complexity when measuring motivations. Inversely, psychological journal on average report behavioral measures of cultural adaptation in more complex scales. This hints to a pattern, where complexity might indicate relative importance of an aspect within the field -- where only scales that already have a broad and diverse measure also include the aspects that are usually measured less within a field (also see Figure \ref{fig:FieldElementComp}). We did not test these differences formally because the number of experience aspects were not independent between scales. There are likely other and more nuanced differences in the conceptualizations highlighted within this analysis (e.g., patterns relevant to a single field). Yet, the broader patterns described here already speak to the utility of the framework. 

```{r FieldPlotFreq, include=F, fig.width=12, fig.height=16}
# barplot of dimension frequency
FieldElementBar <- ggplot(data=FieldElementFreq, aes(x=reorder(Element, Percentage), y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    #aes(label = paste0("N = ",Frequency)),
    aes(label = paste0(format(round(Percentage,1), nsmall=1), "%")),
    position=position_stack(vjust=0.5),
    color = "white",
    size = 3,
    vjust = 0.5
    ) +
  labs(title = "Element Frequency",
       y = "Frequency across all Scales",
       x = "Experience Element")+
  coord_flip()+
  facet_wrap(~discipline02, labeller = as_labeller(field_labs_lng))+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=10, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold"),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.position="none")

# barplot of complexity frequency
FieldComplexityBar <- ggplot(data=FieldComplexity, aes(x=reorder(complexity, -complexity), y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    #aes(label = paste0("N = ",Frequency)),
    aes(label = paste0(format(round(Percentage,1), nsmall=1), "%")),
    position=position_stack(vjust=0.5),
    color = "white",
    size = 3,
    vjust = 0.5
    ) +
  labs(title = "Scale Complexity",
       y = "Frequency across all Scales",
       x = "Complexity")+
  coord_flip()+
  facet_wrap(~discipline02, labeller = as_labeller(field_labs_lng))+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=10, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold"),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.position="none")

# FieldComplexityBar <- ggstatsplot::ggbarstats(
#   data = FieldComplexity,
#   x = complexity,
#   y = field_labs_lng,
#   counts = Frequency,
#   #sampling.plan = "jointMulti",
#   title = "Scale Complexity",
#   sample.size.label = F,
#   #label = "both",
#   xlab = "Discipline",
#   results.subtitle = FALSE,
#   package = "ggsci",
#   palette = "blue_grey_material",
#   ggtheme = ggthemes::theme_tufte(base_size = 12),
#   ggplot.component = list(scale_x_discrete(guide = guide_axis(n.dodge = 2))),
#   ggstatsplot.layer = F,
#   label.args = list(check_overlap = TRUE, alpha = 1, fill = "white"),
#   messages = FALSE
# )+
#   theme_Publication()+
#   theme(legend.position = "right", 
#         legend.direction = "vertical", 
#         legend.title = element_blank(),
#         axis.title.x = element_blank(),
#         plot.title = element_text(size=10, face="bold", hjust = 0.5))

# bar plot frequencies
FieldElementComb <- ggplot(FieldElementCombFreq, aes(x=reorder(ExperienceCombination, Percentage), y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    aes(y=Percentage, label = paste0(round(Percentage,2),"% [N = ", Frequency, "]")),
    color = "grey14",
    size = 4,
    hjust = -.1,
    inherit.aes = TRUE
    ) +
  scale_y_continuous(limits = c(0, ceiling(max(EmpElementCombFreq$Percentage)*1.5)),
                     breaks = seq(0, ceiling(max(EmpElementCombFreq$Percentage)*1.5), 5))+
  labs(y = "Proportion of all scales [in %]",
       x = "Combination of Experience Elements")+
  coord_flip()+
  facet_wrap(~discipline02, labeller = as_labeller(field_labs_lng))+
  theme_Publication()+
  theme(strip.background =element_rect(fill="grey14", color="grey14"),
        strip.text = element_text(colour = 'white', face="bold"),
        legend.position="none")

ggdraw() +
  draw_plot(FieldElementComb, x = 0, y = 0.3, width = 1, height = .7)+
  draw_plot(FieldElementBar, x = 0, y = 0, width = .5, height = .3) +
  draw_plot(FieldComplexityBar, x = .5, y = 0, width = .5, height = .3) +
  draw_plot_label(c("(A)", "(B)", "(C)"), c(0, 0, 0.5), c(1, 0.3, 0.3), size = 15)
```

```{r FieldElementComp, include=F, fig.width=12, fig.height=12}
ggplot(FieldElementComplexity, aes(fill=field_labs_lng, y=avgComplexity, x=reorder(Element, avgComplexity))) + 
  geom_bar(position="dodge", stat="identity") +
  geom_errorbar(aes(ymin=avgComplexity-1.96*seComplexity, ymax=avgComplexity+1.96*seComplexity), width=.2,position=position_dodge(.9)) +
  scale_fill_grey(start = 0.8, end = 0.2) +
  #paletteer::scale_fill_paletteer_d("ggsci::blue_grey_material") +
  labs(x = "Element",
       y = "Number of Aspects",
       title = "Average Number of Elements \nMeasured Together with Element  [Mean ± 95%CI]") +
  #coord_flip()+
  theme_Publication() +
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_text(face="bold"),
        axis.title.y = element_text(face="bold"),
        plot.title = element_text(face="bold", hjust = 0.5),
        #legend.text = element_text(size=10),
        #axis.text.x = element_text(size=10),
        #axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        #panel.grid.major.y = element_blank(),
        #strip.text = element_text(colour = 'white', face="bold"),
        #panel.background = element_rect(fill = "transparent"),
        #plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.title = element_blank())
```

\begin{figure}[h]
\centering
\caption{Combinations of measured experience element and their frequencies per field.}
\includegraphics[width=\textwidth]{Figures/FieldPlotFreq-1}
\label{fig:FieldPlotFreq}
\end{figure}

\begin{figure}[h]
\centering
\caption{Average complexity (number of experience elements measured) for all scales that include a given experience aspect.}
\includegraphics[width=\textwidth]{Figures/FieldElementComp-1}
\caption*{Note that these categories are not mutually exclusive (and thus not independent) because scales can include multiple experience aspects (i.e., higher complexity).}
\label{fig:FieldElementComp}
\end{figure}
<!-- END SECTION -->

\subsection{Theoretical Literature}
We then ran an additional literature search for theories of acculturation...  

\subsubsection{Methods}   
Methods here ...

\subsubsection{Results}
Results here ...  
see Figure \ref{fig:ElementsTheories} and Table \ref{tab:TheoriesElementCooccurrences}

```{r TheoriesElementCalc, include=F}
# Count the times each dimension is measured
TheoElementFreq <- dt.Theories.Included %>%
  dplyr::select(Affect, Behavior, Cognition, Desire) %>%
  mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  colSums(., na.rm = FALSE, dims = 1) 

# transform to data frame and make row names name variable
TheoElementFreq <- data.frame(Element = names(TheoElementFreq), 
                            Frequency = TheoElementFreq, 
                            Percentage = TheoElementFreq/nrow(dt.Theories.Included)*100) %>%
  mutate(Element = fct_reorder(Element, Frequency))

# frequency of unique combinations
TheoElementCombFreq <- dt.Theories.Included %>%
  dplyr::select(Affect, Behavior, Cognition, Desire) %>%
  #mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  group_by(Affect, Behavior, Cognition, Desire) %>%
  summarise(Frequency = n()) %>%
  ungroup() %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T))

# fill replace ones with colnames to be combined
for (i in 1:4) {
    TheoElementCombFreq[[i]] <- str_replace(as.character(TheoElementCombFreq[[i]]), "1", colnames(TheoElementCombFreq)[i])
}

# collect Elements names for each combination
TheoElementCombFreq <- TheoElementCombFreq %>%
  unite("ExperienceCombination",c("Affect", "Behavior", "Cognition", "Desire"), na.rm = TRUE, sep = ", ") %>%
  mutate(ExperienceCombination = fct_reorder(ExperienceCombination, Frequency),
         Percentage = Frequency/nrow(dt.Theories.Included)*100,
         Affect = ifelse(grepl("Affect", ExperienceCombination, fixed = TRUE), 1,0),
         Behavior = ifelse(grepl("Behavior", ExperienceCombination, fixed = TRUE), 1,0),
         Cognition = ifelse(grepl("Cognition", ExperienceCombination, fixed = TRUE), 1,0),
         Desire = ifelse(grepl("Desire", ExperienceCombination, fixed = TRUE), 1,0)) %>%
  arrange(Frequency)

TheoComplexity <- TheoElementCombFreq %>%
  select(complexity, Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency),
            Percentage = sum(Frequency)/nrow(dt.Theories.Included)*100) %>%
  ungroup() %>%
  mutate(complexity = as.factor(complexity),
         complexity = fct_reorder(complexity, Frequency))

# Scale complexity for each element
TheoElementComplexity <- TheoElementCombFreq %>%
  gather(key = "Element", value = "ElementDum", Affect, Behavior, Cognition, Desire) %>%
  filter(ElementDum == 1) %>%
  group_by(Element) %>%
  summarise(avgComplexity = weighted.mean(x = complexity, w = Frequency),
            sdComplexity = wtd.var(x = complexity, weights = Frequency),
            n = sum(Frequency)) %>%
  ungroup() %>%
  mutate(seComplexity = sdComplexity/sqrt(n))
```

```{r TheoriesElementCooccurrences, include=F}
# make crossproduct matrix to condense co-occurrences (off-diagonals) and get frequencies (diagonals)
TheoElementCooccure <- as.matrix(dt.Theories.Included %>% dplyr::select(Affect, Behavior, Cognition, Desire) %>% mutate_all(~replace(., is.na(.), 0)))
TheoElementCooccure <- crossprod(TheoElementCooccure)  # Same as: t(X) %*% X
#diag(TheoElementCooccure) <- 0       # remove frequencies on diagonals
#TheoElementCooccure[upper.tri(TheoElementCooccure)] <- ""

TheoElementCooccure %>%
  kbl(., 
        #label = "",
        caption = "Theoretical Literature: Element Co-occurrence Matrix",
        format = "latex", 
        linesep = "",
        booktabs = T,
        align = rep('c', ncol(TheoElementCooccure)))  %>%
  kable_styling(position = "left") %>%
  #gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  gsub("\\begin{table}", "\\begin{table}\n\\begin{minipage}[t][\\textheight][t]{\\textwidth}", ., fixed = TRUE) %>% # fix table position
  gsub("\\end{table}", "\\end{minipage}\n\\end{table}", ., fixed = TRUE) %>% # fix table position
  #gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  save_kable("Tables/TheoreticalElementCooccurrences.tex")
```

```{r TheoriesFreq, include=F, fig.width=12, fig.height=12}
# barplot of dimension frequency
TheoABCDBar <- ggplot(data=TheoElementFreq, aes(x=Element, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    #aes(label = paste0("N = ",Frequency)),
    aes(label = paste0(format(round(Percentage,2), nsmall=2), "%")),
    position=position_stack(vjust=0.5),
    color = "white",
    size = 4,
    vjust = 0.5
    ) +
  labs(title = "Element Frequency",
       y = "Percentage across all Theories",
       x = "Experience Element")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14"),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=10, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold"),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.position="none")

# barplot of complexity frequency
TheoComplexityBar <- ggplot(data=TheoComplexity, aes(x=complexity, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    #aes(label = paste0("N = ",Frequency)),
    aes(label = paste0(format(round(Percentage,2), nsmall=2), "%")),
    position=position_stack(vjust=0.5),
    color = "white",
    size = 4,
    vjust = 0.5
    ) +
  labs(title = "Scale Complexity",
       y = "Frequency across all Theories",
       x = "Complexity")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=10, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold"),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.position="none")


# bar plot frequencies
TheoABCDComb <- ggplot(TheoElementCombFreq, aes(x=ExperienceCombination, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    aes(y=Percentage, label = paste0(format(round(Percentage,2), nsmall=2),"% [N = ", Frequency, "]")),
    color = "grey14",
    size = 4,
    hjust = -.1,
    inherit.aes = TRUE
    ) +
  scale_y_continuous(limits = c(0, ceiling(max(TheoElementCombFreq$Percentage)*1.15)),
                     breaks = seq(0, ceiling(max(TheoElementCombFreq$Percentage)*1.15), 5))+
  labs(y = "Proportion of all theories [in %]",
       x = "Combination of Experience Elements")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14"),
        strip.text = element_text(colour = 'white', face="bold"),
        legend.position="none")

# draw combined graph
ggdraw() +
  draw_plot(TheoABCDComb, x = 0, y = 0.3, width = 1, height = .7)+
  draw_plot(TheoABCDBar, x = 0, y = 0, width = .55, height = .3) +
  draw_plot(TheoComplexityBar, x = .55, y = 0, width = .45, height = .3) +
  draw_plot_label(c("(A)", "(B)", "(C)"), c(0, 0, 0.55), c(1, 0.3, 0.3), size = 15)
```

\begin{figure}[h]
\centering
\caption{Theories: Bar graph of the experience element combinations.}
\includegraphics[width=\textwidth]{Figures/TheoriesFreq-1}
\label{fig:ElementsTheories}
\end{figure}

\input{Tables/TheoreticalElementCooccurrences}  

\subsection{Compare Literature Levels [to be incorporated with the overall conclusions]}

Compare Theory - Scale - Application levels --- see Figures \ref{fig:CombinedAspects}, \ref{fig:CombinedComplexity}, \ref{fig:CombinedAspectComplexity}.

```{r CombinedABCDBar, include=F, fig.width=16, fig.height=9}
ElementFrequencyAll <- gdata::combine(Theories = TheoElementFreq,
                                      Scales = ScaleElementFreq %>% mutate(Percentage = Percentage*100), 
                                      Empirical = EmpElementFreq)

ggplot(data=ElementFrequencyAll, aes(x=Element, y=Percentage, fill=Element)) +
  geom_bar(position="dodge", stat="identity") +
  geom_text(
    aes(label = paste0(format(round(Percentage,1), nsmall = 1), "%")),
    position = position_dodge(.9),
    size = 5,
    vjust = 0.7,
    color = "Black",
    hjust = -0.08
    #color = "White",
    #hjust = 1.2
    ) +
  labs(title = "Overall Use of Experience Aspect",
       y = "Percentage across all articles",
       x = "Included")+
  facet_wrap(~source)+
  scale_y_continuous(limits = c(0, 100))+
  scale_fill_manual(values=c("grey14", "grey75", "grey75", "grey75"))+
  #scale_fill_brewer(palette="Paired")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14"),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=18, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=16),
        axis.text.y = element_text(size=16),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold", size = 16),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)),
        legend.title = element_blank(),
        legend.key.size = unit(.4, "cm"),
        legend.position="none")
```

```{r CombinedComplexityBar, include=F, fig.width=16, fig.height=9}
Theories <- TheoElementCombFreq %>%
  mutate(Affect = Affect*Frequency,
         Behavior = Behavior*Frequency,
         Cognition = Cognition*Frequency,
         Desire = Desire*Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency), 
            Affect = sum(Affect), 
            Behavior = sum(Behavior), 
            Cognition = sum(Cognition), 
            Desire = sum(Desire)) %>%
  mutate(ABCDTotal = Affect+Behavior+Cognition+Desire, 
         Percentage = Frequency/sum(Frequency)*100,
         AffectProp = Percentage/ABCDTotal*Affect,
         BehaviorProp = Percentage/ABCDTotal*Behavior,
         CognitionProp = Percentage/ABCDTotal*Cognition,
         DesireProp = Percentage/ABCDTotal*Desire,
         sum = AffectProp + BehaviorProp + CognitionProp + DesireProp)

Scales <- ScaleElementCombFreq %>%
  mutate(Affect = Affect*Frequency,
         Behavior = Behavior*Frequency,
         Cognition = Cognition*Frequency,
         Desire = Desire*Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency), 
            Affect = sum(Affect), 
            Behavior = sum(Behavior), 
            Cognition = sum(Cognition), 
            Desire = sum(Desire)) %>%
  mutate(ABCDTotal = Affect+Behavior+Cognition+Desire, 
         Percentage = Frequency/sum(Frequency)*100,
         AffectProp = Percentage/ABCDTotal*Affect,
         BehaviorProp = Percentage/ABCDTotal*Behavior,
         CognitionProp = Percentage/ABCDTotal*Cognition,
         DesireProp = Percentage/ABCDTotal*Desire,
         sum = AffectProp + BehaviorProp + CognitionProp + DesireProp)

Empirical <- EmpElementCombFreq %>%
  mutate(Affect = Affect*Frequency,
         Behavior = Behavior*Frequency,
         Cognition = Cognition*Frequency,
         Desire = Desire*Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency), 
            Affect = sum(Affect), 
            Behavior = sum(Behavior), 
            Cognition = sum(Cognition), 
            Desire = sum(Desire)) %>%
  mutate(ABCDTotal = Affect+Behavior+Cognition+Desire, 
         Percentage = Frequency/sum(Frequency)*100,
         AffectProp = Percentage/ABCDTotal*Affect,
         BehaviorProp = Percentage/ABCDTotal*Behavior,
         CognitionProp = Percentage/ABCDTotal*Cognition,
         DesireProp = Percentage/ABCDTotal*Desire,
         sum = AffectProp + BehaviorProp + CognitionProp + DesireProp)

ComplexityFrequencyAll <- gdata::combine(Theories, Scales, Empirical)

ComplexityFrequencyAllLong <- ComplexityFrequencyAll %>% 
  select(source, complexity, Percentage, AffectProp, BehaviorProp, CognitionProp, DesireProp) %>%
  gather(., Aspect, Proportion, c(AffectProp, BehaviorProp, CognitionProp, DesireProp), factor_key=TRUE) %>%
  mutate(Aspect = gsub("Prop","",Aspect))

ggplot(data=ComplexityFrequencyAllLong, aes(x=reorder(complexity, Proportion), y=Proportion, fill=as.factor(complexity))) +
  geom_bar(position="stack", stat="identity") +
  labs(title = "Number of Experience Aspects Used",
       y = "Percentage across all articles",
       x = "Number of Aspects")+
  scale_y_continuous(limits = c(0, 50))+
  #scale_fill_manual(values=c("#F98F45", "#12908E"))+
  #scale_fill_brewer(palette="YlGnBu")+
  facet_wrap(~source)+
  scale_fill_manual(values = c("grey14", "grey75", "grey75", "grey14")) +
  #scale_fill_brewer(palette="Paired")+
  coord_flip()+
  geom_text(data = ComplexityFrequencyAll, 
            aes(x=reorder(complexity,Percentage), 
                y=Percentage, 
                fill=NULL, 
                label = paste0(format(round(Percentage,1), nsmall = 1), " %")),
    position = position_dodge(.9),
    size = 5,
    vjust = 0.7,
    color = "Black",
    hjust = -0.2
    #color = "White",
    #hjust = 1.2
    ) +
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14"),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=18, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=16),
        axis.text.y = element_text(size=16),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold", size = 16),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)),
        legend.title = element_blank(),
        legend.key.size = unit(.4, "cm"),
        legend.position="none")
```

```{r CombinedComplexityAspectBar, include=F, fig.width=16, fig.height=9}
#                         #
#       OLD VERSION       #
#                         #

Theories <- TheoElementCombFreq %>%
  mutate(Affect = Affect*Frequency,
         Behavior = Behavior*Frequency,
         Cognition = Cognition*Frequency,
         Desire = Desire*Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency), 
            Affect = sum(Affect), 
            Behavior = sum(Behavior), 
            Cognition = sum(Cognition), 
            Desire = sum(Desire)) %>%
  mutate(ABCDTotal = Affect+Behavior+Cognition+Desire, 
         Percentage = Frequency/sum(Frequency)*100,
         AffectProp = Percentage/ABCDTotal*Affect,
         BehaviorProp = Percentage/ABCDTotal*Behavior,
         CognitionProp = Percentage/ABCDTotal*Cognition,
         DesireProp = Percentage/ABCDTotal*Desire,
         sum = AffectProp + BehaviorProp + CognitionProp + DesireProp)

Scales <- ScaleElementCombFreq %>%
  mutate(Affect = Affect*Frequency,
         Behavior = Behavior*Frequency,
         Cognition = Cognition*Frequency,
         Desire = Desire*Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency), 
            Affect = sum(Affect), 
            Behavior = sum(Behavior), 
            Cognition = sum(Cognition), 
            Desire = sum(Desire)) %>%
  mutate(ABCDTotal = Affect+Behavior+Cognition+Desire, 
         Percentage = Frequency/sum(Frequency)*100,
         AffectProp = Percentage/ABCDTotal*Affect,
         BehaviorProp = Percentage/ABCDTotal*Behavior,
         CognitionProp = Percentage/ABCDTotal*Cognition,
         DesireProp = Percentage/ABCDTotal*Desire,
         sum = AffectProp + BehaviorProp + CognitionProp + DesireProp)

Empirical <- EmpElementCombFreq %>%
  mutate(Affect = Affect*Frequency,
         Behavior = Behavior*Frequency,
         Cognition = Cognition*Frequency,
         Desire = Desire*Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency), 
            Affect = sum(Affect), 
            Behavior = sum(Behavior), 
            Cognition = sum(Cognition), 
            Desire = sum(Desire)) %>%
  mutate(ABCDTotal = Affect+Behavior+Cognition+Desire, 
         Percentage = Frequency/sum(Frequency)*100,
         AffectProp = Percentage/ABCDTotal*Affect,
         BehaviorProp = Percentage/ABCDTotal*Behavior,
         CognitionProp = Percentage/ABCDTotal*Cognition,
         DesireProp = Percentage/ABCDTotal*Desire,
         sum = AffectProp + BehaviorProp + CognitionProp + DesireProp)

ComplexityFrequencyAll <- gdata::combine(Theories, Scales, Empirical)

ComplexityFrequencyAllLong <- ComplexityFrequencyAll %>% 
  select(source, complexity, Percentage, AffectProp, BehaviorProp, CognitionProp, DesireProp) %>%
  gather(., Aspect, Proportion, c(AffectProp, BehaviorProp, CognitionProp, DesireProp), factor_key=TRUE) %>%
  mutate(Aspect = gsub("Prop","",Aspect))

ggplot(data=ComplexityFrequencyAllLong, aes(x=reorder(complexity, Proportion), y=Proportion, fill=reorder(Aspect, Proportion))) +
  geom_bar(position="stack", stat="identity") +
  labs(title = "Relative Importance of Aspect per Complexity Level",
       y = "Percentage across all articles",
       x = "Number of Aspects")+
  scale_y_continuous(limits = c(0, 50))+
  scale_fill_grey(start = 0.8, end = 0.1) +
  #scale_fill_manual(values=c("#F98F45", "#12908E"))+
  #scale_fill_brewer(palette="YlGnBu")+
  facet_wrap(~source)+
  #scale_fill_brewer(palette="Paired")+
  coord_flip()+
  geom_text(data = ComplexityFrequencyAll, 
            aes(x=reorder(complexity,Percentage), 
                y=Percentage, 
                fill=NULL, 
                label = paste0(format(round(Percentage,1), nsmall = 1), " %")),
    position = position_dodge(.9),
    size = 5,
    vjust = 0.7,
    color = "Black",
    hjust = -0.2
    #color = "White",
    #hjust = 1.2
    ) +
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14"),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=18, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=16),
        axis.text.y = element_text(size=16),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold", size = 16),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)),
        legend.title = element_blank(),
        legend.key.size = unit(.4, "cm"),
        legend.position="bottom")
```

```{r CombinedAspectComplexityBar, include=F, fig.width=16, fig.height=9}
Theories <- TheoElementCombFreq %>% 
  mutate(ExperienceCombination = strsplit(as.character(ExperienceCombination), ", ")) %>% 
  unnest(ExperienceCombination) %>%
  group_by(ExperienceCombination, complexity) %>%
  summarise(Frequency = sum(Frequency)) %>%
  mutate(AspectTotal = sum(Frequency), 
         Proportion = Frequency/AspectTotal,
         Percentage = Frequency/sum(Frequency)*100)

Scales <- ScaleElementCombFreq %>%
  mutate(ExperienceCombination = strsplit(as.character(ExperienceCombination), ", ")) %>% 
  unnest(ExperienceCombination) %>%
  group_by(ExperienceCombination, complexity) %>%
  summarise(Frequency = sum(Frequency)) %>%
  mutate(AspectTotal = sum(Frequency), 
         Proportion = Frequency/AspectTotal,
         Percentage = Frequency/sum(Frequency)*100)

Empirical <- EmpElementCombFreq %>%
  mutate(ExperienceCombination = strsplit(as.character(ExperienceCombination), ", ")) %>% 
  unnest(ExperienceCombination) %>%
  group_by(ExperienceCombination, complexity) %>%
  summarise(Frequency = sum(Frequency)) %>%
  mutate(AspectTotal = sum(Frequency), 
         Proportion = Frequency/AspectTotal,
         Percentage = Frequency/sum(Frequency)*100)

ComplexityFrequencyAll <- gdata::combine(Theories, Scales, Empirical)

# ComplexityFrequencyAllLong <- ComplexityFrequencyAll %>% 
#   select(source, complexity, Percentage, AffectProp, BehaviorProp, CognitionProp, DesireProp) %>%
#   gather(., Aspect, Proportion, c(AffectProp, BehaviorProp, CognitionProp, DesireProp), factor_key=TRUE) %>%
#   mutate(Aspect = gsub("Prop","",Aspect))

ggplot(data=ComplexityFrequencyAll, aes(x=reorder(ExperienceCombination, AspectTotal), y=Percentage, fill=forcats::fct_rev(as.factor(complexity)))) +
  geom_bar(position="stack", stat="identity") +
  labs(title = "Complexity Proportions for each Experience Aspect",
       y = "Percentage across all articles",
       x = "Number of Aspects")+
  scale_y_continuous(limits = c(0, 100))+
  scale_fill_grey(start = 0.1, end = 0.8) +
  #scale_fill_manual(values=c("#F98F45", "#12908E"))+
  #scale_fill_brewer(palette="YlGnBu")+
  facet_wrap(~source)+
  #scale_fill_brewer(palette="Paired")+
  coord_flip()+
  # geom_text(data = ComplexityFrequencyAll, 
  #           aes(x=reorder(complexity,Percentage), 
  #               y=Percentage, 
  #               fill=NULL, 
  #               label = paste0(format(round(Percentage,1), nsmall = 1), " %")),
  #   position = position_dodge(.9),
  #   size = 5,
  #   vjust = 0.7,
  #   color = "Black",
  #   hjust = -0.2
  #   #color = "White",
  #   #hjust = 1.2
  #   ) +
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14"),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=18, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=16),
        axis.text.y = element_text(size=16),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold", size = 16),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)),
        legend.title = element_blank(),
        legend.key.size = unit(.4, "cm"),
        legend.position="bottom")
```

\begin{figure}[h]
\centering
\caption{Literaure Levels: Bar graph of the experience aspect frequencies for theoretical, methodological, and broader empirical literature.}
\includegraphics[width=\textwidth]{Figures/CombinedABCDBar-1}
\label{fig:CombinedAspects}
\end{figure}

\begin{figure}[h]
\centering
\caption{Literaure Levels: Bar graph of the number of experience aspects used for theoretical, methodological, and broader empirical literature.}
\includegraphics[width=\textwidth]{Figures/CombinedComplexityBar-1}
\label{fig:CombinedComplexity}
\end{figure}

\begin{figure}[h]
\centering
\caption{Literaure Levels: Bar graph showing the relative importance of the complexity level within each of the experience aspects for theoretical, methodological, and broader empirical literature.}
\includegraphics[width=\textwidth]{Figures/CombinedAspectComplexityBar-1}
\label{fig:CombinedAspectComplexity}
\end{figure}
