---
output: latex_fragment
editor_options:
  chunk_output_type: console
bibliography: references.bib
csl: apa.csl
---

```{r setup, include=FALSE}
# R Studio Clean-Up
  cat("\014") # clear console
  #rm(list=ls()) # clear workspace - use restart R instead
  gc() # garbage collector
  
# Install and Load Packages
lib <- c("rmarkdown", "knitr", "citr", "remedy", "bookdown", "papaja", "rmdfiltr", "psych",
         "ggplot2", "ggthemes", "haven", "RColorBrewer", "plotly", "forcats", "wordcloud", "visNetwork", "ggwordcloud",
         "rworldmap", "rnaturalearth", "rnaturalearthdata", "rgeos", "sp", "ggspatial",
         "data.table", "dplyr", "tidyr", "Hmisc", "kableExtra", "readxl", "stringr", "stringi", "reshape2",
         "tibble", "sqldf", "networkD3", "GGally", "ggstatsplot","hrbrthemes",
         "mada", "naniar", "stats", "matrixStats", "ISOcodes", "pander", "lubridate", "gsheet",
         "DiagrammeR", "janitor", "DiagrammeRsvg", "rsvg")
invisible(lapply(lib, library, character.only = TRUE))  
rm(lib)  

# Load Custom Packages  
  source("./scripts/functions/fun.panel.R")
  source("./scripts/functions/themes.R")
  source("./scripts/functions/prismaGraph.R")

# Markdown Options
  knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file()) # set working directory
  knitr::opts_knit$get("root.dir") # check working directory
  options(scipen = 999, digits = 4, width = 400) #removes scientific quotation

# Global Chunk Options
  knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='Figures/',
                      echo=FALSE, warning=FALSE, message=FALSE)
```

```{r import}
load("data/wrangled.RData")
```

\subsection{Methodological Literature}  
Based on the systematic review and its coding, the first data set we assess is a database of scale validations. We bring together the scales suggested in previous reviews as well as validation studies we identified in our own review. Throughout our literature review we found five major works that reviewed the measurement of acculturation \citep{Celenk2011, Maestas2000, Matsudaira2006, Wallace2010, Zane2004}. After the removal of duplicate scales, we added any scale validation that was present in our own systematic review but not included in the previous reviews. For each measure we extracted the full item list as well as the item scoring prior to coding. A comprehensive and interactive database of the scales, with reference- and publication information, as well as our experience elements and -context coding is available in our online supplementary information as well as on our open science repository (OSF and/or github citation here).  

\subsubsection{Methods}  
Taken together these five reviews collected a total of `r nrow(dt.Scales[dt.Scales$Review != "own",])` scales, of which `r nrow(dt.Scales[dt.Scales$Duplicate == "Duplicate" & dt.Scales$Review != "own",])` were duplicates. From our own review we added `r nrow(dt.Scales[dt.Scales$Review == "own review",])` additional validation studies. After removing duplicates this meant that we considered a total of `r nrow(dt.Scales[dt.Scales$Duplicate == "Unique",])` unique scales for our coding. Of these scales we ultimately had to exclude `r nrow(dt.Scales[!is.na(dt.Scales$Comment),])`, because they were either not accessible or did not fit the the topic of our review (see Table \ref{tab:ScalesExclusion}). The scales had an average of \hl{X.XX} items and \hl{X.XX} sub-scales. Most items were rated on a five-point (\hl{XX.XX}\%) or four-point likert-type scale (\hl{XX.XX}\%), with only \hl{X} scales including categorical ratings. About a fifth of scales (`r dt.Scales %>% filter(IncludesMajority == 1, Duplicate == "Unique") %>% nrow(.)/nrow(dt.Scales[dt.Scales$Duplicate=="Unique",])*100 %>% round(.,2)`\%) included majority group members in their validation studies. The earliest included validation was from `r min(dt.Scales$year, na.rm = T)` with a majority of scales being validated around the turn of the 21\textsuperscript{st} century and the latest included validation study in `r max(dt.Scales$year, na.rm = T)`.  

```{r ScalesExclusion}
data.frame(table(Exclusion = dt.Scales$Comment)) %>%
  arrange(desc(Freq)) %>%
  kable(., 
        #label = "",
        caption = "Scales Exclusion Reasons",
        format = "latex",
        col.names = c("Exclusion Reason",
                      "Frequency"), 
        linesep = "",
        booktabs = T,
        align = c("l", "c"))  %>%
  kable_styling(latex_options = c("repeat_header"),
                position = "left") %>%
  #gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  save_kable("Tables/ScalesExclusion.tex")
```

\input{Tables/ScalesExclusion}  

\subsubsection{Results}
For the literature on scale validations, we assessed both the role of experience elements in the measures as well as contextual differences. 

\paragraph{Experience}
```{r ABCDCalc, include=F}
# Count the times each dimension is measured
ScaleElementFreq <- dt.Scales.Included %>%
  dplyr::select(Affect, Behavior, Cognition, Desire) %>%
  mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  colSums(., na.rm = FALSE, dims = 1) 

# transform to data frame and make row names name variable
ScaleElementFreq <- data.frame(Element = names(ScaleElementFreq), 
                            Frequency = ScaleElementFreq, 
                            Percentage = ScaleElementFreq/nrow(dt.Scales.Included)) %>%
  mutate(Element = fct_reorder(Element, Frequency))

# frequency of unique combinations
ScaleElementCombFreq <- dt.Scales.Included %>%
  dplyr::select(Affect, Behavior, Cognition, Desire) %>%
  #mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  group_by(Affect, Behavior, Cognition, Desire) %>%
  summarise(Frequency = n()) %>%
  ungroup() %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T))

# fill replace ones with colnames to be combined
for (i in 1:4) {
    ScaleElementCombFreq[[i]] <- str_replace(as.character(ScaleElementCombFreq[[i]]), "1", colnames(ScaleElementCombFreq)[i])
}

# collect Elements names for each combination
ScaleElementCombFreq <- ScaleElementCombFreq %>%
  unite("ExperienceCombination",c("Affect", "Behavior", "Cognition", "Desire"), na.rm = TRUE, sep = ", ") %>%
  mutate(ExperienceCombination = fct_reorder(ExperienceCombination, Frequency),
         Percentage = Frequency/nrow(dt.Scales.Included)*100,
         Affect = ifelse(grepl("Affect", ExperienceCombination, fixed = TRUE), 1,0),
         Behavior = ifelse(grepl("Behavior", ExperienceCombination, fixed = TRUE), 1,0),
         Cognition = ifelse(grepl("Cognition", ExperienceCombination, fixed = TRUE), 1,0),
         Desire = ifelse(grepl("Desire", ExperienceCombination, fixed = TRUE), 1,0))

scaleComplexity <- ScaleElementCombFreq %>%
  select(complexity, Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency),
            Percentage = sum(Frequency)/nrow(dt.Scales.Included)*100) %>%
  ungroup() %>%
  mutate(complexity = as.factor(complexity),
         complexity = fct_reorder(complexity, Frequency))

elementComplexity <- data.frame(Element = c("Affect", "Behavior", "Cognition", "Desire"), 
                                avgComplexity = c(ScaleElementCombFreq %>% filter(Affect == 1) %>% weighted.mean(x = .$complexity, w = .$Frequency), 
                                                  ScaleElementCombFreq %>% filter(Behavior == 1) %>% weighted.mean(x = .$complexity, w = .$Frequency), 
                                                  ScaleElementCombFreq %>% filter(Cognition == 1) %>% weighted.mean(x = .$complexity, w = .$Frequency), 
                                                  ScaleElementCombFreq %>% filter(Desire == 1) %>% weighted.mean(x = .$complexity, w = .$Frequency)))
```

With our main aim of examining the experience structure within the scales, we examined whether scales included a specific experience elements but also examined the used elements in their complex combinations. In terms of general inclusion of elements, most studies included a measure of cognition (`r round(ScaleElementFreq$Percentage[ScaleElementFreq$Element=="Cognition"]*100,2)`\%) and behavior (`r round(ScaleElementFreq$Percentage[ScaleElementFreq$Element=="Behavior"]*100,2)`\%), whereas only roughly half the studies included a measure of affect (`r round(ScaleElementFreq$Percentage[ScaleElementFreq$Element=="Affect"]*100,2)`\%) and only a fourth of the scales included a measure of motives (`r round(ScaleElementFreq$Percentage[ScaleElementFreq$Element=="Desire"]*100,2)`\%). However, only a minority of scales included only a single dimension. There were only `r ScaleElementCombFreq$Frequency[ScaleElementCombFreq$ExperienceCombination=="Cognition"]` scales that exclusively relied on cognitions (`r round(ScaleElementCombFreq$Percentage[ScaleElementCombFreq$ExperienceCombination=="Cognition"],2)`\%) and `r ScaleElementCombFreq$Frequency[ScaleElementCombFreq$ExperienceCombination=="Behavior"]` scales that measured only behaviors (`r round(ScaleElementCombFreq$Percentage[ScaleElementCombFreq$ExperienceCombination=="Behavior"],2)`\%). Yet, inversely, there were also only `r ScaleElementCombFreq$Frequency[ScaleElementCombFreq$ExperienceCombination=="Affect, Behavior, Cognition, Desire"]` scales that measured all four dimensions (`r round(ScaleElementCombFreq$Percentage[ScaleElementCombFreq$ExperienceCombination=="Affect, Behavior, Cognition, Desire"],2)`\%). Most studies measured two (`r ScaleElementCombFreq %>% filter(complexity == 2) %>% select(Frequency) %>% summarise(Perc = round(sum(.)/nrow(dt.Scales.Included)*100, 2))`\%) or three (`r ScaleElementCombFreq %>% filter(complexity == 3) %>% select(Frequency) %>% summarise(Perc = round(sum(.)/nrow(dt.Scales.Included)*100, 2))`\%) dimensions. A majority of scales either measured behavioral and cognitive elements (`r round(ScaleElementCombFreq$Percentage[ScaleElementCombFreq$ExperienceCombination=="Affect, Behavior, Cognition"],2)`\%) or behavioral, cognitive, and affective elements (`r round(ScaleElementCombFreq$Percentage[ScaleElementCombFreq$ExperienceCombination=="Behavior, Cognition"],2)`\%; also see Figure \ref{fig:ElementsScales}). Looking at the number of elements measured together we also see substantial differences in what kind of scales include a certain element. Scales that included cognitions measured an average of `r round(elementComplexity$avgComplexity[elementComplexity$Element=="Cognition"],2)` elements, scales measuring behavior, on average, measured a `r round(elementComplexity$avgComplexity[elementComplexity$Element=="Behavior"],2)`, while scales that included affect measures had a complexity average of `r round(elementComplexity$avgComplexity[elementComplexity$Element=="Affect"],2)` and scales measuring motivation even measured an average of `r round(elementComplexity$avgComplexity[elementComplexity$Element=="Desire"],2)` scales. Thus, most scales measure multiple dimensions, yet they focus on easily accessible dimensions (i.e., behavior and cognition), less of what is considered 'less accessible' or 'subjective' (i.e., affect and desires). This is also visible in the circumstance that there were no scales that exclusively measured motivational or emotional adaptation (while this was the case for both cognitions and behaviors). And if emotional or motivational aspects were measured they were on average measured in scales that were already more complex (i.e., included more experience elements). 

```{r  ABCDFreq, include=F}
# barplot of dimension frequency
ScaleABCDBar <- ggplot(data=ScaleElementFreq, aes(x=Element, y=Frequency)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    aes(label = paste0("N = ",Frequency)),
    position=position_stack(vjust=0.5),
    color = "white",
    size = 2.5,
    vjust = 0.5
    ) +
  labs(title = "Element Frequency",
       y = "Frequency across all Scales",
       x = "Experience Element")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=10, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold"),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.position="none")

# barplot of complexity frequency
ScaleComplexityBar <- ggplot(data=scaleComplexity, aes(x=complexity, y=Frequency)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    aes(label = paste0("N = ",Frequency)),
    position=position_stack(vjust=0.5),
    color = "white",
    size = 2.5,
    vjust = 0.5
    ) +
  labs(title = "Scale Complexity",
       y = "Frequency across all Scales",
       x = "Complexity")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=10, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold"),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.position="none")


# bar plot frequencies
ScaleABCDComb <- ggplot(ScaleElementCombFreq, aes(x=ExperienceCombination, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    aes(y=Percentage, label = paste0(round(Percentage,2),"% [N = ", Frequency, "]")),
    color = "grey14",
    size = 4,
    hjust = -.1,
    inherit.aes = TRUE
    ) +
  scale_y_continuous(limits = c(0, ceiling(max(ScaleElementCombFreq$Percentage)*1.1)),
                     breaks = seq(0, ceiling(max(ScaleElementCombFreq$Percentage)*1.1), 5))+
  labs(y = "Proportion of all scales [in %]",
       x = "Combination of Experience Elements")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background =element_rect(fill="grey14", color="grey14"),
        strip.text = element_text(colour = 'white', face="bold"),
        legend.position="none")

ScaleABCDComb + 
  annotation_custom(
    ggplotGrob(ScaleABCDBar), 
    xmin = 0.5, xmax = 5, ymin = 18, ymax = 30
  ) +
  annotation_custom(
    ggplotGrob(ScaleComplexityBar), 
    xmin = 0.5, xmax = 5, ymin = 8, ymax = 18
  )
```

<!-- Scale  chart goes somewhere here} -->
\begin{figure}[h]
\centering
\caption{Bar graph of the experience element combinations.}
\includegraphics[width=\textwidth]{Figures/ABCDFreq-1}
\label{fig:ElementsScales}
\end{figure}

END SECTION
