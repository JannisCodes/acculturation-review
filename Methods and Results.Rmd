---
output: latex_fragment
editor_options:
  chunk_output_type: console
bibliography: references.bib
csl: apa.csl
---

```{r setup, include=FALSE}
# R Studio Clean-Up
  cat("\014") # clear console
  #rm(list=ls()) # clear workspace - use restart R instead
  gc() # garbage collector
  
# Install and Load Packages
lib <- c("rmarkdown", "knitr", "remedy", "bookdown", "rmdfiltr", "psych",
         "ggplot2", "ggthemes", "haven", "RColorBrewer", "plotly", "forcats", "wordcloud", "visNetwork", "ggwordcloud", "gridExtra",
         "webshot2", "sessioninfo", "summarytools","ggpubr",
         "data.table", "dplyr", "tidyr", "Hmisc", "kableExtra", "readxl", "stringr", "stringi", "reshape2",
         "tibble", "sqldf", "networkD3", "GGally", "ggstatsplot","hrbrthemes", "patchwork", "cowplot",
         "mada", "naniar", "stats", "matrixStats", "ISOcodes", "pander", "lubridate", "gsheet",
         "DiagrammeR", "janitor", "DiagrammeRsvg", "rsvg", "manipulateWidget", "htmlwidgets", "boot")
invisible(lapply(lib, library, character.only = TRUE))  
rm(lib)  

# Load Custom Packages  
  source("./scripts/functions/fun.panel.R")
  source("./scripts/functions/themes.R")
  source("./scripts/functions/prismaGraph.R")
  source("./scripts/functions/binaryCor.R")
  source("./scripts/functions/kappa.R")

# Markdown Options
  knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file()) # set working directory
  knitr::opts_knit$get("root.dir") # check working directory
  options(scipen = 999, digits = 4, width = 400) #removes scientific quotation

# Global Chunk Options
  knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='Figures/',
                      echo=FALSE, warning=FALSE, message=FALSE)
```

```{r import}
load("data/wrangled.RData")
```

```{=tex}
\newcommand{\nTheo}{`r nrow(dt.Theories.Included)`}
\newcommand{\nMeth}{`r nrow(dt.Scales.Included)`}
\newcommand{\nEmp}{`r nrow(dt.Empirical.included)`}
```
To assess the past empirical and theoretical literature on psychological acculturation, we performed a systematic scoping review. We first read seminal and review works within the field \citep[including,][]{Ward2019, Berry1997b, Berry2003, Szapocznik1978, Sam2006a, Rudmin2003a}. Based on our reading of the literature, we designed a comprehensive literature search strategy in an iterative fashion. For the empirical work on acculturation we performed a literature search on March 4\textsuperscript{th}, 2020 and February 14\textsuperscript{th}, 2021, within the "APA PsycINFO" bibliographic databases using the EBSCO\textit{host} provider. The databases also included the PsycARTICLES, PsycBOOKS, and PsycCRITIQUES databases as well ProQuest Dissertations with psychological relevance (for the full information on the search strategy see \hyperref[app:AppendixSearchStrategy]{Appendix \ref*{app:AppendixSearchStrategy}}.

Together with past reviews, we used this literature search to identify validated scales as well as empirical works more generally. For the theoretical literature we collected the theories used in the empirical works and performed an additional, more specific, search of the same databases as well as the Web of Science Core Collection using the Clarivate Analytics provider on March 3\textsuperscript{rd}, 2021 (for full information see \hyperref[app:AppendixSearchStrategy]{Appendix \ref*{app:AppendixSearchStrategy}}).

From the literature searches we created three separate databases of theoretical, psychometric, and applied empirical works on psychological acculturation. For each literature search, we downloaded all references and abstracts, which two independent coders screened for relevance after duplicate removal --- first based on the titles and then based on the abstracts. We downloaded all relevant and available works for full-text coding. For all three types of works we extracted a range of variables to apply our framework. The full coding process and data extraction are described in the coding manual (Supplemental Material B), as part of the full annotated analyses (Supplemental Material C) as well as in our open science repositories \citep[see][]{Kreienkamp2021d, Kreienkamp2021e}.

\subsection{Theoretical Literature}

```{r TheoryExclusion, include=F}
# duplicate
dt.TheorySearch.unique <- dt.TheorySearch %>%
  filter(DuplicateAny != "TRUE")

# title screening
dt.TheorySearch.title <- dt.TheorySearch %>%
  filter(TitleScreening == 1)

# abstract screening
dt.TheorySearch.abstract <- dt.TheorySearch %>%
  filter(TitleScreening == 1,
         AbstractScreening == 1)

# full-text inclusion
dt.TheorySearch.included <- dt.TheorySearch %>%
  filter(TitleScreening == 1,
         AbstractScreening == 1,
         Extracted == 1)

# added from empirical literature
dt.TheorySearch.added <- nrow(dt.Theories.Included)-nrow(dt.TheorySearch.included)

## reasons for exclusion ##
# title exclusion reason
theoryExclTitle <- data.frame(table(Exclusion = dt.TheorySearch$TitleNote)) %>%
  mutate(screening = "Title") %>%
  arrange(desc(Freq))

# abstract exclusion reason
theoryExclAbstract <- data.frame(table(Exclusion = dt.TheorySearch$AbstractNote)) %>%
  mutate(screening = "Abstract") %>%
  arrange(desc(Freq))

# full text exclusion reason
theoryExclFull <- data.frame(table(Exclusion = dt.TheorySearch$ExtractedReason)) %>%
  mutate(screening = "Full Text") %>%
  arrange(desc(Freq))

rbind(theoryExclTitle, theoryExclAbstract, theoryExclFull) %>%
  reshape(., idvar = "Exclusion", timevar = "screening", direction = "wide") %>%
  mutate_if(is.numeric, ~replace(., is.na(.), "")) %>%
  rename_at(vars(starts_with("Freq.")),
            funs(sub("Freq[.]", "", .))) %>%
  rename(., "Exclusion Reason" = Exclusion) %>%
  kbl(., 
        #label = "",
        caption = "Exclusion Reasons Theoretical Literature",
        format = "latex",
        linesep = "",
        booktabs = T,
        align = c("l", "c", "c", "c"))  %>%
  add_header_above(., c(" ", "Screening" = 3)) %>%
  kable_styling(position = "left") %>%
  #gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  gsub("\\begin{table}", "\\begin{table}\n\\begin{minipage}[t][\\textheight][t]{\\textwidth}", ., fixed = TRUE) %>% # fix table position
  gsub("\\end{table}", "\\end{minipage}\n\\end{table}", ., fixed = TRUE) %>% # fix table position
  save_kable("Tables/TheoreticalExclusion.tex")

theoryExclCombined <- rbind(theoryExclTitle, theoryExclAbstract, theoryExclFull) %>%
  reshape(., idvar = "Exclusion", timevar = "screening", direction = "wide") %>%
  mutate_if(is.numeric, ~replace(., is.na(.), "")) %>%
  rename_at(vars(starts_with("Freq.")),
            funs(sub("Freq[.]", "", .))) %>%
  rename(., "Exclusion Reason" = Exclusion)
```

```{r PrismaTheories, include=F}
prismaGr(found = nrow(dt.TheorySearch),
         found_other = dt.TheorySearch.added,
         no_dupes = nrow(dt.TheorySearch.unique)+dt.TheorySearch.added, 
         screened = nrow(dt.TheorySearch.unique)+dt.TheorySearch.added, 
         screen_exclusions = nrow(dt.TheorySearch.unique)-nrow(dt.TheorySearch.abstract), 
         full_text = nrow(dt.TheorySearch.abstract)+dt.TheorySearch.added,
         full_text_exclusions = nrow(dt.TheorySearch.abstract)-nrow(dt.TheorySearch.included), 
         qualitative = nrow(dt.Theories.Included), 
         #quantitative = nrow(dt.Theories.Included), 
         extra_dupes_box = F,
         width = 800, height = 800) %>%
  export_svg() %>%
  charToRaw %>% 
  rsvg_pdf("./Figures/PRISMA_Theories.pdf")
```

The most abstract level of our review was concerned with how researchers conceptualized psychological acculturation in their theoretical work. Our theory-specific literature search produced a total of `r nrow(dt.TheorySearch)` results from which we identified `r nrow(dt.TheorySearch.included)` theories. From our review of the empirical literature, we added an additional `r dt.TheorySearch.added` theories (total N = `r nrow(dt.Theories.Included)`, for exclusion reasons, see \tblref{tab:ExclusionsCombined} and for the PRISMA diagram see \fgrref[ A]{fig:PrismaCombined}. A full table of all theories, with references, and final coding is available in our Supplemental Material C as well as on our open science repository \citep[see][]{Kreienkamp2021d, Kreienkamp2021e}.

<!-- \begin{figure}[h] -->

<!-- \centering -->

<!-- \caption{PRISMA Diagram Theoretical Literature. Currently generated in R based on n(row) maybe make prettier.} -->

<!-- \includegraphics[width=\textwidth]{Figures/PRISMA_Theories} -->

<!-- \label{fig:PRISMA_Theories} -->

<!-- \end{figure} -->

\input{Tables/ExclusionsCombined}

<!-- Placing this here is not ideal because it is only being created later but probably works. -->

<!-- \input{Tables/TheoreticalExclusion} -->

```{=tex}
\subsubsection{Methods}
\paragraph{Dataset}
```
The authors of the `r nrow(dt.Theories.Included)` included theoretical works self-categorized their contributions as a theoretical conceptualization (\textit{N} = `r nrow(dt.Theories.Included %>% filter(FrameworkTheoryModel=="Conceptualization"))`), theoretical framework (\textit{N} = `r nrow(dt.Theories.Included %>% filter(FrameworkTheoryModel=="Framework"))`), theory (\textit{N} = `r nrow(dt.Theories.Included %>% filter(FrameworkTheoryModel=="Theory"))`), or theoretical model (\textit{N} = `r nrow(dt.Theories.Included %>% filter(FrameworkTheoryModel=="Model"))`). Looking at the types of theory building, a majority of proposals were purely theoretical (N = `r nrow(dt.Theories.Included %>% filter(SourceType=="theoretical"))`) with the remaining theoretical works growing out of qualitative investigations (such as grounded theory approaches; N = `r nrow(dt.Theories.Included %>% filter(SourceType=="empirical"))`).

\paragraph{Experience Aspects}

```{r TheoriesKappa, include=F}
names <- c("Affect", "Behavior", "Cognition", "Desire")
kTheo <- dt.Theories.Included %>%
  select(Affect, Affect2, Behavior, Behavior2, Cognition, Cognition2, Desire, Desire2) %>%
  mutate_all(~replace_na(., 0)) %>%
  kappa.full.multiple(., names)
kTheoPooled <- kappa.pooled2(kTheo)
```

```{r TheoreticalExperienceRecode}
# store first coder under suffix "1" and then re-code the "Final" suffixed into the plain ABCD.
dt.Theories.Included <- dt.Theories.Included %>%
  mutate(Affect1 = Affect, Behavior1 = Behavior, Cognition1 = Cognition, Desire1 = Desire) %>%
  mutate(Affect = AffectFinal, Behavior = BehaviorFinal, Cognition = CognitionFinal, Desire = DesireFinal)
```

To assess the experience aspects that were considered as part of the theoretical works, two independent coders coded the authors' axioms, theorems, and model elements for self-identified inclusions of affects, behaviors, cognitions, and desires (all inter-rater agreements were `r format(round(min(kTheo$Po, na.rm = TRUE)*100, 2), nsmall=2)`% or above and all Cohen's $\varkappa$s were above `r format(round(min(kTheo$k, na.rm = TRUE), 2), nsmall=2)`, $\varkappa_{pooled}$ = `r format(round(kTheoPooled$k.pooled, 2), nsmall=2)`; for full inter-rater reliability see Supplemental Material C). We only coded explicit mentions by the authors and we did so on three different levels. An example of these three levels for affect would be phrases of "mood" or "emotions" (construct level), "anxiety" or "pride" (concept level), and "the migrant feels ..." (operationalization level). A list with further examples can be found in \tblref{tab:AspectExamples} and a full description of the coding is available through our coding protocol (see Supplemental Material B).

\paragraph{Process}

To assess the focus on psychological acculturation as a process or an outcome, we coded whether authors self-identified the theory as a process (e.g., 'process', 'development', 'longitudinal', 'temporal', 'dynamic') or an outcome (e.g., 'static', 'outcome', 'markers', 'consequence').

\subsubsection{Results}

```{r TheoriesElementCalc, include=F}
# Count the times each dimension is measured
TheoElementFreq <- dt.Theories.Included %>%
  dplyr::select(Affect, Behavior, Cognition, Desire) %>%
  mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  colSums(., na.rm = FALSE, dims = 1) 

# transform to data frame and make row names name variable
TheoElementFreq <- data.frame(Element = names(TheoElementFreq), 
                            Frequency = TheoElementFreq, 
                            Percentage = TheoElementFreq/nrow(dt.Theories.Included)*100) %>%
  mutate(Element = fct_reorder(Element, Frequency))

# frequency of unique combinations
TheoElementCombFreq <- dt.Theories.Included %>%
  dplyr::select(Affect, Behavior, Cognition, Desire) %>%
  #mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  group_by(Affect, Behavior, Cognition, Desire) %>%
  summarise(Frequency = n()) %>%
  ungroup() %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T))

# fill replace ones with colnames to be combined
for (i in 1:4) {
    TheoElementCombFreq[[i]] <- str_replace(as.character(TheoElementCombFreq[[i]]), "1", colnames(TheoElementCombFreq)[i])
}

# collect Elements names for each combination
TheoElementCombFreq <- TheoElementCombFreq %>%
  unite("ExperienceCombination",c("Affect", "Behavior", "Cognition", "Desire"), na.rm = TRUE, sep = ", ") %>%
  mutate(ExperienceCombination = fct_reorder(ExperienceCombination, Frequency),
         Percentage = Frequency/nrow(dt.Theories.Included)*100,
         Affect = ifelse(grepl("Affect", ExperienceCombination, fixed = TRUE), 1,0),
         Behavior = ifelse(grepl("Behavior", ExperienceCombination, fixed = TRUE), 1,0),
         Cognition = ifelse(grepl("Cognition", ExperienceCombination, fixed = TRUE), 1,0),
         Desire = ifelse(grepl("Desire", ExperienceCombination, fixed = TRUE), 1,0)) %>%
  arrange(Frequency)

# summarize by aspect complexity
TheoComplexity <- TheoElementCombFreq %>%
  select(complexity, Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency),
            Percentage = sum(Frequency)/nrow(dt.Theories.Included)*100) %>%
  ungroup() %>%
  mutate(complexity = as.factor(complexity),
         complexity = fct_reorder(complexity, Frequency))

# overall complexity
TheoComplexityAverage <- weighted.mean(as.numeric(as.character(TheoComplexity$complexity)), TheoComplexity$Frequency)
ThoeComplexitySD <- wtd.var(x = as.numeric(as.character(TheoComplexity$complexity)), weights = TheoComplexity$Frequency)

# Scale complexity for each element
TheoElementComplexity <- TheoElementCombFreq %>%
  gather(key = "Element", value = "ElementDum", Affect, Behavior, Cognition, Desire) %>%
  filter(ElementDum == 1) %>%
  group_by(Element) %>%
  summarise(avgComplexity = weighted.mean(x = complexity, w = Frequency),
            sdComplexity = wtd.var(x = complexity, weights = Frequency),
            n = sum(Frequency)) %>%
  ungroup() %>%
  mutate(seComplexity = sdComplexity/sqrt(n)) %>%
  arrange(-avgComplexity)
```

```{r TheoriesElementCooccurrences, include=F}
# make crossproduct matrix to condense co-occurrences (off-diagonals) and get frequencies (diagonals)
TheoElementCooccure <- as.matrix(dt.Theories.Included %>% dplyr::select(Affect, Behavior, Cognition, Desire) %>% mutate_all(~replace(., is.na(.), 0)))
TheoElementCooccure <- crossprod(TheoElementCooccure)  # Same as: t(X) %*% X
#diag(TheoElementCooccure) <- 0       # remove frequencies on diagonals
#TheoElementCooccure[upper.tri(TheoElementCooccure)] <- ""

TheoElementCooccure %>%
  kbl(., 
        #label = "",
        caption = "Theoretical Literature: Element Co-occurrence Matrix",
        format = "latex", 
        linesep = "",
        booktabs = T,
        align = rep('c', ncol(TheoElementCooccure)))  %>%
  kable_styling(position = "left") %>%
  #gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  gsub("\\begin{table}", "\\begin{table}\n\\begin{minipage}[t][\\textheight][t]{\\textwidth}", ., fixed = TRUE) %>% # fix table position
  gsub("\\end{table}", "\\end{minipage}\n\\end{table}", ., fixed = TRUE) %>% # fix table position
  #gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  save_kable("Tables/TheoreticalElementCooccurrences.tex")
```

```{r CombinedCooccurrences, include=F}
theoElementCor <- as.matrix(dt.Theories.Included %>% dplyr::select(Affect, Behavior, Cognition, Desire) %>% mutate_all(~replace(., is.na(.), 0))) %>%
  BinaryCor(., "pearson") %>%
  tibble::rownames_to_column(., var = "Aspect")
scaleElementCor <- as.matrix(dt.Scales.Included %>% dplyr::select(Affect, Behavior, Cognition, Desire) %>% mutate_all(~replace(., is.na(.), 0))) %>%
  BinaryCor(., "pearson") %>%
  tibble::rownames_to_column(., var = "Aspect")
empElementCor <- as.matrix(dt.Empirical.included %>% dplyr::select(Affect, Behavior, Cognition, Desire) %>% mutate_all(~replace(., is.na(.), 0))) %>%
  BinaryCor(., "pearson") %>%
  tibble::rownames_to_column(., var = "Aspect")

rowPack <- c(rep(paste0("Theoretical (N = ",nrow(dt.Theories.Included), ")"),4), 
             rep(paste0("Psychometric (N = ",nrow(dt.Scales.Included), ")"),4), 
             rep(paste0("Empirical (N = ",nrow(dt.Empirical.included), ")"),4)) %>%
  table(.) %>%
  .[c(paste0("Theoretical (N = ",nrow(dt.Theories.Included), ")"), 
      paste0("Psychometric (N = ",nrow(dt.Scales.Included), ")"), 
      paste0("Empirical (N = ",nrow(dt.Empirical.included), ")"))]
  
rbind(theoElementCor, scaleElementCor, empElementCor) %>%
  kbl(., 
        #label = "",
        caption = "Bivariate Association of Aspects for all Literature Levels.",
        format = "latex", 
        linesep = "",
        booktabs = T,
        align = c("l", rep('c', ncol(empElementCor)-1)))  %>%
  pack_rows(index = rowPack) %>%
  kable_styling(position = "left") %>%
  footnote(general = c("Diagonal: Times aspect occurred;", "Upper triangle: Phi association;", "Lower triangle: Times aspects co-occurred.")) %>%
  gsub("Aspect &", "\\multicolumn{1}{c}{Aspect} &", ., fixed = TRUE) %>% # fix Aspect title align
  gsub("N =", "\\textit{N} =", ., fixed = TRUE) %>% # fix row pack label
  gsub("\\begin{table}", "\\begin{table}\n\\begin{minipage}[t][\\textheight][t]{\\textwidth}", ., fixed = TRUE) %>% # fix table position
  gsub("\\end{table}", "\\end{minipage}\n\\end{table}", ., fixed = TRUE) %>% # fix table position
  gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  save_kable("Tables/CombinedElementCooccurrences.tex")
```

```{r TheoriesFreq, include=F, fig.width=12, fig.height=12}
# barplot of dimension frequency
TheoABCDBar <- ggplot(data=TheoElementFreq, aes(x=Element, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    #aes(label = paste0("N = ",Frequency)),
    aes(label = paste0(format(round(Percentage,2), nsmall=2), "%")),
    position=position_stack(vjust=0.5),
    color = "white",
    size = 4,
    vjust = 0.5
    ) +
  labs(title = "Element Frequency",
       y = "Percentage across all Theories",
       x = "Experience Element")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14"),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=10, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold"),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.position="none")

# barplot of complexity frequency
TheoComplexityBar <- ggplot(data=TheoComplexity, aes(x=complexity, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    #aes(label = paste0("N = ",Frequency)),
    aes(label = paste0(format(round(Percentage,2), nsmall=2), "%")),
    position=position_stack(vjust=0.5),
    color = "white",
    size = 4,
    vjust = 0.5
    ) +
  labs(title = "Scale Complexity",
       y = "Frequency across all Theories",
       x = "Complexity")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=10, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold"),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.position="none")


# bar plot frequencies
TheoABCDComb <- ggplot(TheoElementCombFreq, aes(x=ExperienceCombination, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    aes(y=Percentage, label = paste0(format(round(Percentage,2), nsmall=2),"% [N = ", Frequency, "]")),
    color = "grey14",
    size = 4,
    hjust = -.1,
    inherit.aes = TRUE
    ) +
  scale_y_continuous(limits = c(0, ceiling(max(TheoElementCombFreq$Percentage)*1.15)),
                     breaks = seq(0, ceiling(max(TheoElementCombFreq$Percentage)*1.15), 5))+
  labs(y = "Proportion of all theories [in %]",
       x = "Combination of Experience Elements")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14"),
        strip.text = element_text(colour = 'white', face="bold"),
        legend.position="none")

# draw combined graph
ggdraw() +
  draw_plot(TheoABCDComb, x = 0, y = 0.3, width = 1, height = .7)+
  draw_plot(TheoABCDBar, x = 0, y = 0, width = .55, height = .3) +
  draw_plot(TheoComplexityBar, x = .55, y = 0, width = .45, height = .3) +
  draw_plot_label(c("(A)", "(B)", "(C)"), c(0, 0, 0.55), c(1, 0.3, 0.3), size = 15)
```

\paragraph{ABCD prevalence.}Our main goal was to assess the use of the four affect, behavior, cognition, and desire elements within the theoretical conceptualizations of psychological acculturation. Looking at the overall usage of the experience aspects we find that virtually all theoretical works included behavioral aspects (`r round(TheoElementFreq$Percentage[TheoElementFreq$Element=="Behavior"],2)`%; e.g., cultural practices, media consumption) and a vast majority considered cognitive aspects (`r round(TheoElementFreq$Percentage[TheoElementFreq$Element=="Cognition"],2)`%; e.g., navigation knowledge, ethnic identification). We found considerably less mentions of affective (`r round(TheoElementFreq$Percentage[TheoElementFreq$Element=="Affect"],2)`%; e.g., anxiety, pride) and motivational aspects (`r round(TheoElementFreq$Percentage[TheoElementFreq$Element=="Desire"],2)`%; e.g., independence goals, need to belong). But the generally high usage of the aspects, also meant that only about a tenth of the theories focused on a single aspect (`r round(TheoComplexity$Percentage[TheoComplexity$complexity==1],2)`%). Interestingly, all theories that considered only one aspect were exclusively focusing on behaviors (N = `r TheoElementCombFreq$Frequency[TheoElementCombFreq$ExperienceCombination=="Behavior"]`) or cognitions (N = `r TheoElementCombFreq$Frequency[TheoElementCombFreq$ExperienceCombination=="Cognition"]`). Of the remaining theories, `r TheoComplexity$Frequency[TheoComplexity$complexity==4]` (i.e., `r round(TheoComplexity$Percentage[TheoComplexity$complexity==4],2)`%) considered all four aspects, leaving a majority of theoretical works to considered two aspects (`r round(TheoComplexity$Percentage[TheoComplexity$complexity==2],2)`%) or three aspects (`r round(TheoComplexity$Percentage[TheoComplexity$complexity==3],2)`%). Among these, the most common combinations of experience aspects were behavioral and cognitive acculturation (`r round(TheoElementCombFreq$Percentage[TheoElementCombFreq$ExperienceCombination=="Behavior, Cognition"],2)`%) or behavioral, cognitive, and motivational aspects combined (`r round(TheoElementCombFreq$Percentage[TheoElementCombFreq$ExperienceCombination=="Affect, Behavior, Cognition"],2)`%; also see \fgrref{fig:ElementsTheories} and \tblref{tab:CombinedCooccurrences}).

\paragraph{ABCD composition.}Looking at the number of aspects considered together we also see substantial differences in what kind of theories include a certain aspect. Theories that included behaviors considered an average of `r format(round(TheoElementComplexity$avgComplexity[TheoElementComplexity$Element=="Behavior"],2)-1,nsmall=2)` other aspects (\textit{SD} = `r format(round(TheoElementComplexity$sdComplexity[TheoElementComplexity$Element=="Behavior"],2),nsmall=2)`), and theories considering cognitions, on average, also included `r format(round(TheoElementComplexity$avgComplexity[TheoElementComplexity$Element=="Cognition"],2)-1,nsmall=2)` other aspects (\textit{SD} = `r format(round(TheoElementComplexity$sdComplexity[TheoElementComplexity$Element=="Cognition"],2),nsmall=2)`). Theories that included the more internal aspects of affect or desire showed a considerably higher number of additional aspects considered (affect: \textit{M} = `r format(round(TheoElementComplexity$avgComplexity[TheoElementComplexity$Element=="Affect"],2),nsmall=2)`, \textit{SD} = `r format(round(TheoElementComplexity$sdComplexity[TheoElementComplexity$Element=="Affect"],2),nsmall=2)`; desire: \textit{M} = `r format(round(TheoElementComplexity$avgComplexity[TheoElementComplexity$Element=="Desire"],2),nsmall=2)`, \textit{SD} = `r format(round(TheoElementComplexity$sdComplexity[TheoElementComplexity$Element=="Desire"],2),nsmall=2)`). Thus, most scales measure multiple dimensions of acculturation (\textit{M} = `r format(round(TheoComplexityAverage,2),nsmall=2)`, \textit{SD} = `r format(round(ThoeComplexitySD,2),nsmall=2)`; also see \fgrref{fig:LiteratureComparison}). Yet they tend to focus on more external aspects of behavioral and cognitive acculturation, and less on internal aspects of affects and desires. This is also visible in the observation that there were no theories that exclusively focused on emotional or motivational acculturation while this was the case for both cognitions and behaviors. And if emotional or desire aspects were considered they were found in theories that tended to already include a higher number of other experience aspects.

<!-- Process -->
```{r theoreticalProcess, include=F}
theoProcessFocus <- as.data.frame(summarytools::freq(dt.Theories.Included$Time, order = "freq"))
names(theoProcessFocus) <- gsub("% ", "Perc", names(theoProcessFocus))
```

\paragraph{Process.}To assess the process focus of the theoretical works, we assessed whether authors self-identified their works as process or outcome focused. We found that `r theoProcessFocus["dynamic",]$Freq` of the `r theoProcessFocus["Total",]$Freq` coded theoretical works proposed dynamic conceptualizations of psychological acculturation (`r round(theoProcessFocus["dynamic",]$PercValid,2)`%). This slight majority is a notably high percentage, considering that past reviews of the acculturation literature have pointed to a small number of studies actually offering dynamic tests of theories \citep[e.g.,][]{Brown2011, Ward2019}.

\paragraph{Content.}While it is beyond the scope of this paper to comprehensively summarize and integrate the over 90 theoretical works on psychological acculturation, we will briefly discuss how the different types of theoretical works fit within a broader ABCD framework. To this aim, we separate the acculturation process into three functional steps and highlight some works in their use of the affect, behavior, cognition, and desire aspects.

A broader pattern we observed is that theories focused on different phases of the acculturation process. These phases can arguably be organized around the timeline of actual inter-cultural contacts. In essence, we saw three phases describing the affects, behaviors, cognitions, and desires that are (1) normatively accepted by the relevant cultural groups \textit{prior to the contact}, (2) actually experienced \textit{during the contact}, and (3) experienced \textit{after the contact}. We have, thus, termed these phases (1) acculturation conditions, (2) acculturation responses, and (3) acculturation outcomes (see \fgrref{fig:ModelContext})\footnote{This approach is in line with previous step-wise conceptualizations \citep[e.g., process vs. outcome distinction;][]{Sam2006b} and step-wise models of acculturation \citep[e.g.,][]{Arends-Toth2006a, TeLindert2008a}. Yet, importantly each of these phases carry their own sets of affects, behaviors, cognitions, and desires. It should also be noted that inter-cultural contact can either be in person or through media, institutions, or cultural products.}. 
While it would be beyond the scope of this paper (and likely overly simplified) to summarize all theoretical ideas within each of the three stages, in the following we would like to highlight a small selection of works that illustrate the use of ABCDs within the experience stages. 

\subparagraph{Acculturation conditions.}Theoretical works that focused on the experience prior to the actual inter-cultural contact, generally speaking, focused on the socio-structural and personal expectations of the acculturation experience. As an example, \citet[][]{Ward2016} in their contextualized process framework highlight how culturally-expected "behaviors, values and identities" (behavior and cognitions; p. 100) have a fundamental influence on perceived cultural distance, the intercultural contact, and the ensuing psychological changes, including well-being and emotional distress (affect). They even embed this process further in a series ecological contexts, highlighting the affordances and conditions of the process. A second example might be the `acculturation intentions model' \citep[][]{Tartakovsky2012}, which argues that we should focus on pre-migration attitudes, perceived social norms, and perceived control (i.e., cognitions). Depending on the valence of these pre-migration cognitions, the migrant will then experience "feelings of pride, love, and comfort, [...] or feelings of shame and discomfort" (i.e., affects; p. 86). According to the author the early cognitions and affects will then become "the main motivational forces that affect their [...] desire to continue living in this country" (i.e., desires; p. 86) and will ultimately determine acculturation intentions and behaviors (i.e., cognitions and behaviors). Tartakovsky also highlights that personal resources, and environmental constraints determine the experienced ABCDs\footnote{Further examples of theoretical works that include an explicit focus on acculturation conditions are \citet[][]{Kim1988, Rogler1994, Navas2005, Giles1977, Robinson2019, Serdarevic2005}.}. Both theories exemplify how affects, behaviors, cognitions, and desires were conceptualized prior to the inter-cultural contact and how important environmental conditions are at that time.

\subparagraph{Acculturation responses.}Theories that included a focus on the acculturation response tended to focus on the affects, behaviors, cognitions, and desires during (or immediately following) the inter-cultural interaction. One good example of this phase comes from the now classic work of \citet[][]{Berry1992}, where he divided psychological acculturation into behavioral shifts and acculturation stress. Berry then goes on to write that behavioral shifts are "changes in behaviour [...] and include values, attitudes, abilities and motives" (i.e., behavior, cognition, desire; p. 70), and acculturation stress is particularly manifested "as lowered mental health status (particularly anxiety, depression), feelings of marginality and alienation" (i.e., affects; p. 75). In Berry's (\citeyear{Berry1992}) theorizing behavioral shifts and acculturation stress jointly form 'psychological acculturation', which follows immediately after the inter-cultural contact. This phase is clearly distinguished from the migrant's adaptation, which follows the behavioral shifts and acculturation stress and in turn includes the famous acculturation strategies\footnote{Other examples of acculturation response focused theoretical works include \citet[][]{Berry2005, Sam2003, Riedel2011, Ward2016}.}.

\subparagraph{Acculturation outcomes.}The third stage of acculturation outcomes are often the affects, behaviors, cognitions, and desires that are more long-term and are often experienced after the actual intercultural contact is (temporarily) concluded. One exemplary theory-building effort is arguably that of the 'integrative theory of communication and cross-cultural adaptation' \citep[][]{Kim1988}. As one of the final theoretical steps Kim (\citeyear[][]{Kim1988}) devotes an entire chapter on 'adaptation outcomes', which she begins with the definition of acculturation outcomes: "Gradually [migrants'] habitual patterns of cognitive, affective, and behavioral responses undergo adaptive transformations [...] which enable them to fulfill their various human needs, such as maintaining and enhancing social relationships and providing for channels of self-expression and fulfilment" (affect, behavior, cognition, desire; p. 138)\footnote{A number of other theoretical works has explicitly focused on acculturation outcomes, including \citet[][]{Baird2015, Berry1998, Berry1992, Berry2005, Riedel2011, Rogler1994, Luedicke2011}.}. This focus on how the more immediate contact experiences influence long-term ABCDs, such as well-being, stress, and other adaptation outcomes were a common target of broader theoretical works.

\subparagraph{Scope.}It is important to mention that many of the theoretical works, including most of the examples above, have focused on process models that span two or more of the three steps \citep[e.g.,][]{Berry1992, Ward2016, Arends-Toth2006a, Rogler1994}. Additionally, a majority of the theoretical works we considered offered commentary on the overall construct of acculturation (N = `r nrow(dt.Theories.Included %>% filter(GeneralAspect=="General"))`) and only a minority of `r nrow(dt.Theories.Included %>% filter(GeneralAspect=="Aspect"))` works explicitly targeted a specific part of acculturation (e.g., `r nrow(dt.Theories.Included %>% filter(Target=="Identity"))` identity acculturation theories and `r nrow(dt.Theories.Included %>% filter(Target=="Work"))` labor market acculturation theories; for an example see \citealp{Weinreich2009}). Moreover, as the examples have already highlighted, for many theoretical conceptualizations of psychological acculturation authors discussed their focus on affect, behavior, cognition, or desire aspects rather explicitly (which was also visible in a high inter-rater reliability; for full coding details see Supplemental Material C). 

An additional functional benefit of the condition-response-outcome separation has been the observation that several theoretical works sit at the intersection between two of the steps. Several works were specifically focused on the conditions under which acculturation conditions lead to tension and changes in the acculturation responses \citep[i.e., conditions of change; e.g.,][]{Masgoret2006, Alitolppa-Niitamo2004, Grove1985, Wood2014}, or under which conditions acculturation responses lead to stressful or adaptive acculturation outcomes \citep[i.e., conditions of stress; e.g.,][; also see \fgrref{fig:ModelContext} and Figure S1 in Supplemental Material E]{Ryan2008, Berry1992, Benet-Martinez2005, Salo2015, Wood2014, Hajro2019}.

A final observation has been that while the inclusion of desire components was generally high within the theoretical literature, the emphasis on desires and motivations was particularly prominent in the grounded theories and other bottom-up works. As an example, \citet[][]{Kim2019} developed a theoretical model based on the reported importance of goals and motivations prior and during migration for down-stream adaptation processes. Similarly, for \citet[][]{Mchitarjan2015} one key determinant of acculturation "success or failure" are "motivational factors, i.e. the motives, desires, or goals of the minority and majority" (p. 2). <!-- Madison2006: role of motives -->

```{=tex}
\begin{figure}[h]
\centering
\caption{Psychological Acculturation Aspects within the Theoretical Literature. (A) Bar graph showing the common combinations of the affect, behavior, cognition, desire experience aspects. (B) Bar graph showing the prevalence of each experience aspect within the literature. (C) Bar graph showing how many experience aspects were considered together.}
\includegraphics[width=\textwidth]{Figures/TheoriesFreq-1}
\label{fig:ElementsTheories}
\end{figure}
```
\input{Tables/CombinedElementCooccurrences}

<!-- \input{Tables/TheoreticalElementCooccurrences}   -->

<!-- \input{Tables/CombinedElementComplexity} -->

\subsection{Psychometric Literature}

Based on the systematic scoping review and its coding, the first empirical dataset we assess is a database of scale validations. We bring together the scales suggested in previous reviews as well as validation studies we identified in our own review. Throughout our literature review, we found five major works that reviewed the measurement of acculturation \citep{Celenk2011, Maestas2000, Matsudaira2006, Wallace2010, Zane2004}. After removal of duplicate scales, we added any scale validation that was present in our own systematic scoping review but not included in the previous reviews. For each measure, we extracted the full item list as well as the item scoring prior to coding. A comprehensive and interactive database of the scales, with all available items, reference- and publication information, as well as our experience elements and -context coding is available in Supplemental Material D (also see \fgrref{fig:DirectoryScreen} for an illustration).

\begin{figure}[ht!]
  \centering
  \caption{Screenshot of the \textit{Acculturation Scale Directory}. Top: Main table of the included acculturation scales as well as the filter interface. Bottom: Detailed view of selected scale with item, response, sample, and life domain information. A full description of the directory is available in Supplemental Material D and the directory is available at: \href{https://acculturation-review.shinyapps.io/scale-directory/}{https://acculturation-review.shinyapps.io/scale-directory/}.}
  \includegraphics[width=\textwidth]{Figures/AcculturationDIrectoryScreenshot.pdf}
  \label{fig:DirectoryScreen}
\end{figure}

```{=tex}
\subsubsection{Methods}  
\paragraph{Dataset}
```
After duplicate removal, these five reviews collected a total of `r nrow(dt.Scales[dt.Scales$Source != "own review",])` scales. From our own review, we added `r nrow(dt.Scales[dt.Scales$Source == "own review",])` additional validation studies (total of `r nrow(dt.Scales)` unique scales). Of these scales, we ultimately had to exclude `r nrow(dt.Scales[!is.na(dt.Scales$MissingNote),])`, because they were either not accessible or did not fit the topic of our review (see \tblref{tab:ExclusionsCombined}). About a quarter of scales (`r round(nrow(filter(dt.Scales, IncludesMajority == 1))/nrow(dt.Scales)*100,2)`%) included majority group members in their validation studies. The earliest included validation was from `r min(dt.Scales$year, na.rm = T)` with a majority of scales being validated around the turn of the 21\textsuperscript{st} century and the most recent included validation study was published in `r max(dt.Scales$year, na.rm = T)`.

\paragraph{Experience Aspects}

```{r MethodologicalKappa, include=FALSE}
names <- c("Affect", "Behavior", "Cognition", "Desire")
kMeth <- dt.Scales.Included %>%
  select(Affect, Affect2, Behavior, Behavior2, Cognition, Cognition2, Desire, Desire2) %>%
  mutate_all(~replace_na(., 0)) %>%
  kappa.full.multiple(., names)
kMethPooled <- kappa.pooled2(kMeth)
```

```{r MethodologicalExperienceRecode}
# store first coder under suffix "1" and then recode the "Final" suffixed into the plain ABCD.
dt.Scales.Included <- dt.Scales.Included %>%
  mutate(Affect1 = Affect, Behavior1 = Behavior, Cognition1 = Cognition, Desire1 = Desire) %>%
  mutate(Affect = AffectFinal, Behavior = BehaviorFinal, Cognition = CognitionFinal, Desire = DesireFinal)
```

We extracted data on the experience aspects by primarily focusing on the measured concepts and their operationalizations (also see \tblref{tab:AspectExamples}). For each article, we retrieved the items used and coded whether the measure included references to affects, behaviors, cognitions, and desires. Because this concerned the most central aspect of our framework, each manuscript was double-coded and inconsistent codes were resolved after discussion (all inter-rater agreements were `r format(round(min(kMeth$Po, na.rm = TRUE)*100, 2), nsmall=2)`% or above and all Cohen's $\varkappa$s were above `r format(round(min(kMeth$k, na.rm = TRUE), 2), nsmall=2)`, $\varkappa_{pooled}$ = `r format(round(kMethPooled$k.pooled, 2), nsmall=2)`; for full inter-rater reliability see Supplemental Material C).

At this stage, we also noted if scales or items measured concepts that relate to multiple experience aspects. As an example, a single item asking about 'satisfaction with the new life' might include emotional and cognitive elements. In this case, we code the manuscript as measuring both emotions and cognitions, and noted that these elements are not measured independently. We also noted if the measures do not consider an individual's experiences, such as reporting migration status or length of residency.

\paragraph{Process}

To extract an indicator of whether the scales were aimed at psychological acculturation as a process or an outcome, we collected information on assessed migration times (e.g., pre-migration, post-migration) and the the validation type (e.g., cross-sectional, longitudinal).

```{r ScalesExclusion}
data.frame(table(Exclusion = dt.Scales$MissingNote)) %>%
  arrange(desc(Freq)) %>%
  kbl(., 
        #label = "",
        caption = "Scales Exclusion Reasons",
        format = "latex",
        col.names = c("Exclusion Reason",
                      "Frequency"), 
        linesep = "",
        booktabs = T,
        align = c("l", "c"))  %>%
  kable_styling(position = "left") %>%
  #gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  gsub("\\begin{table}", "\\begin{table}\n\\begin{minipage}[t][\\textheight][t]{\\textwidth}", ., fixed = TRUE) %>% # fix table position
  gsub("\\end{table}", "\\end{minipage}\n\\end{table}", ., fixed = TRUE) %>% # fix table position
  save_kable("Tables/ScalesExclusion.tex")

scalesExcl <- data.frame(table(dt.Scales$MissingNote)) %>%
  rename("Exclusion Reason" = Var1, "Full Text" = Freq) %>%
  arrange(desc(`Full Text`))
```

<!-- \input{Tables/ScalesExclusion}   -->

\subsubsection{Results}

```{r ABCDCalc, include=F}
# Count the times each dimension is measured
ScaleElementFreq <- dt.Scales.Included %>%
  dplyr::select(Affect, Behavior, Cognition, Desire) %>%
  mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  colSums(., na.rm = FALSE, dims = 1) 

# transform to data frame and make row names name variable
ScaleElementFreq <- data.frame(Element = names(ScaleElementFreq), 
                            Frequency = ScaleElementFreq, 
                            Percentage = ScaleElementFreq/nrow(dt.Scales.Included)) %>%
  mutate(Element = fct_reorder(Element, Frequency))

# frequency of unique combinations
ScaleElementCombFreq <- dt.Scales.Included %>%
  dplyr::select(Affect, Behavior, Cognition, Desire) %>%
  #mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  group_by(Affect, Behavior, Cognition, Desire) %>%
  summarise(Frequency = n()) %>%
  ungroup() %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T))

# fill replace ones with colnames to be combined
for (i in 1:4) {
    ScaleElementCombFreq[[i]] <- str_replace(as.character(ScaleElementCombFreq[[i]]), "1", colnames(ScaleElementCombFreq)[i])
}

# collect Elements names for each combination
ScaleElementCombFreq <- ScaleElementCombFreq %>%
  unite("ExperienceCombination",c("Affect", "Behavior", "Cognition", "Desire"), na.rm = TRUE, sep = ", ") %>%
  mutate(ExperienceCombination = fct_reorder(ExperienceCombination, Frequency),
         Percentage = Frequency/nrow(dt.Scales.Included)*100,
         Affect = ifelse(grepl("Affect", ExperienceCombination, fixed = TRUE), 1,0),
         Behavior = ifelse(grepl("Behavior", ExperienceCombination, fixed = TRUE), 1,0),
         Cognition = ifelse(grepl("Cognition", ExperienceCombination, fixed = TRUE), 1,0),
         Desire = ifelse(grepl("Desire", ExperienceCombination, fixed = TRUE), 1,0))

scaleComplexity <- ScaleElementCombFreq %>%
  select(complexity, Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency),
            Percentage = sum(Frequency)/nrow(dt.Scales.Included)*100) %>%
  ungroup() %>%
  mutate(complexity = as.factor(complexity),
         complexity = fct_reorder(complexity, Frequency))

# overall complexity
scaleComplexityAverage <- weighted.mean(as.numeric(as.character(scaleComplexity$complexity)), scaleComplexity$Frequency)
scaleComplexitySD <- wtd.var(x = as.numeric(as.character(scaleComplexity$complexity)), weights = scaleComplexity$Frequency)

# Scale complexity for each element
scaleElementComplexity <- ScaleElementCombFreq %>%
  gather(key = "Element", value = "ElementDum", Affect, Behavior, Cognition, Desire) %>%
  filter(ElementDum == 1) %>%
  group_by(Element) %>%
  summarise(avgComplexity = weighted.mean(x = complexity, w = Frequency),
            sdComplexity = wtd.var(x = complexity, weights = Frequency),
            n = sum(Frequency)) %>%
  ungroup() %>%
  mutate(seComplexity = sdComplexity/sqrt(n)) %>%
  arrange(-avgComplexity)
```

```{r ScaleElementCooccurrences, include=F}
# make crossproduct matrix to condense co-occurrences (off-diagonals) and get frequencies (diagonals)
scaleElementCooccure <- as.matrix(dt.Scales.Included %>% dplyr::select(Affect, Behavior, Cognition, Desire) %>% mutate_all(~replace(., is.na(.), 0)))
scaleElementCooccure <- crossprod(scaleElementCooccure)  # Same as: t(X) %*% X
#diag(scaleElementCooccure) <- 0       # remove frequencies on diagonals
#scaleElementCooccure[upper.tri(scaleElementCooccure)] <- ""

scaleElementCooccure %>%
  kbl(., 
        #label = "",
        caption = "Scales: Element Co-occurrence Matrix",
        format = "latex", 
        linesep = "",
        booktabs = T,
        align = rep('c', ncol(scaleElementCooccure)))  %>%
  kable_styling(position = "left") %>%
  #gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  gsub("\\begin{table}", "\\begin{table}\n\\begin{minipage}[t][\\textheight][t]{\\textwidth}", ., fixed = TRUE) %>% # fix table position
  gsub("\\end{table}", "\\end{minipage}\n\\end{table}", ., fixed = TRUE) %>% # fix table position
  save_kable("Tables/ScaleElementCooccurrences.tex")
```

\paragraph{ABCD prevalence.}
With our main aim of examining the experience structure within the scales, we examined whether scales included a specific experience element but also examined the used elements in their complex combinations. In terms of general inclusion of elements, most studies included a measure of cognition (`r round(ScaleElementFreq$Percentage[ScaleElementFreq$Element=="Cognition"]*100,2)`%) and behavior (`r round(ScaleElementFreq$Percentage[ScaleElementFreq$Element=="Behavior"]*100,2)`%), whereas only roughly half the studies included a measure of affect (`r round(ScaleElementFreq$Percentage[ScaleElementFreq$Element=="Affect"]*100,2)`%) and only a fourth of the scales included a measure of desires (`r round(ScaleElementFreq$Percentage[ScaleElementFreq$Element=="Desire"]*100,2)`%). However, only a minority of scales included only a single aspect. There were only `r ScaleElementCombFreq$Frequency[ScaleElementCombFreq$ExperienceCombination=="Cognition"]` scales that exclusively relied on cognitions (`r round(ScaleElementCombFreq$Percentage[ScaleElementCombFreq$ExperienceCombination=="Cognition"],2)`%) and `r ScaleElementCombFreq$Frequency[ScaleElementCombFreq$ExperienceCombination=="Behavior"]` scales that measured only behaviors (`r round(ScaleElementCombFreq$Percentage[ScaleElementCombFreq$ExperienceCombination=="Behavior"],2)`%). Yet, inversely, there were also only `r ScaleElementCombFreq$Frequency[ScaleElementCombFreq$ExperienceCombination=="Affect, Behavior, Cognition, Desire"]` scales that measured all four aspects (`r round(ScaleElementCombFreq$Percentage[ScaleElementCombFreq$ExperienceCombination=="Affect, Behavior, Cognition, Desire"],2)`%). Most studies measured two (`r ScaleElementCombFreq %>% filter(complexity == 2) %>% select(Frequency) %>% summarise(Perc = round(sum(.)/nrow(dt.Scales.Included)*100, 2))`%) or three (`r ScaleElementCombFreq %>% filter(complexity == 3) %>% select(Frequency) %>% summarise(Perc = round(sum(.)/nrow(dt.Scales.Included)*100, 2))`%) aspects. A majority of scales either measured behavioral and cognitive aspects (`r round(ScaleElementCombFreq$Percentage[ScaleElementCombFreq$ExperienceCombination=="Behavior, Cognition"],2)`%) or behavioral, cognitive, and affective elements (`r round(ScaleElementCombFreq$Percentage[ScaleElementCombFreq$ExperienceCombination=="Affect, Behavior, Cognition"],2)`%; also see \fgrref{fig:ElementsScales} and \tblref{tab:CombinedCooccurrences}).

\paragraph{ABCD composition.}
Looking at the number of aspects measured together we also see substantial differences in what kind of scales include a certain aspect. Scales that included cognitions also measured an average of `r format(round(scaleElementComplexity$avgComplexity[scaleElementComplexity$Element=="Cognition"],2)-1,nsmall=2)` others aspects (\textit{SD} = `r format(round(scaleElementComplexity$sdComplexity[scaleElementComplexity$Element=="Cognition"],2),nsmall=2)`), scales measuring behavior, on average, also included `r format(round(scaleElementComplexity$avgComplexity[scaleElementComplexity$Element=="Behavior"],2)-1,nsmall=2)` other aspects (\textit{SD} = `r format(round(scaleElementComplexity$sdComplexity[scaleElementComplexity$Element=="Cognition"],2),nsmall=2)`). Scales measuring affect or desire measures included substantially more other aspects. Scales that included affect measures also included `r format(round(scaleElementComplexity$avgComplexity[scaleElementComplexity$Element=="Affect"],2)-1,nsmall=2)` other aspects (\textit{SD} = `r format(round(scaleElementComplexity$sdComplexity[scaleElementComplexity$Element=="Affect"],2),nsmall=2)`) and scales measuring desires even measured an average of `r format(round(scaleElementComplexity$avgComplexity[scaleElementComplexity$Element=="Desire"],2)-1,nsmall=2)` other aspects per scale (\textit{SD} = `r format(round(scaleElementComplexity$sdComplexity[scaleElementComplexity$Element=="Desire"],2),nsmall=2)`; also see \fgrref{fig:LiteratureComparison}). Thus, most scales measure multiple dimensions (\textit{M} = `r format(round(scaleComplexityAverage,2),nsmall=2)`, \textit{SD} = `r format(round(scaleComplexitySD,2),nsmall=2)`), yet they focus on external accessible aspects of psychological acculturation (i.e., behavior and cognition), less of what is considered 'internal' or 'subjective' (i.e., affect and desires). And if affect or desire elements are considered, they often only occur in scales that already include a higher number of other aspects. This is further underscored by the observation that there were only `r ScaleElementCombFreq$Frequency[ScaleElementCombFreq$ExperienceCombination=="Affect"]` scales that exclusively measured emotional acculturation and not a single scale that exclusively focused on motivational acculturation (while this was the case for both cognitions and behaviors).

```{r  ABCDFreq, include=F, fig.width=12, fig.height=12}
# barplot of dimension frequency
ScaleABCDBar <- ggplot(data=ScaleElementFreq, aes(x=Element, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    #aes(label = paste0("N = ",Frequency)),
    aes(label = paste0(format(round(Percentage,2), nsmall=2), "%")),
    position=position_stack(vjust=0.5),
    color = "white",
    size = 4,
    vjust = 0.5
    ) +
  labs(title = "Element Frequency",
       y = "Frequency across all Scales",
       x = "Experience Element")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=10, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold"),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.position="none")

# barplot of complexity frequency
ScaleComplexityBar <- ggplot(data=scaleComplexity, aes(x=complexity, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    #aes(label = paste0("N = ",Frequency)),
    aes(label = paste0(format(round(Percentage,2), nsmall=2), "%")),
    position=position_stack(vjust=0.5),
    color = "white",
    size = 4,
    vjust = 0.5
    ) +
  labs(title = "Scale Complexity",
       y = "Frequency across all Scales",
       x = "Complexity")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=10, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold"),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.position="none")


# bar plot frequencies
ScaleABCDComb <- ggplot(ScaleElementCombFreq, aes(x=ExperienceCombination, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    aes(y=Percentage, label = paste0(format(round(Percentage,2), nsmall=2),"% [N = ", Frequency, "]")),
    color = "grey14",
    size = 4,
    hjust = -.1,
    inherit.aes = TRUE
    ) +
  scale_y_continuous(limits = c(0, ceiling(max(ScaleElementCombFreq$Percentage)*1.1)),
                     breaks = seq(0, ceiling(max(ScaleElementCombFreq$Percentage)*1.1), 5))+
  labs(y = "Proportion of all scales [in %]",
       x = "Combination of Experience Elements")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background =element_rect(fill="grey14", color="grey14"),
        strip.text = element_text(colour = 'white', face="bold"),
        legend.position="none")

ggdraw() +
  draw_plot(ScaleABCDComb, x = 0, y = 0.3, width = 1, height = .7)+
  draw_plot(ScaleABCDBar, x = 0, y = 0, width = .55, height = .3) +
  draw_plot(ScaleComplexityBar, x = .55, y = 0, width = .45, height = .3) +
  draw_plot_label(c("(A)", "(B)", "(C)"), c(0, 0, 0.55), c(1, 0.3, 0.3), size = 15)

# ScaleABCDComb + 
#   annotation_custom(
#     ggplotGrob(ScaleABCDBar), 
#     xmin = 0.5, xmax = 5, ymin = 18, ymax = 30
#   ) +
#   annotation_custom(
#     ggplotGrob(ScaleComplexityBar), 
#     xmin = 0.5, xmax = 5, ymin = 8, ymax = 18
#   ) +
#   geom_rect(aes(xmin=0.5,xmax=4.8,ymin=8,ymax=30), 
#             color = alpha("grey14", .5), size = .05, fill = "transparent", alpha=0)
```

<!-- Scale  chart goes somewhere here} -->

```{=tex}
\begin{figure}[h]
\centering
\caption{Psychological Acculturation Aspects within the Psychometric Literature. (A) Bar graph showing the common combinations of the affect, behavior, cognition, desire experience aspects. (B) Bar graph showing the prevalence of each experience aspect within the literature. (C) Bar graph showing how many experience aspects were considered together.}
\includegraphics[width=\textwidth]{Figures/ABCDFreq-1}
\label{fig:ElementsScales}
\end{figure}
```
<!-- \input{Tables/ScaleElementCooccurrences}   -->

```{r ScaleMigrationTime, include=F}
summarytools::freq(dt.Scales.Included$MigrationTime, order = "freq")
```

\paragraph{Process.}
To assess the process focus of the scales we also assessed the migration time the scale validators considered. Except for a single scale that was validated for potential migrants, all scales were validated using cross-sectional data after the migrant arrived in the settlement society. This is in line with observations by previous reviews of the field \citep[e.g.,][]{Brown2011}.

```{r ScaleItemDescr, include=F}
scaleItemDescr <- psych::describe(as.numeric(dt.Scales.Included$NItems))
scaleDomainDescr <- psych::describe(as.numeric(str_count(dt.Scales.Included$lifeDomain, ',')+1))


# Based on 
# Schweinberger, Martin. 2022. Topic Modeling with R. Brisbane: The University of Queensland. url: https://slcladal.github.io/topicmodels.html (Version 2022.05.21).
library(DT)
library(tm)
library(topicmodels)
library(reshape2)
library(ggplot2)
library(wordcloud)
library(pals)
library(SnowballC)
library(lda)
library(ldatuning)
library(flextable)
textdata <- base::readRDS(url("https://slcladal.github.io/data/sotu_paragraphs.rda", "rb"))
textdata <- dt.Scales.Included %>%
  select(
    Scale,
    CitationKey,
    Item
  ) %>%
  mutate(
    doc_id = row_number(),
    text = gsub("[\r\n]", "", Item)
  ) %>%
  select(
    -Item
  ) %>% 
  as.data.frame

# load stopwords
english_stopwords <- readLines("https://slcladal.github.io/resources/stopwords_en.txt", encoding = "UTF-8")

# create corpus object
corpus <- Corpus(DataframeSource(textdata))
# Preprocessing chain
processedCorpus <- tm_map(corpus, content_transformer(tolower))
processedCorpus <- tm_map(processedCorpus, removeWords, english_stopwords)
processedCorpus <- tm_map(processedCorpus, removePunctuation, preserve_intra_word_dashes = TRUE)
processedCorpus <- tm_map(processedCorpus, removeNumbers)
processedCorpus <- tm_map(processedCorpus, stemDocument, language = "en")
processedCorpus <- tm_map(processedCorpus, stripWhitespace)

# compute document term matrix with terms >= minimumFrequency
minimumFrequency <- 5
DTM <- DocumentTermMatrix(processedCorpus, control = list(bounds = list(global = c(minimumFrequency, Inf))))
# have a look at the number of documents and terms in the matrix
dim(DTM)

# due to vocabulary pruning, we have empty rows in our DTM
# LDA does not like this. So we remove those docs from the
# DTM and the metadata
sel_idx <- slam::row_sums(DTM) > 0
DTM <- DTM[sel_idx, ]
textdata <- textdata[sel_idx, ]

# create models with different number of topics
result <- ldatuning::FindTopicsNumber(
  DTM,
  topics = seq(from = 2, to = 20, by = 1),
  metrics = c("CaoJuan2009",  "Deveaud2014"),
  method = "Gibbs",
  control = list(seed = 77),
  verbose = TRUE
)

FindTopicsNumber_plot(result)

# number of topics
K <- 20
# set random number generator seed
set.seed(9161)
# compute the LDA model, inference via 1000 iterations of Gibbs sampling
topicModel <- LDA(DTM, K, method="Gibbs", control=list(iter = 500, verbose = 25))

# have a look a some of the results (posterior distributions)
tmResult <- posterior(topicModel)
# format of the resulting object
attributes(tmResult)
# lengthOfVocab
nTerms(DTM) 
# get beta from results
beta <- tmResult$terms   
dim(beta)  
# rows in beta sum to 1
rowSums(beta)    
# size of collection
nDocs(DTM)               
# for every document we have a probability distribution of its contained topics
theta <- tmResult$topics 
dim(theta)               # nDocs(DTM) distributions over K topics

exampleTermData <- terms(topicModel, 10)
exampleTermData[, 1:8]

top5termsPerTopic <- terms(topicModel, 5)
topicNames <- apply(top5termsPerTopic, 2, paste, collapse=" ")

# visualize topics as word cloud
topicToViz <- 11 # change for your own topic of interest
topicToViz <- grep('feel', topicNames)[1] # Or select a topic by a term contained in its name
# select to 40 most probable terms from the topic by sorting the term-topic-probability vector in decreasing order

topTopicTerms <- list()
topTopicTermsPlot <- list()
mycolors <- brewer.pal(8, "Dark2")

for (i in 1:K) {
  top40terms <- sort(tmResult$terms[i,], decreasing=TRUE)[1:40]
  topTopicTerms[[i]] <- top40terms
  topTopicTermsPlot[[i]] <- ggwordcloud(names(top40terms), top40terms, random.order = FALSE, color = mycolors)
}

#grid.arrange(grobs = topTopicTermsPlot, ncol = 5)

# focus on unique topics
set.seed(9161)
topicModel2 <- LDA(DTM, K, method="Gibbs", control=list(iter = 500, verbose = 25, alpha = 0.2))
tmResult <- posterior(topicModel2)
theta <- tmResult$topics
beta <- tmResult$terms
topicNames <- apply(terms(topicModel2, 5), 2, paste, collapse = " ")  # reset topicnames


# re-rank top topic terms for topic names
topicNames <- apply(lda::top.topic.words(beta, 5, by.score = T), 2, paste, collapse = " ")


## APROACH 1
# What are the most probable topics in the entire collection?
topicProportions <- colSums(theta) / nDocs(DTM)  # mean probabilities over all paragraphs
names(topicProportions) <- topicNames     # assign the topic names we created before
sort(topicProportions, decreasing = TRUE) # show summed proportions in decreased order

soP <- sort(topicProportions, decreasing = TRUE)
paste(round(soP, 5), ":", names(soP))

## APPROACH 2
countsOfPrimaryTopics <- rep(0, K)
names(countsOfPrimaryTopics) <- topicNames
for (i in 1:nDocs(DTM)) {
  topicsPerDoc <- theta[i, ] # select topic distribution for document i
  # get first element position from ordered list
  primaryTopic <- order(topicsPerDoc, decreasing = TRUE)[1] 
  countsOfPrimaryTopics[primaryTopic] <- countsOfPrimaryTopics[primaryTopic] + 1
}
sort(countsOfPrimaryTopics, decreasing = TRUE)

so <- sort(countsOfPrimaryTopics, decreasing = TRUE)
paste(so, ":", names(so))


# SCALES:
# get mean topic proportions per decade
topic_proportion_per_scale <- aggregate(theta, by = list(scale = textdata$CitationKey), mean)
# set topic names to aggregated columns
colnames(topic_proportion_per_scale)[2:(K+1)] <- topicNames
# reshape data frame
vizDataFrame <- melt(topic_proportion_per_scale, id.vars = "scale")
# plot topic proportions per decade as bar plot
ggplot(vizDataFrame, aes(x=scale, y=value, fill=variable)) + 
  geom_bar(stat = "identity") + ylab("proportion") + 
  scale_fill_manual(values = paste0(alphabet(20), "FF"), name = "scale") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

\paragraph{Content.}
While a discussion of all the topics addressed by the included scales lies beyond the scope of this study, we would like to describe some of the larger patterns authors have focused on. To that aim, we offer illustrations of the patterns we observed during the reading, extraction, and coding of the acculturation scales. We additionally, ran a machine learning topic modeling procedure on the items of the scales to identify content topics.

A first key observation is that there was considerable diversity between the scales in how many experience aspects and topics were addressed. That might not generally be surprising, considering that the scales had between `r scaleItemDescr$min` and `r scaleItemDescr$max` items, and included between `r scaleDomainDescr$min` and `r scaleDomainDescr$max` life domains (see Supplemental Material E). Additionally, scales were also either more focused on a specific aspect \citep[e.g., `Asian Value Scale';][]{Kim1999, Kim2004a} or aimed to capture acculturation more broadly \citep[e.g., `Asian American Multidimensional Acculturation Scale'][]{GimChung2004}. Another trend that we observed was a separation between a factual and counter-factual acculturation \citep[e.g., real vs. ideal,][]{Navas2005, Navas2007, BenetMartinez2006}. Additionally, while a large number of scales separately assessed ABCDs as they related to the dominant culture and the heritage culture, we saw a trend towards explicitly asking about different life domains \citep[e.g., family, work, media;][also see Supplemental Material E]{Kim2010a, Arends-Toth2007, Mancini2014}. 

When considering the content of the aspects that were included across acculturation scales, the topic modeling analysis offers a number of key insights that mostly align with our reading of the literature. For the topic modeling of the acculturation scales, we particularly used the scale items in a Latent Dirichlet Allocation (LDA) analysis, an unsupervised machine learning method common within the natural language processing literature. The analysis essentially extracts sets of terms that tended to occur together, assuming that scales that measure a specific topic have more words that relate to the topic than scales that measure other topics \citep[we followed the procedures outlined by][for a full methodological detail see Supplemental Material C]{Schweinberger2022}. 

While we had earlier described that many scales included a measurement of behavioral acculturation, the topic modeling showed that one of the main topics across the scales was language use. This included questions about listening to, reading, and speaking the dominant local language. While there are a few (sub-)scales specifically targeting language use as a conceptualization of acculturation \citep[e.g.,][]{Deyo1985, ICSEYteam2006}, most scales used language as only one of multiple experience aspects. Moreover, the assessment of behavioral language use (and the more cognitive language proficiency) often differentiated between language used at home and outside the home. Similarly, some language assessments were distinguishing between the languages used in different life areas \citep[ e.g., media consumption, among friends, at work][for more information see Supplemental Material C]{Birman2002}. Other behavioral measurements of acculturation included the participation in and celebration of traditions and customs \citep[e.g.,][]{Rezentes1993, Wilson2013, Cortes1994}, clothing \citep[e.g.,][]{Ghuman2000}, food \citep[e.g.,][]{Schaefer2009}, and political participation \citep[e.g.,][]{Jeong2016, Uslaner2005}. One pattern that the topic modeling procedure highlighted was that food related questions were often found in scales targeting the adaptation of Asian migrants (in particular, Vietnamese, Indian, and Korean acculturation scales). 

Among the cognitive conceptualizations of acculturation, one key topic that we saw both in the LDA and in our own review process is a strong focus on ethnic identification and cultural identity ratings \citep[e.g.,][]{Jadalla2015, Mchitarjan2015}. Other important topics were belief- \citep[e.g.,][]{Klonoff2000} and value endorsement \citep[e.g.,][]{Kim2010a, Wolfe2001, Duarte2020}, as well as preferences \citep[e.g.,][]{BenetMartinez2006, Tull2003}. 

Among the affective acculturation measurements an important distinction was the separation by valence, often either assessing joy and happy \citep[e.g.,][]{Phinney1992, Cuellar1995a}, or anxiety and loneliness \citep[e.g.,][]{Shin1999, Perez2019}. A second observation was a particular focus on self-conscious emotions, such as pride and shame \citep[e.g.,][]{Tsai2000, Suinn1992}. A third pattern was that most of the emotional measurements were of social emotions, such as comfort and discomfort \citep[e.g.,][]{Stephenson2000}, or belonging and connectedness feelings \citep[e.g.,][]{Kouli2009, Harder2018}. 

Most of the motivational acculturation measurements (i.e., desires) were related to wishes and wants for the future \citep[e.g.,][]{Mancini2014, Ben-Shalom2003}. However, there was a smaller subset of scales explicitly addressing specific motives, such as transition motives \citep[][]{Mchitarjan2015}, motivation for cultural exploration and maintenance \citep[][]{Recker2017}. 

It should be noted that with the psychometric literature we saw a larger number of instances where items targeted multiple experience aspects \citep[e.g., enjoyment of wearing traditional clothing,][]{Ozer2016} as well as the measurement of concepts that included multiple experience aspects \citep[e.g., satisfaction,][]{Cuellar1995a}.

Finally, there were a few additional patterns that were particularly hightlighted by the LDA topic modeling. These issues included a focus on navigating everyday life issues \citep[e.g.,][]{Harder2018}, and acculturation hassles \citep[e.g.,][]{Vinokurov2002}, as well the importance of family and generational differences \citep[e.g.,][]{ICSEYteam2006, Lee2004b}. Similarly, the topics showcased that the validated scales tended to focus on specific cultural pairs, such as migrants from the former UDSSR in Israel, or Mexicans and East Asians in North America (for more information on the migration context see Supplemental Material E). Please also note that we developed an interactive scale directory, where users can explore the content of the included acculturation scales on their own (see Supplemental Material D).

\subsection{Empirical Literature}

```{r EmpiricalExclusion, include=F}
dt.Empirical.unique <- dt.Empirical %>%
  filter(SearchDuplicate != "TRUE")

dt.Empirical.title <- dt.Empirical %>%
  filter(TitleScreening == 1)

# abstract screening
dt.Empirical.abstract <- dt.Empirical %>%
  filter(TitleScreening == 1,
         AbstractScreening == 1)

# full text screening
dt.Empirical.fulltext <- dt.Empirical %>%
  filter(TitleScreening == 1,
         AbstractScreening == 1,
         MissingABCD == 0)

# included (empirical)
dt.Empirical.included <- dt.Empirical %>%
  filter(TitleScreening == 1,
         AbstractScreening == 1,
         MissingABCD == 0,
         empirical != 0)

# reasons for exclusion
empiricalExclTitle <- data.frame(table(Exclusion = dt.Empirical$TitleNote)) %>%
  mutate(screening = "Title") %>%
  arrange(desc(Freq))

empiricalExclAbstract <- data.frame(table(Exclusion = dt.Empirical$AbstractNote)) %>%
  mutate(screening = "Abstract") %>%
  arrange(desc(Freq))

empiricalExclFull <- data.frame(table(Exclusion = dt.Empirical.abstract$NoteMissing)) %>%
  mutate(screening = "Full Text") %>%
  arrange(desc(Freq))

rbind(empiricalExclTitle, empiricalExclAbstract, empiricalExclFull) %>%
  reshape(., idvar = "Exclusion", timevar = "screening", direction = "wide") %>%
  mutate_if(is.numeric, ~replace(., is.na(.), "")) %>%
  rename_at(vars(starts_with("Freq.")),
            funs(sub("Freq[.]", "", .))) %>%
  rename(., "Exclusion Reason" = Exclusion) %>%
  kbl(., 
        #label = "",
        caption = "Exclusion Reasons Empirical Literature",
        format = "latex",
        linesep = "",
        booktabs = T,
        align = c("l", "c", "c", "c"))  %>%
  add_header_above(., c(" ", "Screening" = 3)) %>%
  kable_styling(position = "left") %>%
  #gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  gsub("\\begin{table}", "\\begin{table}\n\\begin{minipage}[t][\\textheight][t]{\\textwidth}", ., fixed = TRUE) %>% # fix table position
  gsub("\\end{table}", "\\end{minipage}\n\\end{table}", ., fixed = TRUE) %>% # fix table position
  save_kable("Tables/EmpiricalExclusion.tex")

empiricalEclCombined <- rbind(empiricalExclTitle, empiricalExclAbstract, empiricalExclFull) %>%
  reshape(., idvar = "Exclusion", timevar = "screening", direction = "wide") %>%
  mutate_if(is.numeric, ~replace(., is.na(.), "")) %>%
  rename_at(vars(starts_with("Freq.")),
            funs(sub("Freq[.]", "", .))) %>%
  rename(., "Exclusion Reason" = Exclusion) 
```

```{r ExclusionsCombined, include=F}
exclMerged01 <- merge(theoryExclCombined, empiricalEclCombined, by = "Exclusion Reason", suffixes = c(".Theory",".Empirical"), all=T)
exclMerged02 <- merge(exclMerged01, scalesExcl %>% rename("Full Text.Scale" = "Full Text"), by = "Exclusion Reason", all=T)
reasonOrder <- c("not English", "not migration", "not migrant", "not acculturation", "not ABCD", "not theory", "not measured",
                 "items not accessible", "thesis not accessible", "article not accessible", "book not accessible", "chapter not accessible",
                 "poster not accessible", "should still be coded")

options(knitr.kable.NA = '')
exclMerged02 %>%
  slice(match(reasonOrder, `Exclusion Reason`)) %>%
  mutate(across(where(is.character), as.numeric)) %>%
  relocate("Full Text.Scale", .after = "Full Text.Theory") %>%
  kbl(., 
        #label = "",
        col.names = c("Reason", 
                      "Title", "Abstract", "Full Text",
                      "Full Text",
                      "Title", "Abstract", "Full Text"),
        caption = "Exclusion Reasons for all Literature Levels",
        format = "latex",
        linesep = "",
        booktabs = T,
        align = c("l", rep("c", length(exclMerged02)-1)))  %>%
  add_header_above(., c(" ", "Theoretical" = 3, "Psychometric", "Empirical" = 3)) %>%
  kable_styling(position = "left") %>%
  #gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  gsub("\\begin{table}", "\\begin{table}\n\\begin{minipage}[t][\\textheight][t]{\\textwidth}", ., fixed = TRUE) %>% # fix table position
  gsub("\\end{table}", "\\end{minipage}\n\\end{table}", ., fixed = TRUE) %>% # fix table position
  save_kable("Tables/ExclusionsCombined.tex")

```

```{r prismaEmpirical, include=F}
prismaGr(found = nrow(dt.Empirical),
         found_other = 133,
         no_dupes = nrow(dt.Empirical.unique), 
         screened = nrow(dt.Empirical.unique), 
         screen_exclusions = nrow(dt.Empirical.unique)-nrow(dt.Empirical.abstract), 
         full_text = nrow(dt.Empirical.abstract),
         full_text_exclusions = nrow(dt.Empirical.abstract)-nrow(dt.Empirical.fulltext), 
         qualitative = nrow(dt.Empirical.fulltext), 
         quantitative = nrow(dt.Empirical.included),
         extra_dupes_box = F,
         width = 800, height = 800) %>%
  export_svg() %>%
  charToRaw %>% 
  rsvg_pdf("./Figures/PrismaEmpirical.pdf")
```

At the most applied level, we assessed the broader empirical studies. This final database included the largest number of manuscripts and is in theory the application of the theoretical and psychometric literature. The search produced a total of `r format(nrow(dt.Empirical), big.mark=",")` results to which we added 133 articles through contacts with experts in the field and from referenced works within the review. After duplicate removal, title--, abstract--, and full-text screening we coded a total of `r nrow(dt.Empirical.included)` empirical works (for exclusion reasons see \tblref{tab:ExclusionsCombined} and for the PRISMA diagram see \fgrref[ C]{fig:PrismaCombined}).

<!-- Scale  chart goes somewhere here} -->

<!-- \begin{figure}[h] -->

<!-- \centering -->

<!-- \caption{PRISMA diagram. Position still undecided. Currently generated in R based on n(row) maybe make prettier.} -->

<!-- \includegraphics[width=\textwidth]{Figures/PRISMA} -->

<!-- \label{fig:PRISMA} -->

<!-- \end{figure} -->

<!-- \input{Tables/EmpiricalExclusion} -->

<!-- \input{Tables/ExclusionsCombined} -->

\subsubsection{Methods}

\paragraph{Dataset}

```{r EmpiricalPublicationType, include=F}
empPubType <- as.data.frame(summarytools::freq(dt.Empirical.included$PublicationType, order = "freq"))

empDataType <- as.data.frame(summarytools::freq(dt.Empirical.included$Method, order = "freq"))

empTerm <- as.data.frame(summarytools::freq(tolower(dt.Empirical.included$term), order = "freq"))
empTermAcc <- sum(empTerm[grepl("acculturat", rownames(empTerm), fixed = T),]$Freq)
empTermInt <- sum(empTerm[grepl("integrat", rownames(empTerm), fixed = T),]$Freq)

empMeasure <- as.data.frame(summarytools::freq(tolower(dt.Empirical.included$MeasureDefinition), order = "freq"))

empMajority <- as.data.frame(summarytools::freq(tolower(dt.Empirical.included$IncludesMajority), order = "freq"))
names(empMajority) <- gsub("% ", "Perc", names(empMajority))

empVarType <- as.data.frame(summarytools::freq(tolower(dt.Empirical.included$VariableType), order = "freq"))
names(empVarType) <- gsub("% ", "Perc", names(empVarType))

empFocus <- as.data.frame(summarytools::freq(tolower(dt.Empirical.included$domainPaper), order = "freq"))
names(empFocus) <- gsub("% ", "Perc", names(empFocus))
empFocusAcc <- sum(empFocus[grepl("acculturation|assimilation|integration|adjustment|adaptation", rownames(empFocus)),]$Freq)
empFocusAccPerc <- sum(empFocus[grepl("acculturation|assimilation|integration|adjustment|adaptation", rownames(empFocus)),]$PercValid)
empFocusHealth <- sum(empFocus[grepl("health|stress|depression|disorder", rownames(empFocus)),]$Freq)
empFocusHealthPerc <- sum(empFocus[grepl("health|stress|depression|disorder", rownames(empFocus)),]$PercValid)
empFocusRelation <- sum(empFocus[grepl("relations|intergroup|multiculturalism", rownames(empFocus)),]$Freq)
empFocusRelationPerc <- sum(empFocus[grepl("relations|intergroup|multiculturalism", rownames(empFocus)),]$PercValid)

empYear <- as.data.frame(summarytools::freq(dt.Empirical.included$year, order = "freq"))
names(empYear) <- gsub("% ", "Perc", names(empYear))
```

Of the final works we coded, `r empPubType["journalArticle",]$Freq` were journal articles, `r empPubType["thesis",]$Freq` theses, and `r empPubType["bookSection",]$Freq` book chapters. Most studies presented quantitative data (\textit{N} = `r empDataType["quantitative",]$Freq`), mixed methods (\textit{N} = `r empDataType["mixed method",]$Freq`), or qualitative data (\textit{N} = `r empDataType["qualitative",]$Freq`), while the remaining `r empDataType["Review",]$Freq` manuscripts were reviews of empirical data. Notably, a majority of the empirical investigations did not share common measures of acculturation --- `r sum(empMeasure$Freq[empMeasure$Freq<=5])` studies used measures that were reported a maximum of five times. A considerable majority of papers with uncommon measures used new or ad-hoc measures of acculturation. Less than a fifth of studies included local majority group members in the study (\textit{N} = `r empMajority["1",]$Freq`, `r round(empMajority["1",]$PercValid,2)`%). Acculturation most frequently was a predictor variable (\textit{N} = `r empVarType["predictor",]$Freq`, `r round(empVarType["predictor",]$PercValid,2)`%), a dependent variable (\textit{N} = `r empVarType["dependent",]$Freq`, `r round(empVarType["dependent",]$PercValid,2)`%), or a correlation variable (\textit{N} = `r empVarType["correlation",]$Freq`, `r round(empVarType["correlation",]$PercValid,2)`%) in the empirical works. This pattern was mirrored when looking at the focus of the papers, where a majority of the papers had acculturation as their main focus (\textit{N} = `r empFocusAcc`, `r round(empFocusAccPerc,2)`%), with other bodies of work focusing on health outcomes (\textit{N} = `r empFocusHealth`, `r round(empFocusHealthPerc,2)`%), or inter-group relations (\textit{N} = `r empFocusRelation`, `r round(empFocusRelationPerc,2)`%) as their main outcomes. The earliest included study was published in `r min(dt.Empirical.included$year)`, with a strong increase of publications after the year 2000, and a peak of publications in 2012. We provide full descriptions of data extractions and additional information about the data description in Supplemental Material C.

\paragraph{Experience Aspects}

```{r EmpiricalKappa}
names <- c("Affect", "Behavior", "Cognition", "Desire")
kEmp <- dt.Empirical.included %>%
  select(Affect, Affect2, Behavior, Behavior2, Cognition, Cognition2, Desire, Desire2) %>%
  mutate_all(~replace_na(., 0)) %>%
  kappa.full.multiple(., names)
kEmpPooled <- kappa.pooled2(kEmp)
```

```{r EmpircalExperienceRecode}
# store first coder under suffix "1" and then recode the "Final" suffixed into the plain ABCD.
dt.Empirical.included <- dt.Empirical.included %>%
  mutate(Affect1 = Affect, Behavior1 = Behavior, Cognition1 = Cognition, Desire1 = Desire) %>%
  mutate(Affect = AffectFinal, Behavior = BehaviorFinal, Cognition = CognitionFinal, Desire = DesireFinal)
```

Extraction of the used experience aspects mirrored the psychometric literature assessment and we primarily focused on the measured concepts and their operationalizations (also see \tblref{tab:AspectExamples}). The only exception were qualitative studies, which we coded following the same codebook of the theoretical literature. All aspects were coded by two independent coders (all inter-rater agreements were `r format(round(min(kEmp$Po, na.rm = TRUE)*100, 2), nsmall=2)`% or above and all Cohen's $\varkappa$s were above `r format(round(min(kEmp$k, na.rm = TRUE), 2), nsmall=2)`, $\varkappa_{pooled}$ = `r format(round(kEmpPooled$k.pooled, 2), nsmall=2)`; for full inter-rater reliability see Supplemental Material E) and inconsistencies were resolved after discussion.

\paragraph{Process}

To assess the static or dynamic conceptualization of the empirical studies, we again collected information on assessed migration times (e.g., pre-migration, post-migration) and additionally coded the type of data collected and analyzed (e.g., cross-sectional, longitudinal data and data analysis).

\paragraph{Field of Publication}

For the broader empirical literature, we also collected additional data on the field the studies were published in. To that end, we merged the 'Scimago Journal Ranking Database' \citep{SCImago2020} with our database. For all available journal articles, we added information on key journal metrics (incl. H index, impact factor, and data on the field and audiences). This also meant that dissertations, book chapters, and books were excluded from this analysis because data on their publishers is not readily available or unreliable. Additionally, `r nrow(psychData %>% filter(PublicationType == "journalArticle", is.na(PublicationTitleDb)) %>% dplyr::select(PublicationTitle) %>% unique())` journals were not included in the Scimago database (because they do not have an ISSN identifier or were discontinued before 1996, see Online Appendix B for the missing journals). We ultimately had journal metrics for `r nrow(psychData %>% filter(!is.na(PublicationTitleDb)))` empirical articles. <!-- The Scimago database classifies each journal according to the field(s) that the journal aims to address. Importantly, (1) each journal can be be classified to address multiple fields and (2) the field include codes of fields (e.g., Social Sciences) as well as sub-fields (e.g., Social Psychology). This leads to the case that there can be substantial overlap between fields, and journals cannot readily be assessed in mutually exclusive subgroups. -->

```{r disciplines, include=F}
empDisciplines <- as.data.frame(summarytools::freq(empiricalDataDisciplines$discipline02, order = "freq"))
names(empDisciplines) <- gsub("% ", "Perc", names(empDisciplines))
```

To summarize the journal data we then classified the journal fields into super-ordinate discipline codes. These discipline codes are based in part on the U.S. Department of Education's subject classifications \citep[i.e., CIP,][]{InstituteofEducationSciences2020}, the U.K. academic coding system \citep[JACS 3.0,][]{HigherEducationStatisticsAgency2013}, the Australian and New Zealand Standard Research Classification \citep[ANZSRC 2020,][]{AustralianBureauofStatistics2020}, as well as the Fields of Knowledge project \citep{ThingsmadeThinkable2014}. We ultimately classified each journal into one of four mutually exclusive disciplines ('psychology': \textit{N} = `r empDisciplines["Psychology",]$Freq`, 'multidisciplinary': \textit{N} = `r empDisciplines["Multidisciplinary / Crossdisciplinary",]$Freq`, 'medicine, nursing, and health': \textit{N} = `r empDisciplines["Medicine, Nursing, & Health",]$Freq`, and 'social sciences (miscellaneous)': \textit{N} = `r empDisciplines["Social Sciences (miscellaneous)",]$Freq`. For a full discussion of the classifications see Online Supplemental Material C).

\subsubsection{Results}

```{r EmpElementCalc, include=F}
# Count the times each dimension is measured
EmpElementFreq <- dt.Empirical.included %>%
  dplyr::select(Affect, Behavior, Cognition, Desire) %>%
  mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  colSums(., na.rm = FALSE, dims = 1) 

# transform to data frame and make row names name variable
EmpElementFreq <- data.frame(Element = names(EmpElementFreq), 
                            Frequency = EmpElementFreq, 
                            Percentage = EmpElementFreq/nrow(dt.Empirical.included)*100) %>%
  mutate(Element = fct_reorder(Element, Frequency))

# frequency of unique combinations
EmpElementCombFreq <- dt.Empirical.included %>%
  dplyr::select(Affect, Behavior, Cognition, Desire) %>%
  #mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  group_by(Affect, Behavior, Cognition, Desire) %>%
  summarise(Frequency = n()) %>%
  ungroup() %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T))

# fill replace ones with colnames to be combined
for (i in 1:4) {
    EmpElementCombFreq[[i]] <- str_replace(as.character(EmpElementCombFreq[[i]]), "1", colnames(EmpElementCombFreq)[i])
}

# collect Elements names for each combination
EmpElementCombFreq <- EmpElementCombFreq %>%
  unite("ExperienceCombination",c("Affect", "Behavior", "Cognition", "Desire"), na.rm = TRUE, sep = ", ") %>%
  mutate(ExperienceCombination = fct_reorder(ExperienceCombination, Frequency),
         Percentage = Frequency/nrow(dt.Empirical.included)*100,
         Affect = ifelse(grepl("Affect", ExperienceCombination, fixed = TRUE), 1,0),
         Behavior = ifelse(grepl("Behavior", ExperienceCombination, fixed = TRUE), 1,0),
         Cognition = ifelse(grepl("Cognition", ExperienceCombination, fixed = TRUE), 1,0),
         Desire = ifelse(grepl("Desire", ExperienceCombination, fixed = TRUE), 1,0)) %>%
  arrange(Frequency)

empComplexity <- EmpElementCombFreq %>%
  select(complexity, Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency),
            Percentage = sum(Frequency)/nrow(dt.Empirical.included)*100) %>%
  ungroup() %>%
  mutate(complexity = as.factor(complexity),
         complexity = fct_reorder(complexity, Frequency))

# overall complexity
empComplexityAverage <- weighted.mean(as.numeric(as.character(empComplexity$complexity)), empComplexity$Frequency)
empComplexitySD <- wtd.var(x = as.numeric(as.character(empComplexity$complexity)), weights = empComplexity$Frequency)

# Scale complexity for each element
empElementComplexity <- EmpElementCombFreq %>%
  gather(key = "Element", value = "ElementDum", Affect, Behavior, Cognition, Desire) %>%
  filter(ElementDum == 1) %>%
  group_by(Element) %>%
  summarise(avgComplexity = weighted.mean(x = complexity, w = Frequency),
            sdComplexity = wtd.var(x = complexity, weights = Frequency),
            n = sum(Frequency)) %>%
  ungroup() %>%
  mutate(seComplexity = sdComplexity/sqrt(n)) %>%
  arrange(-avgComplexity)
```

```{r CombinedElementComplexity, include=F}
rowPack <- c("Theoretical"=4, "Methdological"=4, "Empirical"=4)
  
rbind(TheoElementComplexity %>% arrange(Element), 
      scaleElementComplexity %>% arrange(Element), 
      empElementComplexity %>% arrange(Element)) %>%
  select(Aspect = Element, Mean = avgComplexity, `Standard Deviation`=sdComplexity, `Standard Error`=seComplexity) %>%
  kbl(., 
        #label = "",
        caption = "Element Complexity for all Literature Levels. Average Complexity of Conceptualizations that include the given aspect.",
        format = "latex", 
        linesep = "",
        booktabs = T,
        align = c("l", rep('c', ncol(empElementComplexity)-2)))  %>%
  pack_rows(index = rowPack) %>%
  kable_styling(position = "left") %>%
  gsub("Aspect &", "\\multicolumn{1}{c}{Aspect} &", ., fixed = TRUE) %>% # fix Aspect title align
  gsub("\\begin{table}", "\\begin{table}\n\\begin{minipage}[t][\\textheight][t]{\\textwidth}", ., fixed = TRUE) %>% # fix table position
  gsub("\\end{table}", "\\end{minipage}\n\\end{table}", ., fixed = TRUE) %>% # fix table position
  #gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  save_kable("Tables/CombinedElementComplexity.tex")
```

```{r EmpiricalElementCooccurrences, include=F}
# make crossproduct matrix to condense co-occurrences (off-diagonals) and get frequencies (diagonals)
empElementCooccure <- as.matrix(dt.Empirical.included %>% dplyr::select(Affect, Behavior, Cognition, Desire) %>% mutate_all(~replace(., is.na(.), 0)))
empElementCooccure <- crossprod(empElementCooccure)  # Same as: t(X) %*% X
#diag(empElementCooccure) <- 0       # remove frequencies on diagonals
#empElementCooccure[upper.tri(empElementCooccure)] <- ""

empElementCooccure %>%
  kbl(., 
        #label = "",
        caption = "Empirical Literature: Element Co-occurrence Matrix",
        format = "latex", 
        linesep = "",
        booktabs = T,
        align = rep('c', ncol(empElementCooccure)))  %>%
  kable_styling(position = "left") %>%
  #gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  gsub("\\begin{table}", "\\begin{table}\n\\begin{minipage}[t][\\textheight][t]{\\textwidth}", ., fixed = TRUE) %>% # fix table position
  gsub("\\end{table}", "\\end{minipage}\n\\end{table}", ., fixed = TRUE) %>% # fix table position
  #gsub("\\caption{\\label{tab:}", paste0("\\label{tab:", knitr::opts_current$get('label'), "}\n\\caption{"), ., fixed = TRUE) %>% # fix latex label
  save_kable("Tables/EmpiricalElementCooccurrences.tex")
```

We assessed the role of experience aspects in the measurement and then compared differences between fields.

\paragraph{ABCD prevalence.}
In terms of the overall frequencies of experience elements, the broader empirical data mirrored that of the psychometric literature. Most studies included a measure of cognition (`r round(EmpElementFreq$Percentage[EmpElementFreq$Element=="Cognition"],2)`%) and behavior (`r round(EmpElementFreq$Percentage[EmpElementFreq$Element=="Behavior"],2)`%), whereas only about half of all studies included a measure of affect (`r round(EmpElementFreq$Percentage[EmpElementFreq$Element=="Affect"],2)`%) and less than a fifth of the studies included a measure of desires (`r round(EmpElementFreq$Percentage[EmpElementFreq$Element=="Desire"],2)`%). Yet, only `r empComplexity$Frequency[empComplexity$complexity=="1"]` studies focused on a single experience aspect ($N_{behavior\ only}$ = `r EmpElementCombFreq$Frequency[EmpElementCombFreq$ExperienceCombination=="Behavior"]`, $N_{cognition\ only}$ = `r EmpElementCombFreq$Frequency[EmpElementCombFreq$ExperienceCombination=="Cognition"]`, $N_{emotion\ only}$ = `r EmpElementCombFreq$Frequency[EmpElementCombFreq$ExperienceCombination=="Affect"]`). Similarly, only `r empComplexity$Frequency[empComplexity$complexity=="4"]` papers included measures of all four experience aspects (`r round(empComplexity$Percentage[empComplexity$complexity=="4"],2)`%). Most studies measured three (`r round(empComplexity$Percentage[empComplexity$complexity=="3"],2)`%) or two aspects (`r round(empComplexity$Percentage[empComplexity$complexity=="2"],2)`%; \textit{M} = `r format(round(empComplexityAverage,2),nsmall=2)`, \textit{SD} = `r format(round(empComplexitySD,2),nsmall=2)`). Different from the scale validations, within the broader empirical works, most works included measures of emotions, behaviors, and cognitions (\textit{N} = `r EmpElementCombFreq$Frequency[EmpElementCombFreq$ExperienceCombination=="Affect, Behavior, Cognition"]`, `r round(EmpElementCombFreq$Percentage[EmpElementCombFreq$ExperienceCombination=="Affect, Behavior, Cognition"],2)`%), with a further substantial number of articles measuring behaviors and cognitions (\textit{N} = `r EmpElementCombFreq$Frequency[EmpElementCombFreq$ExperienceCombination=="Behavior, Cognition"]`, `r round(EmpElementCombFreq$Percentage[EmpElementCombFreq$ExperienceCombination=="Behavior, Cognition"],2)`%. Also see \fgrref{fig:EmpPlotFreq-1} and \tblref{tab:CombinedCooccurrences}). 

\paragraph{ABCD composition.}
Looking at the number of aspects measured together we again see substantial differences in what kind of scales include the individual aspects. Scales that included cognitions measured an average of `r format(round(empElementComplexity$avgComplexity[empElementComplexity$Element=="Cognition"],2)-1,nsmall=2)` other aspects (\textit{SD} = `r format(round(empElementComplexity$sdComplexity[empElementComplexity$Element=="Cognition"],2),nsmall=2)`), scales measuring behavior, on average, measured `r format(round(empElementComplexity$avgComplexity[empElementComplexity$Element=="Behavior"],2)-1,nsmall=2)` other aspects (\textit{SD} = `r format(round(empElementComplexity$sdComplexity[empElementComplexity$Element=="Behavior"],2),nsmall=2)`), while scales that included affect measured an average of `r format(round(empElementComplexity$avgComplexity[empElementComplexity$Element=="Affect"],2)-1,nsmall=2)` other experience aspects (\textit{SD} = `r format(round(empElementComplexity$sdComplexity[empElementComplexity$Element=="Affect"],2),nsmall=2)`) and scales measuring desires even measured an average of `r format(round(empElementComplexity$avgComplexity[empElementComplexity$Element=="Desire"],2)-1,nsmall=2)` other experience aspects (\textit{SD} = `r format(round(empElementComplexity$sdComplexity[empElementComplexity$Element=="Desire"],2),nsmall=2)`; also see \fgrref{fig:LiteratureComparison}). Thus, not a single study measured only motivational acculturation (i.e., desires), and measures of desires remained mostly limited to scales that were already measuring many of the other experience aspects. The results exacerbate the pattern found in the scale validations, complex measures and conceptions of acculturation are seen infrequently and external aspects of cognition and behavior remain the focus of most studies.

```{r EmpPlotFreq, include=F, fig.width=12, fig.height=12}
# barplot of dimension frequency
EmpABCDBar <- ggplot(data=EmpElementFreq, aes(x=Element, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    #aes(label = paste0("N = ",Frequency)),
    aes(label = paste0(format(round(Percentage,2), nsmall=2), "%")),
    position=position_stack(vjust=0.5),
    color = "white",
    size = 4,
    vjust = 0.5
    ) +
  labs(title = "Element Frequency",
       y = "Frequency across all Scales",
       x = "Experience Element")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=10, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold"),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.position="none")

# barplot of complexity frequency
EmpComplexityBar <- ggplot(data=empComplexity, aes(x=complexity, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    #aes(label = paste0("N = ",Frequency)),
    aes(label = paste0(format(round(Percentage,2), nsmall=2), "%")),
    position=position_stack(vjust=0.5),
    color = "white",
    size = 4,
    vjust = 0.5
    ) +
  labs(title = "Scale Complexity",
       y = "Frequency across all Scales",
       x = "Complexity")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=10, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold"),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.position="none")


# bar plot frequencies
EmpABCDComb <- ggplot(EmpElementCombFreq, aes(x=ExperienceCombination, y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    aes(y=Percentage, label = paste0(format(round(Percentage,2), nsmall=2),"% [N = ", Frequency, "]")),
    color = "grey14",
    size = 4,
    hjust = -.1,
    inherit.aes = TRUE
    ) +
  scale_y_continuous(limits = c(0, ceiling(max(EmpElementCombFreq$Percentage)*1.15)),
                     breaks = seq(0, ceiling(max(EmpElementCombFreq$Percentage)*1.15), 5))+
  labs(y = "Proportion of all scales [in %]",
       x = "Combination of Experience Elements")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14"),
        strip.text = element_text(colour = 'white', face="bold"),
        legend.position="none")

# draw combined graph
ggdraw() +
  draw_plot(EmpABCDComb, x = 0, y = 0.3, width = 1, height = .7)+
  draw_plot(EmpABCDBar, x = 0, y = 0, width = .55, height = .3) +
  draw_plot(EmpComplexityBar, x = .55, y = 0, width = .45, height = .3) +
  draw_plot_label(c("(A)", "(B)", "(C)"), c(0, 0, 0.55), c(1, 0.3, 0.3), size = 15)
```

```{r EmpElementComplexityBar, include=F}
# bar plot complexity for each element
ggplot(data=empElementComplexity, aes(x=reorder(Element, avgComplexity), y=avgComplexity)) +
  geom_bar(stat="identity", fill="grey") +
  geom_errorbar(aes(ymin=avgComplexity-1.96*seComplexity, ymax=avgComplexity+1.96*seComplexity), width=.2,position=position_dodge(.9)) +
  geom_text(
    aes(label = paste0("M = ",round(avgComplexity,2))),
    position=position_stack(vjust=0.5),
    color = "black",
    #size = 2.5,
    vjust = 0.5
    ) +
  labs(title = "Scale Complexity by Element [Mean  95%CI]",
       y = "Number of Aspects in Scales that include Element",
       x = "Element")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_text(face="bold"),
        axis.title.y = element_text(face="bold"),
        plot.title = element_text(face="bold", hjust = 0.5),
        #legend.text = element_text(size=10),
        #axis.text.x = element_text(size=10),
        #axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        #strip.text = element_text(colour = 'white', face="bold"),
        #panel.background = element_rect(fill = "transparent"),
        #plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.title = element_blank())
```

<!-- Scale  chart goes somewhere here} -->

```{=tex}
\begin{figure}[h]
\centering
\caption{Psychological Acculturation Aspects within the Empirical Literature. (A) Bar graph showing the common combinations of the affect, behavior, cognition, desire experience aspects. (B) Bar graph showing the prevalence of each experience aspect within the literature. (C) Bar graph showing how many experience aspects were considered together.}
\includegraphics[width=\textwidth]{Figures/EmpPlotFreq-1}
\label{fig:EmpPlotFreq-1}
\end{figure}
```
<!-- \input{Tables/EmpiricalElementCooccurrences}   -->

<!-- Process -->

```{r EmpProcess, include=F}
empMigrationTime <- as.data.frame(summarytools::freq(dt.Empirical.included$MigrationTime, order = "freq"))
names(empMigrationTime) <- gsub("% ", "Perc", names(empMigrationTime))


empAnalysis <- as.data.frame(summarytools::freq(dt.Empirical.included$MainAnalysis, order = "freq"))
names(empAnalysis) <- gsub("% ", "Perc", names(empAnalysis))

EmpLong <- sum(empAnalysis[grepl("lagged|longitudinal|dynamic", rownames(empAnalysis)),]$Freq)
EmpLongPerc <- round(sum(empAnalysis[grepl("lagged|longitudinal|dynamic", rownames(empAnalysis)),]$PercValid),2)
```

\paragraph{Process.}
To assess the process focus of the broader empirical works, we again assessed when in the migration process the data was collected and we additionally assessed the type analysis done by the authors. We found that `r empMigrationTime["post",]$Freq` studies (`r round(empMigrationTime["post",]$PercValid,2)`%) collected data after the arrival of the migrant in the new society. Two studies targeted potential migrants and `r empMigrationTime["pre & post",]$Freq` studies collected data prior to and following the migration event. Moreover, only `r EmpLong` studies included longitudinal data analyses of psychological acculturation (`r EmpLongPerc`%). This observation again underscores the arguments that the acculturation literature has thus far failed to provide data that meaningfully captures migration as a process \citep[e.g.,][]{Brown2011, Ward2019}.


```{r empiricalScaleDescr, include=FALSE}
empMeasurement <- as.data.frame(summarytools::freq(dt.Empirical.included$MeasureDefinition, order = "freq"))
```

\paragraph{Content.}
When considering the content of the empirical conceptualizations of psychological acculturation, the content largely mirrors that of the psychometric literature, whenever authors used validated acculturation scales. However, there were a few conceptualizations that were favored in empirical practice. One such focus has been that specific acculturation scales were used more frequently. These favored scales including the 'Vancouver Index of Acculturation' \citep[][]{Ryder2000}, the 'Language, Identity, and Behavioral Acculturation Scale', 'Stephenson Multigroup Acculturation Scale' \citep[][]{Stephenson2000}, as well as scales focusing on Hispanic migrants \citep[][]{Cuellar1995a, Marin1987, Marin1987}.

Another major pattern within the conceptualizations of applied empirical works has been the use of modified, abridged, or shortened versions of established scales \citep[e.g.,][]{Green2014,Im2009}. These scales often used a subset of questions from the validated scales, for example by choosing a specific aspect only (e.g., media consumption). This is different from the use of 'adapted' scales, where authors usually only replaced the name of the dominant and non-dominant cultural groups to adapt the scale to their context.

An even more extreme version of this pattern has been the observation that a sizable number of empirical studies has used non-validated scales. These measurements were often short (i.e., 1-3 items) and lacked psychometric validation. Common uses were single items on language use, employment status, or cultural identification. It should be noted that for many of these studies acculturation was not a key concept of interest, but rather a covariate or partial outcome variable (for more information on these conceptualizations see Supplemental Material C). 

\paragraph{Comparison publication fields.}
To further assess the comparative utility of the experience framework, we then assessed differences of experience aspects between academic fields. For the full results, including differences in the methods, and publication types as well as contextual differences in terms of sampling procedures, situational domains, analyses, and cultural contexts see Supplemental Material C.

```{r FieldCalc, include=F}
field_labs_shrt <- c(
  'Psychology'="Psych.",
  'Medicine, Nursing, & Health'="Med.",
  'Social Sciences (miscellaneous)'="SocSci.",
  'Multidisciplinary / Crossdisciplinary'="Multi."
)

field_labs_lng <- c(
  'Psychology'="Psychology",
  'Medicine, Nursing, & Health'="Medicine",
  'Social Sciences (miscellaneous)'="Social Sci.",
  'Multidisciplinary / Crossdisciplinary'="Multidiscipl."
)

# Frequency of elements (within each field)
FieldElementFreq <- empiricalDataDisciplines %>%
  dplyr::select(discipline02, Affect, Behavior, Cognition, Desire) %>%
  gather(Element, Frequency, -discipline02) %>%
  group_by(discipline02, Element) %>%
  summarise_each(funs(sum(., na.rm = TRUE))) %>%
  ungroup() 
FieldN <- as.data.frame(table(discipline02 = empiricalDataDisciplines$discipline02), responseName = "n")

FieldElementFreq <- merge(FieldElementFreq, FieldN) %>%
  mutate(Percentage = Frequency/n*100)
  
# frequency of unique element combinations (within each field)
FieldElementCombFreq <- empiricalDataDisciplines %>%
  dplyr::select(Affect, Behavior, Cognition, Desire, discipline02) %>%
  #mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  group_by(Affect, Behavior, Cognition, Desire, discipline02) %>%
  summarise(Frequency = n()) %>%
  ungroup() %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T))

# fill replace ones with colnames to be combined
for (i in 1:4) {
    FieldElementCombFreq[[i]] <- str_replace(as.character(FieldElementCombFreq[[i]]), "1", colnames(FieldElementCombFreq)[i])
}

# collect Elements names for each combination
FieldElementCombFreq <- FieldElementCombFreq %>%
  unite("ExperienceCombination",c("Affect", "Behavior", "Cognition", "Desire"), na.rm = TRUE, sep = ", ") %>%
  group_by(discipline02) %>%
  mutate(ExperienceCombination = fct_reorder(ExperienceCombination, Frequency),
         Percentage = Frequency/sum(Frequency)*100,
         Affect = ifelse(grepl("Affect", ExperienceCombination, fixed = TRUE), 1,0),
         Behavior = ifelse(grepl("Behavior", ExperienceCombination, fixed = TRUE), 1,0),
         Cognition = ifelse(grepl("Cognition", ExperienceCombination, fixed = TRUE), 1,0),
         Desire = ifelse(grepl("Desire", ExperienceCombination, fixed = TRUE), 1,0)) %>%
  arrange(Frequency)

# overall scale complexity (within each field)
FieldComplexity <- FieldElementCombFreq %>%
  select(discipline02, complexity, Frequency, Percentage) %>%
  group_by(discipline02, complexity) %>%
  summarise(Frequency = sum(Frequency),
            Percentage = sum(Percentage)) %>%
  ungroup() %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02"))

FieldAvgComplexity <- FieldElementCombFreq %>%
  group_by(discipline02) %>%
  summarise(n = sum(Frequency),
            avgComplexity = weighted.mean(x = complexity, w = Frequency),
            sdComplexity = wtd.var(x = complexity, weights = Frequency),) %>%
  ungroup() %>%
  mutate(seComplexity = sdComplexity/sqrt(n)) %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02")) %>%
  select(Field = field_labs_lng, n, avgComplexity, sdComplexity, seComplexity)

FieldComplexityAOV <- empiricalDataDisciplines %>%
  select(Affect, Behavior, Cognition, Desire, discipline02) %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02")) %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T),
         field = field_labs_lng) %>%
  mutate_at(vars(Affect, Behavior, Cognition, Desire), funs(ifelse(. == 1, deparse(substitute(.)), "")))  %>%
  unite("ExperienceCombination",c("Affect", "Behavior", "Cognition", "Desire"), na.rm = TRUE, sep = ", ") %>%
  select(field, ExperienceCombination, complexity) %>%
  aov(data = ., complexity ~ field) %>%
  anova

FieldComplexityKruska <- empiricalDataDisciplines %>%
  select(Affect, Behavior, Cognition, Desire, discipline02) %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02")) %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T),
         field = field_labs_lng) %>%
  mutate_at(vars(Affect, Behavior, Cognition, Desire), funs(ifelse(. == 1, deparse(substitute(.)), "")))  %>%
  unite("ExperienceCombination",c("Affect", "Behavior", "Cognition", "Desire"), na.rm = TRUE, sep = ", ") %>%
  select(field, ExperienceCombination, complexity) %>%
  kruskal.test(complexity ~ field, data = .)

FieldComplexityPearsonChiSq <- empiricalDataDisciplines %>%
  select(Affect, Behavior, Cognition, Desire, discipline02) %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02")) %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T),
         field = field_labs_lng) %>%
  tabyl(field, complexity) %>%
  chisq.test

library(effectsize)
FieldComplexityEtaSq <- empiricalDataDisciplines %>%
  select(Affect, Behavior, Cognition, Desire, discipline02) %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02")) %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T),
         field = field_labs_lng) %>%
  aov(data = ., complexity ~ field) %>%
  effectsize::eta_squared(., ci = 0.95)

# Scale complexity for each element (within each field)
FieldElementComplexity <- FieldElementCombFreq %>%
  gather(key = "Element", value = "ElementDum", Affect, Behavior, Cognition, Desire) %>%
  filter(ElementDum == 1) %>%
  group_by(discipline02, Element) %>%
  summarise(avgComplexity = weighted.mean(x = complexity, w = Frequency),
            sdComplexity = wtd.var(x = complexity, weights = Frequency),
            n = sum(Frequency)) %>%
  ungroup() %>%
  mutate(seComplexity = sdComplexity/sqrt(n)) %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02"))

```

We first assessed the references to affect, behavior, cognition, and desires separately, for each of the disciplines. We find that for all fields desires (`r FieldElementFreq %>% filter(Element == "Desire") %>% select(Percentage) %>% min %>% round(.,2)`-`r FieldElementFreq %>% filter(Element == "Desire") %>% select(Percentage) %>% max %>% round(.,2)`% of all measures in the field) and emotions (`r FieldElementFreq %>% filter(Element == "Affect") %>% select(Percentage) %>% min %>% round(.,2)`-`r FieldElementFreq %>% filter(Element == "Affect") %>% select(Percentage) %>% max %>% round(.,2)`%) are the least frequently measured elements and medical journals measure them the least frequently (in proportional terms). Looking at the common cognitive and behavioral elements the proportions diverge between the fields. While the multidisciplinary field measured behaviors (`r FieldElementFreq %>% filter(Element=="Behavior", discipline02=="Multidisciplinary / Crossdisciplinary") %>% select(Percentage) %>% round(.,2)`%) and cognition (`r FieldElementFreq %>% filter(Element=="Cognition", discipline02=="Multidisciplinary / Crossdisciplinary") %>% select(Percentage) %>% round(.,2)`%) almost equally often, in the medical and general social science journals behaviors were measured considerably more often than cognitions ($Behavior_{SoSci}$ = `r  FieldElementFreq %>% filter(Element=="Behavior", discipline02=="Social Sciences (miscellaneous)") %>% select(Percentage) %>% round(.,2)`% \> $Cognition_{SoSci}$ = `r  FieldElementFreq %>% filter(Element=="Cognition", discipline02=="Social Sciences (miscellaneous)") %>% select(Percentage) %>% round(.,2)`%; $Behavior_{Med}$ = `r  FieldElementFreq %>% filter(Element=="Behavior", discipline02=="Medicine, Nursing, & Health") %>% select(Percentage) %>% round(.,2)`% \> $Cognition_{Med}$ = `r  FieldElementFreq %>% filter(Element=="Cognition", discipline02=="Medicine, Nursing, & Health") %>% select(Percentage) %>% round(.,2)`%). Inversely, in the psychological journals cognitions (`r  FieldElementFreq %>% filter(Element=="Cognition", discipline02=="Psychology") %>% select(Percentage) %>% round(.,2)`%) were measured more often than behaviors (`r  FieldElementFreq %>% filter(Element=="Behavior", discipline02=="Psychology") %>% select(Percentage) %>% round(.,2)`%; also see \fgrref[A and B]{fig:FieldPlotFreq}.

When looking at differences in how many different experience aspects were measured together and patterns within these aspect-combinations, differences between the fields become increasingly evident (also see \fgrref[A and C]{fig:FieldPlotFreq}). While 'affect, behavior, and cognition' and 'behavior, and cognition' measures are common combinations across all fields, fewer experience aspects and less variation were considered in the medical and social science fields. There were statistically significant mean differences between the fields in terms of how many experience aspects were considered (parametric: \textit{F}(`r FieldComplexityAOV$Df[1]`, `r FieldComplexityAOV$Df[2]`) = `r round(FieldComplexityAOV[,names(FieldComplexityAOV)=="F value"][1],2)`, \textit{p} = `r round(FieldComplexityAOV[,names(FieldComplexityAOV)=="Pr(>F)"][1],3)`, non-parametric: \textit{Kruskal-Wallis} $\chi^{2}$ = `r round(FieldComplexityKruska$statistic,2)`, \textit{df} = `r FieldComplexityKruska$parameter`, \textit{p} = `r ifelse(round(FieldComplexityKruska$p.value,3)==0, "<.001",format(round(FieldComplexityKruska$p.value,3),nsmall=3))`, $\eta_{p}^{2}$ = `r round(FieldComplexityEtaSq$Eta2,2)`, 95%CI[`r round(FieldComplexityEtaSq$CI_low,2)`, `r round(FieldComplexityEtaSq$CI_high,2)`]). Looking at the mean differences in more detail, empirical works published in psychological journals had significantly higher average aspect counts (\textit{M} = `r FieldAvgComplexity %>% filter(Field=="Psychology") %>% select(avgComplexity) %>% round(.,2)`, \textit{SD} = `r FieldAvgComplexity %>% filter(Field=="Psychology") %>% select(sdComplexity) %>% round(.,2)`) than the medical (\textit{M} = `r FieldAvgComplexity %>% filter(Field=="Medicine") %>% select(avgComplexity) %>% round(.,2)`, \textit{SD} = `r FieldAvgComplexity %>% filter(Field=="Medicine") %>% select(sdComplexity) %>% round(.,2)`) and the general social science journals (\textit{M} = `r FieldAvgComplexity %>% filter(Field=="Social Sci.") %>% select(avgComplexity) %>% round(.,2)`, \textit{SD} = `r FieldAvgComplexity %>% filter(Field=="Social Sci.") %>% select(sdComplexity) %>% round(.,2)`; also see \fgrref{fig:FieldPlotComplexityAverage}). The broader patterns described here thus point to heterogeneity between fields and show that different fields diverge in the number and types of acculturation aspects they tend to consider.

```{r FieldPlotComplexityAverage, include=F, fig.width=10, fig.height=8}
# ## ALTERNATE VERSION WITH VIOLIN PLOT
# # Calculate Complexity for every paper
# FieldIndividualComplexity <- empiricalDataDisciplines %>%
#   dplyr::select(Affect, Behavior, Cognition, Desire, discipline02) %>%
#   #mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
#   mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T)) %>%
#   right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02"))
# 
# library(ggpubr)
# PostHocField <- compare_means(complexity ~ field_labs_lng,  data = FieldIndividualComplexity)
# PostHocFieldFilt <- PostHocField %>% filter(p.adj <=.05)
# my_comparisons <- PostHocFieldFilt %>% select(starts_with("group")) %>% as.matrix(.) %>% split(., seq(nrow(.)))
# 
# ggstatsplot::ggbarstats(
#   data = FieldIndividualComplexity,
#   x = complexity,
#   y = field_labs_lng,
#   #sampling.plan = "jointMulti",
#   results.subtitle = FALSE,
#   proportion.test = FALSE,
#   title = "Measurement Complexity by Discipline",
#   xlab = "Discipline",
#   package = "wesanderson",
#   palette = "Darjeeling2",
#   ggtheme = ggthemes::theme_tufte(base_size = 12),
#   ggplot.component = list(scale_x_discrete(guide = guide_axis(n.dodge = 2))),
#   ggstatsplot.layer = TRUE,
#   label.args = list(check_overlap = TRUE, alpha = 1, fill = "white"),
#   messages = FALSE
# )
# 
# ggplot(FieldIndividualComplexity, aes(y=complexity, x=field_labs_lng, fill=field_labs_lng))+
#   geom_violin(trim = T, width=1) +
#   geom_boxplot(width=0.04,
#                outlier.colour = NULL,
#                outlier.shape = NA,
#                notch=F, fill="black",
#                lwd=1, color="black") +
#   #geom_jitter(width = 0.15,
#   #            shape=18,
#   #            alpha=.5, size=1) +
#   #ggbeeswarm::geom_quasirandom(varwidth = TRUE, alpha = .5)+
#   #ggbeeswarm::geom_beeswarm(size=2,priority='density')+
#   stat_summary(fun.y=mean,
#                geom="point",
#                shape=16,
#                size=1,
#                colour="white") +
#   #stat_summary(fun.data="mean_sdl",
#   #             fun.args = list(mult=1),
#   #             geom="pointrange",
#   #             color = "red",
#   #             width=.2)+
#   stat_summary(geom = "crossbar",
#                width=0.04,
#                fatten=0,
#                color="white",
#                fun.data = function(x){ return(c(y=median(x),
#                                                 ymin=median(x),
#                                                 ymax=median(x))) })+
#   stat_compare_means(label.y = 5)+
#   stat_compare_means(comparisons = my_comparisons, label = "p.signif") +
#   ylab("Number of Elements measured")+
#   xlab("Field") +
#   ggtitle("Distributions Measurement Complexity")+
#   #coord_flip()+
#   scale_fill_brewer(palette = "Pastel1")+
#   scale_y_continuous(breaks = seq(1,4,1))+
#   theme_Publication()+
#   theme(strip.background =element_rect(fill="black", color="black"),
#         strip.text = element_text(colour = 'white', face="bold"),
#         #panel.border = element_rect(color="grey"),
#         legend.position="none")

FieldIndividualComplexity <- empiricalDataDisciplines %>%
  dplyr::select(Affect, Behavior, Cognition, Desire, discipline02) %>%
  #mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T)) %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02"))

library(ggpubr)
PostHocField <- compare_means(Percentage ~ field_labs_lng,  
                              data = FieldIndividualComplexity %>% mutate(Percentage = complexity), 
                              p.adjust.method = "holm") %>% 
  mutate(p.adj = format.pval(p.adj, digits = 3)) %>% 
  filter(p.adj <=.05) %>%
  mutate(y_pos = seq(1.05, 1+nrow(.)*0.05, by=0.05),
         labels = p.adj)

p <- ggplot(FieldComplexity, aes(y=Percentage, x=field_labs_lng, fill=fct_rev(as.factor(complexity))))+
  geom_bar(position = "fill",stat = "identity", color = "black", width = .9) +
  scale_y_continuous(labels = scales::percent, breaks = seq(0,1,.2)) +
    geom_label(aes(label = paste0(round(Percentage,2),"% [", complexity, "]"), y = Percentage/100),
             position = position_stack(vjust = 0.5),
             size = 4,
             colour = 'black',
             fill = 'white') +
  labs(y = "Complexity",
       x = "Field",
       fill = "Number of Aspects Measured") +
  #scale_fill_brewer(palette = "YlGnBu")+
  scale_fill_grey(start = 0.1, end = 0.8, breaks=c("1","2","3", "4")) +
  theme_Publication()+
  theme(strip.background =element_rect(fill="black", color="black"),
        strip.text = element_text(colour = 'white', face="bold"))

df_pair <-
  pairwiseComparisons::pairwise_comparisons(
    y = Percentage, 
    x = field_labs_lng,
    data = FieldIndividualComplexity %>% mutate(Percentage = complexity/4), 
    type = "nonparametric",
    p.adjust.method = "holm"
  )

ggstatsplot:::ggsignif_adder(
  plot = p,
  data = FieldIndividualComplexity %>% mutate(Percentage = complexity/4-2),
  x = field_labs_lng,
  y = Percentage,
  df_pairwise = df_pair,
  ggsignif.args = list(textsize = 4, tip_length = 0.00025)
)
```

```{r  FieldPlotComplexityAverage1, include=F, fig.width=16, fig.height=9}
## ALTERNATE VERSION WITH VIOLIN PLOT
# Calculate Complexity for every paper
FieldIndividualComplexity <- empiricalDataDisciplines %>%
  dplyr::select(Affect, Behavior, Cognition, Desire, discipline02) %>%
  #mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T)) %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02"))

library(ggpubr)
PostHocField <- compare_means(complexity ~ field_labs_lng,  data = FieldIndividualComplexity)
PostHocFieldFilt <- PostHocField %>% filter(p.adj <=.05)
my_comparisons <- PostHocFieldFilt %>% select(starts_with("group")) %>% as.matrix(.) %>% split(., seq(nrow(.)))

ggplot(FieldIndividualComplexity, aes(y=complexity, x=reorder(field_labs_lng, complexity), fill=field_labs_lng))+
  stat_summary(fun.y=mean, geom = "point", size = 2) +
  stat_summary(fun.data=mean_cl_normal, geom = "errorbar", width=.07)+
  # geom_violin(trim = T, width=1) +
  # geom_boxplot(width=0.04,
  #              outlier.colour = NULL,
  #              outlier.shape = NA,
  #              notch=F, fill="black",
  #              lwd=1, color="black") +
  # #geom_jitter(width = 0.15,
  # #            shape=18,
  # #            alpha=.5, size=1) +
  # #ggbeeswarm::geom_quasirandom(varwidth = TRUE, alpha = .5)+
  # #ggbeeswarm::geom_beeswarm(size=2,priority='density')+
  # stat_summary(fun.y=mean,
  #              geom="point",
  #              shape=16,
  #              size=1,
  #              colour="white") +
  # stat_summary(geom = "crossbar",
  #              width=0.04,
  #              fatten=0,
  #              color="white",
  #              fun.data = function(x){ return(c(y=median(x),
  #                                               ymin=median(x),
  #                                               ymax=median(x))) })+
  # stat_compare_means(label.y = 5)+
  # stat_compare_means(comparisons = my_comparisons, label = "p.signif") +
  # scale_y_continuous(limits = c(1,5))+
  ylab("Number of Aspects Included")+
  xlab("Field") +
  ggtitle("Number of Aspects by Field")+
  #coord_flip()+
  scale_fill_brewer(palette = "Pastel1")+
  scale_y_continuous(limits = c(1,5), breaks = seq(1,4,1))+
  #coord_fixed(ratio=9/16)+
  theme_Publication()+
  theme(strip.background =element_rect(fill="grey14", color="grey14"),
        strip.text = element_text(colour = 'white', face="bold"),
        #panel.border = element_rect(color="grey"),
        plot.title = element_text(size=18, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=16),
        axis.text.y = element_text(size=16),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)),
        legend.position="none")
```

```{r  FieldPlotComplexityAverage2, include=F, fig.width=16, fig.height=9}
## ALTERNATE VERSION WITH VIOLIN PLOT
# Calculate Complexity for every paper
FieldIndividualComplexity <- empiricalDataDisciplines %>%
  dplyr::select(Affect, Behavior, Cognition, Desire, discipline02) %>%
  #mutate_at(vars(Affect, Behavior, Cognition, Desire), ~replace_na(., 0)) %>%
  mutate(complexity = rowSums(select(., Affect, Behavior, Cognition, Desire), na.rm = T)) %>%
  right_join(rownames_to_column(as.data.frame(field_labs_lng), "discipline02"))

library(ggpubr)
PostHocField <- compare_means(complexity ~ field_labs_lng,  data = FieldIndividualComplexity)
PostHocFieldFilt <- PostHocField %>% filter(p.adj <=.05)
my_comparisons <- PostHocFieldFilt %>% select(starts_with("group")) %>% as.matrix(.) %>% split(., seq(nrow(.)))

ggplot(FieldIndividualComplexity, aes(y=complexity, x=reorder(field_labs_lng, complexity), fill=field_labs_lng))+
  stat_summary(fun.y = mean, geom = "point", size = 2) +
  stat_summary(fun.data=mean_cl_normal, geom = "errorbar", width=.07)+
  geom_violin(trim = T, width=1) +
  geom_boxplot(width=0.04,
               outlier.colour = NULL,
               outlier.shape = NA,
               notch=F, fill="black",
               lwd=1, color="black") +
  #geom_jitter(width = 0.15,
  #            shape=18,
  #            alpha=.5, size=1) +
  #ggbeeswarm::geom_quasirandom(varwidth = TRUE, alpha = .5)+
  #ggbeeswarm::geom_beeswarm(size=2,priority='density')+
  stat_summary(fun.y=mean,
               geom="point",
               shape=16,
               size=2,
               colour="white") +
  stat_summary(geom = "crossbar",
               width=0.04,
               fatten=0,
               color="white",
               fun.data = function(x){ return(c(y=median(x),
                                                ymin=median(x),
                                                ymax=median(x))) })+
  stat_compare_means(label.y = 5)+
  stat_compare_means(comparisons = my_comparisons, label = "p.signif") +
  ylab("Number of Aspects Included")+
  xlab("Field") +
  ggtitle("Number of Aspects by Field")+
  #coord_flip()+
  scale_fill_brewer(palette = "YlGnBu")+
  scale_y_continuous(limits = c(1,5), breaks = seq(1,4,1))+
  #coord_fixed(ratio=9/16)+
  theme_Publication()+
  theme(strip.background =element_rect(fill="grey14", color="grey14"),
        strip.text = element_text(colour = 'white', face="bold"),
        #panel.border = element_rect(color="grey"),
        plot.title = element_text(size=18, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=16),
        axis.text.y = element_text(size=16),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)),
        legend.position="none")
```

```{=tex}
\begin{figure}[h]
\centering
\caption{Scale Complexity and their proportional occurences per field. Stacked bar graphs showing how many experience aspects were measured in each academic field. Holm corrected p-values of the mean differences between academic fields displayed above the chart.}
\includegraphics[width=\textwidth]{Figures/FieldPlotComplexityAverage-1}
\label{fig:FieldPlotComplexityAverage}
\end{figure}
```

```{r FieldPlotFreq, include=F, fig.width=12, fig.height=16}
# barplot of dimension frequency
FieldElementBar <- ggplot(data=FieldElementFreq, aes(x=reorder(Element, Percentage), y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    #aes(label = paste0("N = ",Frequency)),
    aes(label = paste0(format(round(Percentage,1), nsmall=1), "%")),
    position=position_stack(vjust=0.5),
    color = "white",
    size = 3,
    vjust = 0.5
    ) +
  labs(title = "Element Frequency",
       y = "Frequency across all Scales",
       x = "Experience Element")+
  coord_flip()+
  facet_wrap(~discipline02, labeller = as_labeller(field_labs_lng))+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=10, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold"),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.position="none")

# barplot of complexity frequency
FieldComplexityBar <- ggplot(data=FieldComplexity, aes(x=reorder(complexity, -complexity), y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    #aes(label = paste0("N = ",Frequency)),
    aes(label = paste0(format(round(Percentage,1), nsmall=1), "%")),
    position=position_stack(vjust=0.5),
    color = "white",
    size = 3,
    vjust = 0.5
    ) +
  labs(title = "Scale Complexity",
       y = "Frequency across all Scales",
       x = "Complexity")+
  coord_flip()+
  facet_wrap(~discipline02, labeller = as_labeller(field_labs_lng))+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=10, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold"),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.position="none")

# FieldComplexityBar <- ggstatsplot::ggbarstats(
#   data = FieldComplexity,
#   x = complexity,
#   y = field_labs_lng,
#   counts = Frequency,
#   #sampling.plan = "jointMulti",
#   title = "Scale Complexity",
#   sample.size.label = F,
#   #label = "both",
#   xlab = "Discipline",
#   results.subtitle = FALSE,
#   package = "ggsci",
#   palette = "blue_grey_material",
#   ggtheme = ggthemes::theme_tufte(base_size = 12),
#   ggplot.component = list(scale_x_discrete(guide = guide_axis(n.dodge = 2))),
#   ggstatsplot.layer = F,
#   label.args = list(check_overlap = TRUE, alpha = 1, fill = "white"),
#   messages = FALSE
# )+
#   theme_Publication()+
#   theme(legend.position = "right", 
#         legend.direction = "vertical", 
#         legend.title = element_blank(),
#         axis.title.x = element_blank(),
#         plot.title = element_text(size=10, face="bold", hjust = 0.5))

# bar plot frequencies
FieldElementComb <- ggplot(FieldElementCombFreq, aes(x=reorder(ExperienceCombination, Percentage), y=Percentage)) +
  geom_bar(stat="identity", fill="grey14") +
  geom_text(
    aes(y=Percentage, label = paste0(round(Percentage,2),"% [N = ", Frequency, "]")),
    color = "grey14",
    size = 4,
    hjust = -.1,
    inherit.aes = TRUE
    ) +
  scale_y_continuous(limits = c(0, ceiling(max(EmpElementCombFreq$Percentage)*1.5)),
                     breaks = seq(0, ceiling(max(EmpElementCombFreq$Percentage)*1.5), 5))+
  labs(y = "Proportion of all scales [in %]",
       x = "Combination of Experience Elements")+
  coord_flip()+
  facet_wrap(~discipline02, labeller = as_labeller(field_labs_lng))+
  theme_Publication()+
  theme(strip.background =element_rect(fill="grey14", color="grey14"),
        strip.text = element_text(colour = 'white', face="bold"),
        legend.position="none")

ggdraw() +
  draw_plot(FieldElementComb, x = 0, y = 0.3, width = 1, height = .7)+
  draw_plot(FieldElementBar, x = 0, y = 0, width = .5, height = .3) +
  draw_plot(FieldComplexityBar, x = .5, y = 0, width = .5, height = .3) +
  draw_plot_label(c("(A)", "(B)", "(C)"), c(0, 0, 0.5), c(1, 0.3, 0.3), size = 15)
```

```{r FieldElementComp, include=F, fig.width=12, fig.height=12}
ggplot(FieldElementComplexity, aes(fill=field_labs_lng, y=avgComplexity, x=reorder(Element, avgComplexity))) + 
  geom_bar(position="dodge", stat="identity") +
  geom_errorbar(aes(ymin=avgComplexity-1.96*seComplexity, ymax=avgComplexity+1.96*seComplexity), width=.2,position=position_dodge(.9)) +
  scale_fill_grey(start = 0.8, end = 0.2) +
  #paletteer::scale_fill_paletteer_d("ggsci::blue_grey_material") +
  labs(x = "Element",
       y = "Number of Aspects",
       title = "Average Number of Elements \nMeasured Together with Element  [Mean  95%CI]") +
  #coord_flip()+
  theme_Publication() +
  theme(strip.background = element_rect(fill="grey14", color="grey14", ),
        axis.title.x = element_text(face="bold"),
        axis.title.y = element_text(face="bold"),
        plot.title = element_text(face="bold", hjust = 0.5),
        #legend.text = element_text(size=10),
        #axis.text.x = element_text(size=10),
        #axis.text.y = element_text(size=10),
        panel.grid.major.x = element_blank(),
        #panel.grid.major.y = element_blank(),
        #strip.text = element_text(colour = 'white', face="bold"),
        #panel.background = element_rect(fill = "transparent"),
        #plot.background = element_rect(fill = alpha('white', 0.5)), 
        legend.title = element_blank())
```

```{=tex}
\begin{figure}[h]
\centering
\caption{Psychological Acculturation Aspects across different academic fields. (A) Bar graph showing the common combinations of the affect, behavior, cognition, desire experience aspects for each field. (B) Bar graph showing the prevalence of each experience aspect by academic field. (C) Bar graph showing how many experience aspects were considered together in each acdemic field.}
\includegraphics[width=\textwidth]{Figures/FieldPlotFreq-1}
\label{fig:FieldPlotFreq}
\end{figure}
```
<!-- \begin{figure}[h] -->

<!-- \centering -->

<!-- \caption{Average complexity (number of experience elements measured) for all scales that include a given experience aspect.} -->

<!-- \includegraphics[width=\textwidth]{Figures/FieldElementComp-1} -->

<!-- \caption*{Note that these categories are not mutually exclusive (and thus not independent) because scales can include multiple experience aspects (i.e., higher complexity).} -->

<!-- \label{fig:FieldElementComp} -->

<!-- \end{figure} -->

\subsection{Comparing Literature Levels}

```{r CombinedABCDBar, include=F, fig.width=16, fig.height=9}
ElementFrequencyAll <- gdata::combine(Theoretical = TheoElementFreq,
                                      Methodological = ScaleElementFreq %>% mutate(Percentage = Percentage*100), 
                                      Empirical = EmpElementFreq)

CombinedABCDBar <- ggplot(data=ElementFrequencyAll, aes(x=Element, y=Percentage, fill=Element)) +
  geom_bar(position="dodge", stat="identity") +
  geom_text(
    aes(label = paste0(format(round(Percentage,1), nsmall = 1), "%")),
    position = position_dodge(.9),
    size = 5,
    vjust = 0.7,
    color = "Black",
    hjust = -0.08
    #color = "White",
    #hjust = 1.2
    ) +
  labs(title = "Overall Use of Experience Aspect",
       y = "Percentage across all articles",
       x = "Included")+
  facet_wrap(~source)+
  scale_y_continuous(limits = c(0, 100))+
  scale_fill_manual(values=c("grey14", "grey75", "grey75", "grey75"))+
  #scale_fill_brewer(palette="Paired")+
  coord_flip()+
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14"),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=18, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=16),
        axis.text.y = element_text(size=16),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold", size = 16),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)),
        legend.title = element_blank(),
        legend.key.size = unit(.4, "cm"),
        legend.position="none")

CombinedABCDBar
```

```{r CombinedComplexityBar, include=F, fig.width=16, fig.height=9}
Theoretical <- TheoElementCombFreq %>%
  mutate(Affect = Affect*Frequency,
         Behavior = Behavior*Frequency,
         Cognition = Cognition*Frequency,
         Desire = Desire*Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency), 
            Affect = sum(Affect), 
            Behavior = sum(Behavior), 
            Cognition = sum(Cognition), 
            Desire = sum(Desire)) %>%
  mutate(ABCDTotal = Affect+Behavior+Cognition+Desire, 
         Percentage = Frequency/sum(Frequency)*100,
         AffectProp = Percentage/ABCDTotal*Affect,
         BehaviorProp = Percentage/ABCDTotal*Behavior,
         CognitionProp = Percentage/ABCDTotal*Cognition,
         DesireProp = Percentage/ABCDTotal*Desire,
         sum = AffectProp + BehaviorProp + CognitionProp + DesireProp)

Methodological <- ScaleElementCombFreq %>%
  mutate(Affect = Affect*Frequency,
         Behavior = Behavior*Frequency,
         Cognition = Cognition*Frequency,
         Desire = Desire*Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency), 
            Affect = sum(Affect), 
            Behavior = sum(Behavior), 
            Cognition = sum(Cognition), 
            Desire = sum(Desire)) %>%
  mutate(ABCDTotal = Affect+Behavior+Cognition+Desire, 
         Percentage = Frequency/sum(Frequency)*100,
         AffectProp = Percentage/ABCDTotal*Affect,
         BehaviorProp = Percentage/ABCDTotal*Behavior,
         CognitionProp = Percentage/ABCDTotal*Cognition,
         DesireProp = Percentage/ABCDTotal*Desire,
         sum = AffectProp + BehaviorProp + CognitionProp + DesireProp)

Empirical <- EmpElementCombFreq %>%
  mutate(Affect = Affect*Frequency,
         Behavior = Behavior*Frequency,
         Cognition = Cognition*Frequency,
         Desire = Desire*Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency), 
            Affect = sum(Affect), 
            Behavior = sum(Behavior), 
            Cognition = sum(Cognition), 
            Desire = sum(Desire)) %>%
  mutate(ABCDTotal = Affect+Behavior+Cognition+Desire, 
         Percentage = Frequency/sum(Frequency)*100,
         AffectProp = Percentage/ABCDTotal*Affect,
         BehaviorProp = Percentage/ABCDTotal*Behavior,
         CognitionProp = Percentage/ABCDTotal*Cognition,
         DesireProp = Percentage/ABCDTotal*Desire,
         sum = AffectProp + BehaviorProp + CognitionProp + DesireProp)

ComplexityFrequencyAll <- gdata::combine(Theoretical, Methodological, Empirical)

ComplexityFrequencyAllLong <- ComplexityFrequencyAll %>% 
  select(source, complexity, Percentage, AffectProp, BehaviorProp, CognitionProp, DesireProp) %>%
  gather(., Aspect, Proportion, c(AffectProp, BehaviorProp, CognitionProp, DesireProp), factor_key=TRUE) %>%
  mutate(Aspect = gsub("Prop","",Aspect))

CombinedComplexityBar <- ggplot(data=ComplexityFrequencyAllLong, aes(x=reorder(complexity, Proportion), y=Proportion, fill=as.factor(complexity))) +
  geom_bar(position="stack", stat="identity") +
  labs(title = "Number of Experience Aspects Used",
       y = "Percentage across all articles",
       x = "Number of Aspects")+
  scale_y_continuous(limits = c(0, 50))+
  #scale_fill_manual(values=c("#F98F45", "#12908E"))+
  #scale_fill_brewer(palette="YlGnBu")+
  facet_wrap(~source)+
  #facet_wrap(~factor(source,levels=c("Theoretical","Methodological","Empirical"))) +
  scale_fill_manual(values = c("grey14", "grey75", "grey75", "grey14")) +
  #scale_fill_brewer(palette="Paired")+
  coord_flip()+
  geom_text(data = ComplexityFrequencyAll, 
            aes(x=reorder(complexity,Percentage), 
                y=Percentage, 
                fill=NULL, 
                label = paste0(format(round(Percentage,1), nsmall = 1), " %")),
    position = position_dodge(.9),
    size = 5,
    vjust = 0.7,
    color = "Black",
    hjust = -0.2
    #color = "White",
    #hjust = 1.2
    ) +
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14"),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=18, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=16),
        axis.text.y = element_text(size=16),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold", size = 16),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)),
        legend.title = element_blank(),
        legend.key.size = unit(.4, "cm"),
        legend.position="none")

CombinedComplexityBar
```

```{r CombinedComplexityAspectBar, include=F, fig.width=16, fig.height=9}
#                         #
#       OLD VERSION       #
#                         #

Theories <- TheoElementCombFreq %>%
  mutate(Affect = Affect*Frequency,
         Behavior = Behavior*Frequency,
         Cognition = Cognition*Frequency,
         Desire = Desire*Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency), 
            Affect = sum(Affect), 
            Behavior = sum(Behavior), 
            Cognition = sum(Cognition), 
            Desire = sum(Desire)) %>%
  mutate(ABCDTotal = Affect+Behavior+Cognition+Desire, 
         Percentage = Frequency/sum(Frequency)*100,
         AffectProp = Percentage/ABCDTotal*Affect,
         BehaviorProp = Percentage/ABCDTotal*Behavior,
         CognitionProp = Percentage/ABCDTotal*Cognition,
         DesireProp = Percentage/ABCDTotal*Desire,
         sum = AffectProp + BehaviorProp + CognitionProp + DesireProp)

Scales <- ScaleElementCombFreq %>%
  mutate(Affect = Affect*Frequency,
         Behavior = Behavior*Frequency,
         Cognition = Cognition*Frequency,
         Desire = Desire*Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency), 
            Affect = sum(Affect), 
            Behavior = sum(Behavior), 
            Cognition = sum(Cognition), 
            Desire = sum(Desire)) %>%
  mutate(ABCDTotal = Affect+Behavior+Cognition+Desire, 
         Percentage = Frequency/sum(Frequency)*100,
         AffectProp = Percentage/ABCDTotal*Affect,
         BehaviorProp = Percentage/ABCDTotal*Behavior,
         CognitionProp = Percentage/ABCDTotal*Cognition,
         DesireProp = Percentage/ABCDTotal*Desire,
         sum = AffectProp + BehaviorProp + CognitionProp + DesireProp)

Empirical <- EmpElementCombFreq %>%
  mutate(Affect = Affect*Frequency,
         Behavior = Behavior*Frequency,
         Cognition = Cognition*Frequency,
         Desire = Desire*Frequency) %>%
  group_by(complexity) %>%
  summarise(Frequency = sum(Frequency), 
            Affect = sum(Affect), 
            Behavior = sum(Behavior), 
            Cognition = sum(Cognition), 
            Desire = sum(Desire)) %>%
  mutate(ABCDTotal = Affect+Behavior+Cognition+Desire, 
         Percentage = Frequency/sum(Frequency)*100,
         AffectProp = Percentage/ABCDTotal*Affect,
         BehaviorProp = Percentage/ABCDTotal*Behavior,
         CognitionProp = Percentage/ABCDTotal*Cognition,
         DesireProp = Percentage/ABCDTotal*Desire,
         sum = AffectProp + BehaviorProp + CognitionProp + DesireProp)

ComplexityFrequencyAll <- gdata::combine(Theories, Scales, Empirical)

ComplexityFrequencyAllLong <- ComplexityFrequencyAll %>% 
  select(source, complexity, Percentage, AffectProp, BehaviorProp, CognitionProp, DesireProp) %>%
  gather(., Aspect, Proportion, c(AffectProp, BehaviorProp, CognitionProp, DesireProp), factor_key=TRUE) %>%
  mutate(Aspect = gsub("Prop","",Aspect))

CombinedComplexityAspectBar <- ggplot(data=ComplexityFrequencyAllLong, aes(x=reorder(complexity, Proportion), y=Proportion, fill=reorder(Aspect, Proportion))) +
  geom_bar(position="stack", stat="identity") +
  labs(title = "Relative Importance of Aspect per Complexity Level",
       y = "Percentage across all articles",
       x = "Number of Aspects")+
  scale_y_continuous(limits = c(0, 50))+
  scale_fill_grey(start = 0.8, end = 0.1) +
  #scale_fill_manual(values=c("#F98F45", "#12908E"))+
  #scale_fill_brewer(palette="YlGnBu")+
  facet_wrap(~source)+
  #scale_fill_brewer(palette="Paired")+
  coord_flip()+
  geom_text(data = ComplexityFrequencyAll, 
            aes(x=reorder(complexity,Percentage), 
                y=Percentage, 
                fill=NULL, 
                label = paste0(format(round(Percentage,1), nsmall = 1), " %")),
    position = position_dodge(.9),
    size = 5,
    vjust = 0.7,
    color = "Black",
    hjust = -0.2
    #color = "White",
    #hjust = 1.2
    ) +
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14"),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=18, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=16),
        axis.text.y = element_text(size=16),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold", size = 16),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)),
        legend.title = element_blank(),
        legend.key.size = unit(.4, "cm"),
        legend.position="bottom")

CombinedComplexityAspectBar
```

```{r CombinedAspectComplexityBar, include=F, fig.width=16, fig.height=9}

Theories <- TheoElementCombFreq %>% 
  mutate(ExperienceCombination = strsplit(as.character(ExperienceCombination), ", ")) %>% 
  unnest(ExperienceCombination) %>%
  group_by(ExperienceCombination, complexity) %>%
  summarise(Frequency = sum(Frequency)) %>%
  mutate(AspectTotal = sum(Frequency), 
         Proportion = Frequency/AspectTotal,
         Percentage = Frequency/sum(Frequency)*100)

Scales <- ScaleElementCombFreq %>%
  mutate(ExperienceCombination = strsplit(as.character(ExperienceCombination), ", ")) %>% 
  unnest(ExperienceCombination) %>%
  group_by(ExperienceCombination, complexity) %>%
  summarise(Frequency = sum(Frequency)) %>%
  mutate(AspectTotal = sum(Frequency), 
         Proportion = Frequency/AspectTotal,
         Percentage = Frequency/sum(Frequency)*100)

Empirical <- EmpElementCombFreq %>%
  mutate(ExperienceCombination = strsplit(as.character(ExperienceCombination), ", ")) %>% 
  unnest(ExperienceCombination) %>%
  group_by(ExperienceCombination, complexity) %>%
  summarise(Frequency = sum(Frequency)) %>%
  mutate(AspectTotal = sum(Frequency), 
         Proportion = Frequency/AspectTotal,
         Percentage = Frequency/sum(Frequency)*100)

ComplexityFrequencyAll <- gdata::combine(Theories, Scales, Empirical)

# ComplexityFrequencyAllLong <- ComplexityFrequencyAll %>% 
#   select(source, complexity, Percentage, AffectProp, BehaviorProp, CognitionProp, DesireProp) %>%
#   gather(., Aspect, Proportion, c(AffectProp, BehaviorProp, CognitionProp, DesireProp), factor_key=TRUE) %>%
#   mutate(Aspect = gsub("Prop","",Aspect))

CombinedAspectComplexityBar <- ggplot(data=ComplexityFrequencyAll, aes(x=reorder(ExperienceCombination, AspectTotal), y=Percentage, fill=forcats::fct_rev(as.factor(complexity)))) +
  geom_bar(position="stack", stat="identity") +
  labs(title = "Complexity Proportions for each Experience Aspect",
       y = "Percentage across all articles",
       x = "Number of Aspects",
       fill = "Number of Aspects Considered")+
  scale_y_continuous(limits = c(0, 100))+
  scale_fill_grey(start = 0.1, end = 0.8, breaks=c("1","2","3", "4")) +
  #scale_fill_manual(values=c("#F98F45", "#12908E"))+
  #scale_fill_brewer(palette="YlGnBu")+
  facet_wrap(~source)+
  #scale_fill_brewer(palette="Paired")+
  coord_flip()+
  # geom_text(data = ComplexityFrequencyAll, 
  #           aes(x=reorder(complexity,Percentage), 
  #               y=Percentage, 
  #               fill=NULL, 
  #               label = paste0(format(round(Percentage,1), nsmall = 1), " %")),
  #   position = position_dodge(.9),
  #   size = 5,
  #   vjust = 0.7,
  #   color = "Black",
  #   hjust = -0.2
  #   #color = "White",
  #   #hjust = 1.2
  #   ) +
  theme_Publication()+
  theme(strip.background = element_rect(fill="grey14", color="grey14"),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=18, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=16),
        axis.text.y = element_text(size=16),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold", size = 16),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)),
        #legend.title = element_blank(),
        legend.key.size = unit(.4, "cm"),
        legend.position="bottom")

CombinedAspectComplexityBar
```

```{r CombinedAspectComplexityMean, include=F, fig.width=16, fig.height=9}
ComplexityAverageAll <- rbind(TheoElementComplexity %>% mutate(Literature = "Theoretical"), 
                              scaleElementComplexity %>% mutate(Literature = "Methodological"), 
                              empElementComplexity %>% mutate(Literature = "Empirical")) %>%
  select(Aspect = Element, Mean = avgComplexity, SD=sdComplexity, N=n, SE=seComplexity, Literature) %>%
  mutate(Mean = Mean-1)
  
CombinedAspectComplexityMean <- ggplot(ComplexityAverageAll, aes(y=Mean, x=reorder(Aspect, -Mean)))+
  geom_point() +
  scale_y_continuous(limits = c(0,3)) +
  geom_errorbar(aes(ymin=Mean-1.96*SE, ymax=Mean+1.96*SE), colour="black", width=.1) +
  geom_text(aes(label=paste0(format(round(Mean,2),nsmall=2),
                             ", 95%CI[", format(round(Mean-1.96*SE,2),nsmall=2), ", ", format(round(Mean+1.96*SE,2),nsmall=2), "]"),
                hjust=0.5, vjust=-1.5, size = 14)) +
  labs(title = "Average Number of Other Experience Aspect Included",
       y = "Number of other aspects",
       x = "Focus aspect")+
  coord_flip() +
  facet_wrap(~factor(Literature,levels=c("Theoretical","Methodological","Empirical"))) +
  theme_Publication() +
  theme(strip.background = element_rect(fill="grey14", color="grey14"),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size=18, face="bold", hjust = 0.5),
        axis.text.x = element_text(size=16),
        axis.text.y = element_text(size=16),
        #panel.grid.major.x = element_blank(),
        #panel.grid.major.y = element_blank(),
        strip.text = element_text(colour = 'white', face="bold", size = 16),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = alpha('white', 0.5)),
        #legend.title = element_blank(),
        #legend.key.size = unit(.4, "cm"),
        legend.position="none")
  
CombinedAspectComplexityMean
```

```{r LiteratureComparison, include=F, fig.width=17, fig.height=17*1.3}
cowplot::plot_grid(CombinedABCDBar, CombinedComplexityBar, CombinedAspectComplexityMean, nrow=3, align = "v", rel_heights = c(1/3, 1/3, 1/3)) +
  draw_plot_label(c("(A)", "(B)", "(C)"), c(0, 0, 0), c(1, 2/3, 1/3), size = 18)
```

As a final step we aim to compare the three levels of literature we have reviewed (i.e., theoretical-psychometric-empirical). We find that all three bodies of literature focus more readily on the more external aspects of behaviors and cognitions, and less on more internal affects and desires. However, we also see that desires (i.e., motivations) play a more prominent role in the theoretical literature and interest decreases with more applied research (also see \fgrref[A]{fig:LiteratureComparison}). Looking at the combinations of different experience aspects, we find that across all three bodies of literature a combination of two or three aspects is most common (often including behaviors or cognitions). However, we also find that single aspect conceptualizations are substantially more common in the more applied empirical works, whereas conceptualizations that include all four experience aspects are substantially more common in the more abstract theoretical literature (also see \fgrref[B]{fig:LiteratureComparison}). Yet, we also see that the most undervalued aspects often are considered in works that have already included a larger number of other aspects (also see \fgrref[C]{fig:LiteratureComparison}).

```{=tex}
\begin{figure}[h]
\centering
\caption{Literature Levels: (A) Bar graph of the experience aspect frequencies for theoretical, psychometric, and broader empirical literature. (B) Bar graph of the number of experience aspects used for theoretical, psychometric, and broader empirical literature. (C) Average number of additional aspects included when the aspect was considered for theoretical, psychometric, and broader empirical literature [Mean  95\%CI].}
\includegraphics[width=\textwidth]{Figures/LiteratureComparison-1}
\caption*{Note that in (C) within each literature body the aspects are not mutually exclusive (and thus not independent) because scales can include multiple experience aspects.}
\label{fig:LiteratureComparison}
\end{figure}
```
